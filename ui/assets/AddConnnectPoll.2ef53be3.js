var o=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;"undefined"!=typeof require&&require;import{a as n,s as l}from"./staticTools.84335405.js";import{m as i}from"./dynamicTools.f0febdba.js";import{A as s}from"./api_clusterManage.788b7961.js";import{n as a,D as r}from"./index.851f4377.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";const c={};var f=a({data(){return{addConnnectPollVisible:!1,formInfo:{},formInfoRules:{zqpool_id:[{required:!0,message:this.$t("ConnectionPoolManagement.qingxuanze-ZQPoolID"),trigger:"blur"}]},zqpoolIDOptions:[],zqpoolList:[],confFormList:[],confSequence:["fe_user","fe_passwd","fe_dbname","be_user","be_passwd","be_dbname","fe_max_conns","be_rw_conns","be_rd_conns","msg_buf_size","be_ipport","be_conn_life_time","be_retry_count","be_retry_interval","retry_cnt_when_full","retry_interval_ms_when_full"]}},props:["is-show"],watch:{"formInfo.zqpool_id":{handler:function(o,e){e?i(this.$t("ConnectionPoolManagement.qiehuan-ZQPoolID-switch")).then((()=>{this.formatFindConfData(o)})).catch((()=>{console.log("cancel")})):this.formatFindConfData(o)}}},methods:{submit(){this.$refs.formInfo.validate((i=>{if(i){let i=this.formInfo,{zqpool_id:a}=i,c={zqpool_id:a,conf_dict:((n,l)=>{var i={};for(var s in n)e.call(n,s)&&l.indexOf(s)<0&&(i[s]=n[s]);if(null!=n&&o)for(var s of o(n))l.indexOf(s)<0&&t.call(n,s)&&(i[s]=n[s]);return i})(i,["zqpool_id"])};for(const o in c.conf_dict)String(o).includes("passwd")&&(c.conf_dict[o]=r.ToDbText(c.conf_dict[o]));const f=n(".addConnnectPollDialog .el-dialog");s.addPool(c).then((o=>{l(this.$t("ConnectionPoolManagement.daoru-chenggong")),this.closeDialog(),this.$emit("refresh"),f.close()}),(o=>{f.close()}))}}))},formatFindConfData(o){let e=this.zqpoolList.find((e=>e.zqpool_id===o)).conf_dict;this.confFormList=[];const t=[];for(const n in e){const o=e[n],l=typeof o,i=this.toCamelCase(n);let s=[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",[i]),trigger:"blur"}];"number"===l&&s.push({type:"number",message:this.$t("createDatabasePage.qingshuru-shuzi"),trigger:"blur"});let a={label:n,cname:i,value:o,type:l,rules:s};"be_ipport"===a.label&&(a.span=24),t.push(a),this.$set(this.formInfo,a.label,a.value)}t.sort(((o,e)=>this.getIndex(o)-this.getIndex(e))),this.confFormList=t},getInfo(){const o=n(".addConnnectPollDialog .el-dialog");s.getZqpoolList({page_size:9999,page_num:1,filter:""}).then((e=>{if(0===e.rows.length)return l(this.$t("ConnectionPoolManagement.zqpool-empty"),"warning");this.zqpoolList=e.rows,this.zqpoolIDOptions=e.rows.map((o=>o.zqpool_id)),o.close()}),(e=>{o.close()}))},closeDialog(){this.addConnnectPollVisible=!1,this.$emit("update:isShow",this.addConnnectPollVisible)},getIndex(o){const e=this.confSequence.indexOf(o.label);return-1!==e?e:this.confSequence.length},toCamelCase:o=>o.split("_").map(((o,e)=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase())).join("")},created(){this.addConnnectPollVisible=this.$props.isShow},mounted(){this.getInfo()}},(function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("el-dialog",{staticClass:"addConnnectPollDialog",attrs:{"append-to-body":!0,title:o.$t("ConnectionPoolManagement.tianjia-lianjiechi"),visible:o.addConnnectPollVisible,"close-on-click-modal":!1},on:{close:o.closeDialog,"update:visible":function(e){o.addConnnectPollVisible=e}}},[t("el-form",{ref:"formInfo",attrs:{model:o.formInfo,rules:o.formInfoRules,"label-width":"160px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"ZQPoolID",prop:"zqpool_id"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:o.$t("ConnectionPoolManagement.qingxuanze-ZQPoolID")},model:{value:o.formInfo.zqpool_id,callback:function(e){o.$set(o.formInfo,"zqpool_id",e)},expression:"formInfo.zqpool_id"}},o._l(o.zqpoolIDOptions,(function(o){return t("el-option",{key:o,attrs:{label:o,value:o}})})),1)],1)],1)],1),t("el-row",[t("el-divider",{attrs:{"content-position":"center"}},[o._v(o._s(o.$t("ConnectionPoolManagement.yixiashi-peizhi-config")))])],1),t("el-row",o._l(o.confFormList,(function(e){return t("el-col",{key:e.label,attrs:{span:void 0===e.span?12:e.span}},[t("el-form-item",{attrs:{label:e.cname,prop:e.label,rules:e.rules}},["string"===e.type?[t("el-input",{attrs:{placeholder:o.$t("addOrModifyPgHba.qingshuru-neirong",[e.cname])},model:{value:o.formInfo[e.label],callback:function(t){o.$set(o.formInfo,e.label,t)},expression:"formInfo[item.label]"}})]:o._e(),"number"===e.type?[t("el-input",{attrs:{placeholder:o.$t("addOrModifyPgHba.qingshuru-neirong",[e.label])},model:{value:o.formInfo[e.label],callback:function(t){o.$set(o.formInfo,e.label,o._n(t))},expression:"formInfo[item.label]"}})]:o._e()],2)],1)})),1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:o.closeDialog}},[o._v(o._s(o.$t("index.qu-xiao")))]),t("el-button",{attrs:{type:"primary"},on:{click:o.submit}},[o._v(o._s(o.$t("defineDatabasePage.ti-jiao")))])],1)],1)}),[],!1,d,"e9dc4d6c",null,null);function d(o){for(let e in c)this[e]=c[e]}var p=function(){return f.exports}();export{p as default};
