var e=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;"undefined"!=typeof require&&require;import{a as n,s as l}from"./staticTools.84335405.js";import{m as i}from"./dynamicTools.f0febdba.js";import{A as s}from"./api_clusterManage.788b7961.js";import{n as a,D as r}from"./index.8ae6cd07.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";const c={};var f=a({data(){return{addConnnectPollVisible:!1,formInfo:{},formInfoRules:{zqpool_id:[{required:!0,message:this.$t("ConnectionPoolManagement.qingxuanze-ZQPoolID"),trigger:"blur"}]},zqpoolIDOptions:[],zqpoolList:[],confFormList:[],confSequence:["fe_user","fe_passwd","fe_dbname","be_user","be_passwd","be_dbname","fe_max_conns","be_rw_conns","be_rd_conns","msg_buf_size","be_ipport","be_conn_life_time","be_retry_count","be_retry_interval","retry_cnt_when_full","retry_interval_ms_when_full"]}},props:["is-show"],watch:{"formInfo.zqpool_id":{handler:function(e,o){o?i(this.$t("ConnectionPoolManagement.qiehuan-ZQPoolID-switch")).then((()=>{this.formatFindConfData(e)})).catch((()=>{console.log("cancel")})):this.formatFindConfData(e)}}},methods:{submit(){this.$refs.formInfo.validate((i=>{if(i){let i=this.formInfo,{zqpool_id:a}=i,c={zqpool_id:a,conf_dict:((n,l)=>{var i={};for(var s in n)o.call(n,s)&&l.indexOf(s)<0&&(i[s]=n[s]);if(null!=n&&e)for(var s of e(n))l.indexOf(s)<0&&t.call(n,s)&&(i[s]=n[s]);return i})(i,["zqpool_id"])};for(const e in c.conf_dict)String(e).includes("passwd")&&(c.conf_dict[e]=r.ToDbText(c.conf_dict[e]));const f=n(".addConnnectPollDialog .el-dialog");s.addPool(c).then((e=>{l(this.$t("ConnectionPoolManagement.daoru-chenggong")),this.closeDialog(),this.$emit("refresh"),f.close()}),(e=>{f.close()}))}}))},formatFindConfData(e){let o=this.zqpoolList.find((o=>o.zqpool_id===e)).conf_dict;this.confFormList=[];const t=[];for(const n in o){const e=o[n],l=typeof e,i=this.toCamelCase(n);let s=[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",[i]),trigger:"blur"}];"number"===l&&s.push({type:"number",message:this.$t("createDatabasePage.qingshuru-shuzi"),trigger:"blur"});let a={label:n,cname:i,value:e,type:l,rules:s};"be_ipport"===a.label&&(a.span=24),t.push(a),this.$set(this.formInfo,a.label,a.value)}t.sort(((e,o)=>this.getIndex(e)-this.getIndex(o))),this.confFormList=t},getInfo(){const e=n(".addConnnectPollDialog .el-dialog");s.getZqpoolList({page_size:9999,page_num:1,filter:""}).then((o=>{if(0===o.rows.length)return l(this.$t("ConnectionPoolManagement.zqpool-empty"),"warning");this.zqpoolList=o.rows,this.zqpoolIDOptions=o.rows.map((e=>e.zqpool_id)),e.close()}),(o=>{e.close()}))},closeDialog(){this.addConnnectPollVisible=!1,this.$emit("update:isShow",this.addConnnectPollVisible)},getIndex(e){const o=this.confSequence.indexOf(e.label);return-1!==o?o:this.confSequence.length},toCamelCase:e=>e.split("_").map(((e,o)=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join("")},created(){this.addConnnectPollVisible=this.$props.isShow},mounted(){this.getInfo()}},(function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("el-dialog",{staticClass:"addConnnectPollDialog",attrs:{"append-to-body":!0,title:e.$t("ConnectionPoolManagement.tianjia-lianjiechi"),visible:e.addConnnectPollVisible,"close-on-click-modal":!1},on:{close:e.closeDialog,"update:visible":function(o){e.addConnnectPollVisible=o}}},[t("el-form",{ref:"formInfo",attrs:{model:e.formInfo,rules:e.formInfoRules,"label-width":"160px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"ZQPoolID",prop:"zqpool_id"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("ConnectionPoolManagement.qingxuanze-ZQPoolID")},model:{value:e.formInfo.zqpool_id,callback:function(o){e.$set(e.formInfo,"zqpool_id",o)},expression:"formInfo.zqpool_id"}},e._l(e.zqpoolIDOptions,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1)],1),t("el-row",[t("el-divider",{attrs:{"content-position":"center"}},[e._v(e._s(e.$t("ConnectionPoolManagement.yixiashi-peizhi-config")))])],1),t("el-row",e._l(e.confFormList,(function(o){return t("el-col",{key:o.label,attrs:{span:void 0===o.span?12:o.span}},[t("el-form-item",{attrs:{label:o.cname,prop:o.label,rules:o.rules}},["string"===o.type?[t("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",[o.cname])},model:{value:e.formInfo[o.label],callback:function(t){e.$set(e.formInfo,o.label,t)},expression:"formInfo[item.label]"}})]:e._e(),"number"===o.type?[t("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",[o.label])},model:{value:e.formInfo[o.label],callback:function(t){e.$set(e.formInfo,o.label,e._n(t))},expression:"formInfo[item.label]"}})]:e._e()],2)],1)})),1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeDialog}},[e._v(e._s(e.$t("index.qu-xiao")))]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("defineDatabasePage.ti-jiao")))])],1)],1)}),[],!1,d,"e9dc4d6c",null,null);function d(e){for(let o in c)this[o]=c[o]}var p=function(){return f.exports}();export{p as default};
