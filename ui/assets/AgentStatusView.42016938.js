import{n as t,_ as e}from"./index.8ae6cd07.js";import{A as a}from"./api_systemManagement.1f6cc404.js";import i from"./taskLog.e9bd1119.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";const s={};var n=t({name:"AgentStatusView",data:()=>({filters:{name:"",state:""},total:0,page:1,size:20,loading:!1,rows:[],agentCheck:"",restart_agent:!1,editProp:["tar_path","upload_path"],clickCellMap:{},needToFirstPage:!1,clupServerLoading:!1,multipleChoicAgentsArr:[],installer_package_visible:!1,add_package_visible:!1}),components:{taskLog:i,InstallerPackage:()=>e((()=>import("./InstallerPackage.4f7c88e6.js")),["assets/InstallerPackage.4f7c88e6.js","assets/InstallerPackage.d7be90bc.css","assets/staticTools.84335405.js","assets/vendor.194c4086.js","assets/verificationRules.bef90446.js","assets/api_systemManagement.1f6cc404.js","assets/index.dfdb83b1.js","assets/bus.d56574c1.js","assets/index.8ae6cd07.js","assets/index.738ab243.css"]),AddPackage:()=>e((()=>import("./AddPackage.4d38b755.js")),["assets/AddPackage.4d38b755.js","assets/AddPackage.4a63a7ff.css","assets/staticTools.84335405.js","assets/vendor.194c4086.js","assets/verificationRules.bef90446.js","assets/api_systemManagement.1f6cc404.js","assets/index.dfdb83b1.js","assets/bus.d56574c1.js","assets/index.8ae6cd07.js","assets/index.738ab243.css"])},watch:{"filters.name"(t,e){t!=e&&""!=t&&(this.needToFirstPage=!0)}},methods:{addPackage(){this.add_package_visible=!0},installPackage(){this.installer_package_visible=!0},multipleChoicAgents(t){this.multipleChoicAgentsArr=t.map((t=>t))},isSelectable:(t,e)=>1===t.state,openLog(t){this.gotoLog(t)},tableRowClassName:({row:t,rowIndex:e})=>e%2!=0?"warning-row":"success-row",checkboxChange(){this.needToFirstPage=!0,this.showList()},handleSizeChange(t){this.size=t,this.needToFirstPage=!0,this.showList()},handleCurrentChange(t){this.page=t,this.showList()},handleSearch(){this.showList()},showList:function(){let t=this;this.needToFirstPage&&(this.page=1),1==this.page&&(this.total=0);let e={page_size:t.size,page_num:t.page};""!==t.filters.name&&(e.filter=t.filters.name),""!==t.filters.state&&(e.state=Number(t.filters.state)),t.loading=!0,a.getHostList(e).then((function(e){t.loading=!1,t.needToFirstPage=!1,e&&e.rows&&(t.total=e.total,t.rows=e.rows),t.$nextTick((()=>{t.$emit("btnHidden")}))}),(function(e){t.loading=!1}))},addAlarmDefinition:function(t,e){let i=this;this.$confirm(this.$t("dbList.gaishujuku-message")+e.hid+this.$t("dbList.haimeiyou-tianjia-message"),this.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{i.loading=!0;let t={object_id:e.hid,obj_type:"host"};a.addAlarmAPI(t).then((function(){i.loading=!1,i.showList()}),(function(t){i.loading=!1}))})).catch((()=>{}))},removeHost:function(t,e){let i=this;this.$confirm(this.$t("AgentStatusView.shifou-queren-jiang-m")+e.hid+this.$t("AgentStatusView.xiaxian"),this.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{i.loading=!0;let t={ip:e.ip};a.removeHost(t).then((function(){i.loading=!1;let t=Math.ceil((i.total-1)/i.size),e=i.page>t?t:i.page;i.page=e<1?1:e,i.showList()}),(function(t){i.loading=!1}))}))},gotoLog:function(t){this.$refs.tasklog.openDialog(t,"",1)}},mounted:function(){this.showList()}},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"warp"},[a("el-col",{staticClass:"warp-breadcrum",attrs:{span:24}},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/AgentStatusView"}}},[a("span",[t._v(t._s(t.$t("AgentStatusView.Agent-xinxi")))])])],1)],1),a("task-log",{ref:"tasklog"}),a("el-col",{staticClass:"warp-main",attrs:{span:24}},[a("el-form",{staticClass:"demo-form-inline",staticStyle:{display:"inline-block"},attrs:{inline:!0,model:t.filters},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:t.$t("BackupPlanManage.beifen-zhuangtai")},on:{change:t.checkboxChange},model:{value:t.filters.state,callback:function(e){t.$set(t.filters,"state",e)},expression:"filters.state"}},[a("el-option",{attrs:{label:t.$t("BackupPlanManage.quanbu"),value:""}}),a("el-option",{attrs:{label:"Down",value:"-1"}})],1)],1),a("el-form-item",[a("el-input",{staticStyle:{width:"400px","margin-top":"6px"},attrs:{placeholder:t.$t("AgentStatusView.qingshuru-zhuji-mingcheng-m")},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch(e)}},model:{value:t.filters.name,callback:function(e){t.$set(t.filters,"name",e)},expression:"filters.name "}},[a("el-button",{attrs:{slot:"append",type:"primary"},on:{click:t.handleSearch},slot:"append"},[t._v(t._s(t.$t("dbList.shou-suo")))])],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("Public.question"),placement:"top"}},[a("i",{staticClass:"el-icon-question",staticStyle:{"margin-left":"5px"}})])],1)],1),a("div",{attrs:{align:"right"}},[a("el-button",{staticClass:"el-icon-refresh-right",attrs:{type:"text",size:"medium"},on:{click:function(e){return t.showList()}}},[t._v(t._s(t.$t("resourceManagement.shua-xin")))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{type:"primary",size:"medium"},on:{click:function(e){return t.addPackage()}}},[t._v(t._s(t.$t("InstallerPackage.tianjia-chengxubao")))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{type:"primary",size:"medium",disabled:0===t.multipleChoicAgentsArr.length},on:{click:function(e){return t.installPackage()}}},[t._v(t._s(t.$t("InstallerPackage.anzhuang-chengxubao")))])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"row-class-name":t.tableRowClassName,data:t.rows,border:"","element-loading-text":t.$t("Public.ping-ming-jia-zai-zhong")},on:{"selection-change":t.multipleChoicAgents}},[a("el-table-column",{attrs:{selectable:t.isSelectable,type:"selection",align:"center",width:"55"}}),a("el-table-column",{attrs:{prop:"state",label:t.$t("AgentStatusView.Agent-zhuangtai"),align:"center","header-align":"center",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.state?a("i",{staticClass:"el-icon-success green"},[a("span",{staticClass:"statefont"},[t._v(" UP")])]):t._e(),-1===e.row.state?a("i",{staticClass:"el-icon-error red"},[a("span",{staticClass:"statefont"},[t._v(" Down")])]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"ip",label:t.$t("AgentStatusView.IP-dizhi"),align:"center","min-width":"130px"}}),a("el-table-column",{attrs:{prop:"hostname",label:t.$t("AgentStatusView.zhuji-ming"),align:t.$t("AgentStatusView.cenAgent-jiqi-rizhi-m"),"min-width":"100px","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"os",label:t.$t("AgentStatusView.caozuo-xitong"),align:"center","min-width":"100px"}}),a("el-table-column",{attrs:{prop:"cpu_cores",label:t.$t("createDatabasePage.CPU-heshu"),align:"center","min-width":"100px"}}),a("el-table-column",{attrs:{prop:"version",label:"Agent "+t.$t("licManager.ban-ben"),align:"center","min-width":"100px"}}),a("el-table-column",{attrs:{prop:"handle",label:t.$t("dbList.cao-zuo"),align:"center","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.is_alarm?a("el-link",{attrs:{size:"mini"},on:{click:function(a){return t.addAlarmDefinition(e.$index,e.row)}}},[t._v(t._s(t.$t("dbList.tianjian-baojing-dingyi")))]):t._e(),-1===e.row.state?a("el-link",{staticClass:"offLine",attrs:{size:"mini"},on:{click:function(a){return t.removeHost(e.$index,e.row)}}},[t._v(t._s(t.$t("AgentStatusView.jiqi-xiaxian")))]):t._e()]}}])})],1),a("div",{staticClass:"block",staticStyle:{float:"right"}},[a("el-pagination",{ref:"pagination",attrs:{layout:"total, sizes, prev, pager, next, jumper",total:t.total,"page-sizes":[20,30,40,50,100]},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t.installer_package_visible?a("InstallerPackage",{attrs:{"data-choices":t.multipleChoicAgentsArr,"is-show":t.installer_package_visible},on:{openTaskLog:t.openLog,refresh:t.showList,"update:isShow":function(e){t.installer_package_visible=e},"update:is-show":function(e){t.installer_package_visible=e}}}):t._e(),t.add_package_visible?a("AddPackage",{attrs:{"is-show":t.add_package_visible},on:{"update:isShow":function(e){t.add_package_visible=e},"update:is-show":function(e){t.add_package_visible=e}}}):t._e()],1)}),[],!1,l,"058c39ba",null,null);function l(t){for(let e in s)this[e]=s[e]}var o=function(){return n.exports}();export{o as default};
