import{a as e,s as t}from"./staticTools.84335405.js";import{c as o,b as r}from"./verificationRules.43272891.js";import{n as s,D as a}from"./index.851f4377.js";import{A as i}from"./api_clusterManage.788b7961.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";const n={};var l=s({data(){return{creatZqpoolVisible:!1,oidIsdisabled:!0,row:null,formInfo:{zqpool_name:"",os_user:"zqpool",root_path:"/home/zqpool",exporter_port:9816,mgr_port:9380,mgr_addr:"*",listen_port:5436,listen_addr:"*"},formInfoRules:{zqpool_name:[{required:!1,message:this.$t("addOrModifyPgHba.qingshuru-neirong",[this.$t("ConnectionPoolManagement.zqpool-mingcheng")]),trigger:"blur"}],host:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-zhuji"),trigger:"change"}],package_id:[{required:!0,message:this.$t("ConnectionPoolManagement.qingxuzne-chengxubao"),trigger:"change"}],os_user:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["os_user"]),trigger:"blur"},{required:!0,validator:(e,t,o)=>{if(t){let e={host:this.formInfo.host,user:t};i.checkOsUserExists(e).then((e=>{0===e.err_code?0!==e.exists?(this.oidIsdisabled=!0,this.$set(this.formInfo,"os_uid",e.exists),this.$refs.formInfo.clearValidate("os_uid"),o()):(this.oidIsdisabled=!1,this.$set(this.formInfo,"os_uid",716),this.$refs.formInfo.validateField("os_uid"),o()):o(new Error(e.err_msg))}),(e=>{o(new Error(e))}))}},trigger:"blur"}],os_uid:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["os_uid"]),trigger:"blur"},{type:"number",message:this.$t("createDatabasePage.qingshuru-shuzi"),trigger:"blur"},{required:!0,validator:(e,t,o)=>{if(t){if(this.oidIsdisabled)return o();let e={host:this.formInfo.host,os_uid:t};i.checkOsUidExists(e).then((e=>{0===e.err_code?0!==e.exists?o(new Error(this.$t("ConnectionPoolManagement.value-yicunzai",[t]))):o():o(new Error(e.err_msg))}),(e=>{o(new Error(e))}))}},trigger:"blur"}],root_path:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["root_path"]),trigger:"blur"},{required:!0,validator:o,trigger:"blur"}],exporter_port:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["exporter_port"]),trigger:"blur"},{type:"number",message:this.$t("createDatabasePage.qingshuru-shuzi"),trigger:"blur"},{required:!0,validator:r,trigger:"blur"}],mgr_port:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["mgr_port"]),trigger:"blur"},{type:"number",message:this.$t("createDatabasePage.qingshuru-shuzi"),trigger:"blur"},{required:!0,validator:r,trigger:"blur"}],mgr_addr:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["mgr_addr"]),trigger:"blur"}],listen_port:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["listen_port"]),trigger:"blur"},{type:"number",message:this.$t("createDatabasePage.qingshuru-shuzi"),trigger:"blur"},{required:!0,validator:r,trigger:"blur"}],listen_addr:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["listen_addr"]),trigger:"blur"}],mgr_token:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["mgr_token"]),trigger:"blur"}]},curHostOptions:[],zqpoolConfs:[],curVerionOptions:[],data_rows:{},way:""}},computed:{isModify(){return"modify"===this.way}},props:["is-show","data-way","data-rows"],methods:{submit(){this.$refs.formInfo.validate((o=>{if(o){let o=Object.assign({},this.formInfo);o.mgr_token=a.ToDbText(o.mgr_token);const r=e(".creatZqpoolDialog .el-dialog");switch(this.way){case"creat":i.createZqpool(o).then((e=>{t(this.$t("ConnectionPoolManagement.chuangjian-chenggong")),this.$emit("refresh"),this.closeDialog(),r.close()}),(e=>{r.close()}));break;case"modify":["host","os_uid","os_user"].forEach((e=>{delete o[e]})),o.zqpool_id=this.data_rows.zqpool_id,i.updateZqpoolInfo(o).then((e=>{t(this.$t("baseInfo.xiugai-chenggong")),this.$emit("refresh"),this.closeDialog(),r.close()}),(e=>{r.close()}))}}}))},async getInfo(){const t=e(".creatZqpoolDialog .el-dialog");try{"creat"===this.way&&await this.getDBHostList(),await this.getCsuPackageInfo(),t.close()}catch(o){t.close()}},getDBHostList(){return new Promise(((e,o)=>{i.getDBHostList().then((r=>{0===r.length&&(t(this.$t("createStreamReplicationCluster.shujuku-suozai-m"),"warning"),o(!1)),this.curHostOptions=r,e(!0)}),(e=>{o(!1)}))}))},getCsuPackageInfo(){return new Promise(((e,t)=>{i.getCsuPackageInfo({package_name:"zqpool"}).then((t=>{this.zqpoolConfs=t.rows,this.curVerionOptions=this.zqpoolConfs.map((e=>({package:e.package,package_id:e.package_id}))),this.curVerionOptions.length&&this.$set(this.formInfo,"package_id",this.curVerionOptions[0].package_id),e(!0)}),(e=>{t(!1)}))}))},closeDialog(){this.creatZqpoolVisible=!1,this.$emit("update:isShow",this.creatZqpoolVisible)},setFrom(){const e=["zqpool_name","host","package_id","os_user","root_path","exporter_port","mgr_port","mgr_addr","listen_port","listen_addr","mgr_token"];for(const t in this.data_rows)if(Object.hasOwnProperty.call(this.data_rows,t))if(this.data_rows[t]instanceof Object)for(const o in this.data_rows[t])e.includes(o)&&("mgr_token"===o?this.$set(this.formInfo,o,a.FromDbText(this.data_rows[t][o])):this.$set(this.formInfo,o,this.data_rows[t][o]));else e.includes(t)&&this.$set(this.formInfo,t,this.data_rows[t])}},mounted(){this.getInfo(),"modify"===this.way&&this.setFrom()},created(){this.creatZqpoolVisible=this.$props.isShow,this.way=this.$props.dataWay,this.data_rows=this.$props.dataRows}},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{staticClass:"creatZqpoolDialog",attrs:{"append-to-body":!0,title:e.$t("ConnectionPoolManagement.zqpool-dialog-title",["modify"===e.way?e.$t("alarmSet.xiugai"):e.$t("ConnectionPoolManagement.chuangjian")]),visible:e.creatZqpoolVisible,"close-on-click-modal":!1},on:{close:e.closeDialog,"update:visible":function(t){e.creatZqpoolVisible=t}}},[o("el-form",{ref:"formInfo",attrs:{model:e.formInfo,rules:e.formInfoRules,"label-width":"110px"}},[o("el-row",[o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:e.$t("ConnectionPoolManagement.zqpool-mingcheng"),prop:"zqpool_name"}},[o("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",[e.$t("ConnectionPoolManagement.zqpool-mingcheng")])},model:{value:e.formInfo.zqpool_name,callback:function(t){e.$set(e.formInfo,"zqpool_name",t)},expression:"formInfo.zqpool_name"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:e.$t("ConnectionPoolManagement.xuanze-zhuji"),prop:"host"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.isModify,filterable:"",placeholder:e.$t("createStreamReplicationCluster.qingshuru-zhuji")},model:{value:e.formInfo.host,callback:function(t){e.$set(e.formInfo,"host",t)},expression:"formInfo.host"}},e._l(e.curHostOptions,(function(t){return o("el-option",{key:t.hid,attrs:{label:t.ip,value:t.ip,disabled:1!==t.state||1===t.is_using||t.mem_size<64}},[o("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,placement:"top",disabled:t.mem_size>64&&1===t.state,effect:"dark",content:1!==t.state?e.$t("dbList.agent-yichang"):e.$t("createDatabasePage.gaizhuji-shengyu-message")}},[o("div",{staticClass:"clearfix"},[o("span",{staticClass:"fl"},[e._v(e._s(t.ip))]),o("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.hostname))])])])],1)})),1)],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:e.$t("ConnectionPoolManagement.xuanze-chengxubao"),prop:"package_id"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("ConnectionPoolManagement.qingxuzne-chengxubao")},model:{value:e.formInfo.package_id,callback:function(t){e.$set(e.formInfo,"package_id",t)},expression:"formInfo.package_id"}},e._l(e.curVerionOptions,(function(e){return o("el-option",{key:e.package_id,attrs:{label:e.package,value:e.package_id}})})),1)],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"os_user",prop:"os_user"}},[o("el-input",{attrs:{disabled:e.isModify,placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["os_user"])},model:{value:e.formInfo.os_user,callback:function(t){e.$set(e.formInfo,"os_user",t)},expression:"formInfo.os_user"}})],1)],1),o("el-col",{attrs:{span:12}},[e.isModify?e._e():o("el-form-item",{attrs:{label:"os_uid",prop:"os_uid"}},[o("el-input",{attrs:{disabled:e.oidIsdisabled,placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["os_uid"])},model:{value:e.formInfo.os_uid,callback:function(t){e.$set(e.formInfo,"os_uid",e._n(t))},expression:"formInfo.os_uid"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"root_path",prop:"root_path"}},[o("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["root_path"])},model:{value:e.formInfo.root_path,callback:function(t){e.$set(e.formInfo,"root_path",t)},expression:"formInfo.root_path"}})],1)],1),o("el-col",{attrs:{span:12}},[e.isModify?e._e():o("el-form-item",{attrs:{label:"exporter_port",prop:"exporter_port"}},[o("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["exporter_port"])},model:{value:e.formInfo.exporter_port,callback:function(t){e.$set(e.formInfo,"exporter_port",e._n(t))},expression:"formInfo.exporter_port"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"mgr_port",prop:"mgr_port"}},[o("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["mgr_port"])},model:{value:e.formInfo.mgr_port,callback:function(t){e.$set(e.formInfo,"mgr_port",e._n(t))},expression:"formInfo.mgr_port"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"mgr_addr",prop:"mgr_addr"}},[o("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["mgr_addr"])},model:{value:e.formInfo.mgr_addr,callback:function(t){e.$set(e.formInfo,"mgr_addr",t)},expression:"formInfo.mgr_addr"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"listen_port",prop:"listen_port"}},[o("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["listen_port"])},model:{value:e.formInfo.listen_port,callback:function(t){e.$set(e.formInfo,"listen_port",e._n(t))},expression:"formInfo.listen_port"}})],1)],1),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"listen_addr",prop:"listen_addr"}},[o("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["listen_addr"])},model:{value:e.formInfo.listen_addr,callback:function(t){e.$set(e.formInfo,"listen_addr",t)},expression:"formInfo.listen_addr"}})],1)],1),o("el-col",{attrs:{span:12}},[e.isModify?o("el-form-item",{attrs:{label:"exporter_port",prop:"exporter_port"}},[o("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["exporter_port"])},model:{value:e.formInfo.exporter_port,callback:function(t){e.$set(e.formInfo,"exporter_port",e._n(t))},expression:"formInfo.exporter_port"}})],1):e._e()],1),o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"mgr_token",prop:"mgr_token"}},[o("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["mgr_token"])},model:{value:e.formInfo.mgr_token,callback:function(t){e.$set(e.formInfo,"mgr_token",t)},expression:"formInfo.mgr_token"}})],1)],1)],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeDialog}},[e._v(e._s(e.$t("index.qu-xiao")))]),o("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("defineDatabasePage.ti-jiao")))])],1)],1)}),[],!1,d,"2d940a69",null,null);function d(e){for(let t in n)this[t]=n[t]}var g=function(){return l.exports}();export{g as default};
