import{a as e,s as o}from"./staticTools.84335405.js";import{c as t}from"./verificationRules.bef90446.js";import{A as s}from"./api_clusterManage.8c154fe5.js";import{n as i}from"./index.b91a9f18.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";const a={};var r=i({data(){return{activeName:"",leadingInZqpoolVisible:!1,oidIsdisabled:!0,row:null,formInfo:{zqpool_name:"",os_user:"zqpool",root_path:"/home/zqpool"},formInfoRules:{zqpool_name:[{required:!1,message:this.$t("addOrModifyPgHba.qingshuru-neirong",[this.$t("ConnectionPoolManagement.zqpool-mingcheng")]),trigger:"blur"}],host:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-zhuji"),trigger:"change"}],package_id:[{required:!0,message:this.$t("ConnectionPoolManagement.qingxuzne-chengxubao"),trigger:"change"}],os_user:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["os_user"]),trigger:"blur"},{required:!0,validator:(e,o,t)=>{if(o){let e={host:this.formInfo.host,user:o};s.checkOsUserExists(e).then((e=>{0===e.err_code?0!==e.exists?(this.oidIsdisabled=!0,this.$set(this.formInfo,"os_uid",e.exists),this.$refs.formInfo.clearValidate("os_uid"),t()):(this.oidIsdisabled=!1,this.$set(this.formInfo,"os_uid",716),this.$refs.formInfo.validateField("os_uid"),t()):t(new Error(e.err_msg))}),(e=>{t(new Error(e))}))}},trigger:"blur"}],os_uid:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["os_uid"]),trigger:"blur"},{type:"number",message:this.$t("createDatabasePage.qingshuru-shuzi"),trigger:"blur"},{required:!0,validator:(e,o,t)=>{if(o){if(this.oidIsdisabled)return t();let e={host:this.formInfo.host,os_uid:o};s.checkOsUidExists(e).then((e=>{0===e.err_code?0!==e.exists?t(new Error(this.$t("ConnectionPoolManagement.value-yicunzai",[o]))):t():t(new Error(e.err_msg))}),(e=>{t(new Error(e))}))}},trigger:"blur"}],root_path:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["root_path"]),trigger:"blur"},{required:!0,validator:t,trigger:"blur"}]},curHostOptions:{},curVerionOptions:{}}},props:["is-show"],methods:{submit(){this.$refs.formInfo.validate((t=>{if(t){let t=Object.assign({},this.formInfo);const i=e(".leadingInZqpoolDialog .el-dialog");s.addZqpool(t).then((e=>{o(this.$t("ConnectionPoolManagement.daoru-chenggong")),this.closeDialog(),this.$emit("refresh"),i.close()}),(e=>{i.close()}))}}))},async getInfo(){const o=e(".leadingInZqpoolDialog .el-dialog");try{await this.getDBHostList(),await this.getCsuPackageInfo(),o.close()}catch(t){o.close()}},getDBHostList(){return new Promise(((e,t)=>{s.getDBHostList().then((s=>{0===s.length&&(o(this.$t("createStreamReplicationCluster.shujuku-suozai-m"),"warning"),t(!1)),this.curHostOptions=s,e(!0)}),(e=>{t(!1)}))}))},getCsuPackageInfo(){return new Promise(((e,o)=>{s.getCsuPackageInfo({package_name:"zqpool"}).then((o=>{this.zqpoolConfs=o.rows,this.curVerionOptions=this.zqpoolConfs.map((e=>({package:e.package,package_id:e.package_id}))),this.curVerionOptions.length&&this.$set(this.formInfo,"package_id",this.curVerionOptions[0].package_id),e(!0)}),(e=>{o(!1)}))}))},closeDialog(){this.leadingInZqpoolVisible=!1,this.$emit("update:isShow",this.leadingInZqpoolVisible)}},created(){this.leadingInZqpoolVisible=this.$props.isShow},mounted(){this.getInfo()}},(function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("el-dialog",{staticClass:"leadingInZqpoolDialog",attrs:{"append-to-body":!0,title:e.$t("ConnectionPoolManagement.daoru-zqpool"),visible:e.leadingInZqpoolVisible,"close-on-click-modal":!1},on:{close:e.closeDialog,"update:visible":function(o){e.leadingInZqpoolVisible=o}}},[t("el-form",{ref:"formInfo",attrs:{model:e.formInfo,rules:e.formInfoRules,"label-width":"100px"}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("ConnectionPoolManagement.zqpool-mingcheng"),prop:"zqpool_name"}},[t("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",[e.$t("ConnectionPoolManagement.zqpool-mingcheng")])},model:{value:e.formInfo.zqpool_name,callback:function(o){e.$set(e.formInfo,"zqpool_name",o)},expression:"formInfo.zqpool_name"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("ConnectionPoolManagement.xuanze-zhuji"),prop:"host"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("createStreamReplicationCluster.qingshuru-zhuji")},model:{value:e.formInfo.host,callback:function(o){e.$set(e.formInfo,"host",o)},expression:"formInfo.host"}},e._l(e.curHostOptions,(function(o){return t("el-option",{key:o.hid,attrs:{label:o.ip,value:o.ip,disabled:1!==o.state||1===o.is_using||o.mem_size<64}},[t("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,placement:"top",disabled:o.mem_size>64&&1===o.state,effect:"dark",content:1!==o.state?e.$t("dbList.agent-yichang"):e.$t("createDatabasePage.gaizhuji-shengyu-message")}},[t("div",{staticClass:"clearfix"},[t("span",{staticClass:"fl"},[e._v(e._s(o.ip))]),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(o.hostname))])])])],1)})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:e.$t("ConnectionPoolManagement.xuanze-chengxubao"),prop:"package_id"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("ConnectionPoolManagement.qingxuzne-chengxubao")},model:{value:e.formInfo.package_id,callback:function(o){e.$set(e.formInfo,"package_id",o)},expression:"formInfo.package_id"}},e._l(e.curVerionOptions,(function(e){return t("el-option",{key:e.package_id,attrs:{label:e.package,value:e.package_id}})})),1)],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"os_user",prop:"os_user"}},[t("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["os_user"])},model:{value:e.formInfo.os_user,callback:function(o){e.$set(e.formInfo,"os_user",o)},expression:"formInfo.os_user"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"os_uid",prop:"os_uid"}},[t("el-input",{attrs:{disabled:e.oidIsdisabled,placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["os_uid"])},model:{value:e.formInfo.os_uid,callback:function(o){e.$set(e.formInfo,"os_uid",o)},expression:"formInfo.os_uid"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"root_path",prop:"root_path"}},[t("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["root_path"])},model:{value:e.formInfo.root_path,callback:function(o){e.$set(e.formInfo,"root_path",o)},expression:"formInfo.root_path"}})],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeDialog}},[e._v(e._s(e.$t("index.qu-xiao")))]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("defineDatabasePage.ti-jiao")))])],1)],1)}),[],!1,n,"32f68378",null,null);function n(e){for(let o in a)this[o]=a[o]}var l=function(){return r.exports}();export{l as default};
