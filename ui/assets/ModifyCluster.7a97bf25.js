var t=Object.defineProperty,e=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(e,i,a)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[i]=a,o=(t,o)=>{for(var r in o||(o={}))i.call(o,r)&&s(t,r,o[r]);if(e)for(var r of e(o))a.call(o,r)&&s(t,r,o[r]);return t};"undefined"!=typeof require&&require;import{A as r}from"./api_clusterManage.788b7961.js";import{a as l}from"./staticTools.84335405.js";import{c as n,a as d}from"./clusterInfo.959a0fa7.js";import{e as u,c}from"./verificationRules.43272891.js";import{n as p}from"./index.851f4377.js";import m from"./taskLog.d0e23faf.js";import{b as g}from"./bus.d56574c1.js";import"./index.dfdb83b1.js";import"./vendor.194c4086.js";const h={};var b=p({name:"dbList",components:{},data(){return{initialQueryParmsObj:{},loading_pgdata:!1,clusterState:this.$route.query.cluster_state,rows:[],total:0,page:1,size:20,olapage:1,roomList:[],upDbList:[],loading:!1,currentRow:"",editFormVisible:!1,editFormRules:{host:[{required:!0,message:this.$t("polarDbEditDBList.qingshuru-shujuku-suozai-message"),trigger:"blur"},{required:!0,validator:u,trigger:"blur"}],up_db_id:[{required:!0,message:this.$t("polarDbEditDBList.qingshuru-shujukude-shangyiji-zhuku"),trigger:"blur"}],repl_ip:[{required:!0,message:this.$t("polarDbEditDBList.qingshuru-shujuku-liufuzhi-message"),trigger:"blur"},{required:!0,validator:u,trigger:"blur"}],pgdata:[{required:!0,message:this.$t("defineDatabasePage.shuju-mulu-placeholder"),trigger:"blur"},{required:!0,validator:c,trigger:"blur"},{required:!0,validator:(t,e,i)=>{if(""===e)i(new Error(this.$t("verificationRules.qingshuru-shuji-mulu")));else{if(this.currentRow.pgdata==e&&this.currentRow.host==this.editForm.host)return i();{let t={host:this.editForm.host,pgdata:e};this.loading_pgdata=!0,r.checkPgdataIsUsed(t).then((t=>(this.loading_pgdata=!1,console.log(t),0==t.used||(1==t.used?i(new Error(this.$t("verificationRules.gaishuju-mulu-m"))):void 0))),(t=>(this.loading_pgdata=!1,i(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo")))))).then((e=>{1==e&&r.checkTheDirIsEmpty(t).then((t=>1==t.is_empty?i(new Error(this.$t("verificationRules.mulubucunzai-huoweikong"))):0==t.is_empty?i():i(new Error(t.err_msg))),(t=>i(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo")))))}))}}},trigger:"submit"}],repl_app_name:[{required:!0,message:this.$t("polarDbEditDBList.qingshuru-lianjiede-application_name"),trigger:"blur"}],scores:[{required:!0,message:this.$t("polarDbEditDBList.qingshuru-shujukude-qiehuan-youxianji"),trigger:"blur"},{type:"number",message:this.$t("createStreamReplicationCluster.youxianji-bixuwei-shuzi")}]},editForm:{},clupBtn:["import","create","distribution","del","standby","active","switch","stop","start","edit","create","restart","change","cancel","kill","cancel","kill","detail","create","import","del","standby","edit","see","offLine","onLine","detail","detail","plan","backup","detail","del","edit","import","del","detail","log","recovery","log","monitor","open","start","edit","del","add","edit","del","see","edit","offLine","edit","host","database","session","lock","modify","move","upgrade","bounce"],language:""}},watch:{"editForm.is_rewind":function(t){t||(this.editForm.is_rebuild=!1)},"editForm.is_rebuild":function(t){t&&(this.editForm.is_rewind=!0)}},computed:{addFormPort(){var t;return null==(t=this.upDbList.find((t=>t.db_id==this.addForm.up_db_id)))?void 0:t.port}},methods:{blurIpListFunc(){},funChandleClick:function(t){const e=this;let i="",a=window.location.href.split("?")[1],s=new URLSearchParams(a);s.has("hidmenu")&&(i=s.get("hidmenu")),"conversation"==t.type?e.wantConversationBtn(t.row,i):"lock"==t.type&&e.wantLockBtn(t.row,i)},wantConversationBtn:function(t,e){this.$router.push({path:"/SessionManage",query:o({data:t},""!=e&&{hidmenu:e})})},wantLockBtn:function(t,e){this.$router.push({path:"/lockManage",query:o({data:t},""!=e&&{hidmenu:e})})},composeValue:(t,e,i)=>({type:t,index:e,row:i}),tableRowClassName:({row:t,rowIndex:e})=>e%2!=0?"warning-row":"success-row",handleSizeChange(t){this.size=t,this.oldpage=this.page,this.showdbList()},handleCurrentChange(t){this.page=t,this.oldpage=this.page,this.showdbList()},showdbList:function(){let t=this;t.loading=!0;let e={page_size:t.$route.query.page_size,page_num:t.$route.query.page_num,cluster_id:t.$route.query.cluster_id};r.getdbList(e).then((function(e){t.loading=!1,e&&e.rows&&(t.total=e.total,t.rows=e.rows,null!=t.$refs.pagination&&(t.$refs.pagination.internalCurrentPage=t.oldpage)),t.$nextTick((()=>{let e=window.location.href.split("?")[1],i=new URLSearchParams(e);if(i.has("hidmenu")){let e=i.get("hidmenu").split(","),a=t.clupBtn.filter((t=>e.indexOf(t)<0));for(let t=0;t<a.length;t++){let e=document.getElementsByClassName(""+a[t]);for(let t=0;t<e.length;t++)e[t].setAttribute("style","display:none")}}}))}),(function(e){t.loading=!1}))},showEditDialog:function(t,e){const i=this;let a={cluster_id:i.$route.query.cluster_id},s={page_size:1e4,page_num:1,cluster_id:i.$route.query.cluster_id};const o=l(".modifyDialog .el-dialog");i.editFormVisible=!0,r.getdbList(s).then((function(t){t&&t.rows&&(i.upDbList=t.rows),r.getSrClusterRoomInfo(a).then((function(t){i.roomList=t,i.currentRow=e,o.close(),i.editForm=Object.assign({},e),null==i.editForm.scores&&(i.editForm.scores=0)}),(function(t){o.close(),i.editFormVisible=!1}))}),(function(t){o.close(),i.editFormVisible=!1}))},editFormSubmit:function(){let t=this;this.$refs.editForm.validate((e=>{if(e){const e=l(".modifyDialog .el-dialog");let i={cluster_id:t.currentRow.cluster_id,db_id:t.currentRow.db_id};i.room_id=t.editForm.room_id,t.editForm.host!==t.currentRow.host&&(i.host=t.editForm.host),t.editForm.repl_ip!==t.currentRow.repl_ip&&(i.repl_ip=t.editForm.repl_ip),t.editForm.scores!==t.currentRow.scores&&(i.scores=t.editForm.scores),t.editForm.pgdata!==t.currentRow.pgdata&&(i.pgdata=t.editForm.pgdata),t.editForm.up_db_id!==t.currentRow.up_db_id&&(i.up_db_id=t.editForm.up_db_id),t.editForm.repl_app_name!==t.currentRow.repl_app_name&&(i.repl_app_name=t.editForm.repl_app_name),null!=t.editForm.is_rebuild&&(i.is_rebuild=t.editForm.is_rebuild),null!=t.editForm.rm_pgdata&&(i.rm_pgdata=t.editForm.rm_pgdata),null!=t.editForm.is_rewind&&(i.is_rewind=t.editForm.is_rewind),r.edit(i).then((function(){e.close(),t.$refs.editForm.resetFields(),t.editFormVisible=!1,t.showdbList()}),(function(t){e.close()}))}}))},deldbList:function(t,e){let i=this;this.$confirm(this.$t("polarDbEditDBList.cicaozuodian-cunzaifengxian-message"),this.$t("polarDbEditDBList.jing-gao"),{type:"warning",closeOnClickModal:!1}).then((()=>{i.loading=!0;let t={cluster_id:e.cluster_id,db_id:e.db_id};r.deletedbList(t).then((function(){i.loading=!1;let t=Math.ceil((i.total-1)/i.size),e=i.page>t?t:i.page;i.page=e<1?1:e,i.showdbList()}),(function(t){i.loading=!1}))})).catch((()=>{}))}},mounted:function(){this.initialQueryParmsObj=this.$route.query,this.showdbList(),this.language=localStorage.getItem("language_clup")},destroyed(){clearInterval(this.intervalID)}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-row",[i("el-col",[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"row-class-name":t.tableRowClassName,data:t.rows,border:"","element-loading-text":t.$t("Public.ping-ming-jia-zai-zhong")}},[i("el-table-column",{attrs:{prop:"db_id",label:t.$t("switchDatabasePage.shujuku-ID"),align:"center",width:"120px"}}),i("el-table-column",{attrs:{prop:"up_db_id",label:t.$t("polarDbEditDBList.shangji-zhuku"),align:"center",width:"en"==t.language?"140px":"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[2!==e.row.state?i("span",[t._v(" "+t._s(e.row.up_db_id)+" ")]):t._e(),2==e.row.state?i("del",{staticStyle:{"text-decoration":"line-through",color:"#000"}},[i("span",{staticStyle:{color:"#9a9a9a"}},[t._v(" "+t._s(e.row.up_db_id)+" ")])]):t._e()]}}])}),i("el-table-column",{attrs:{prop:"state",label:t.$t("polarDbEditDBList.HA-zhuangtai"),align:"left","header-align":"center",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.state?i("i",{staticClass:"el-icon-s-flag green"},[i("span",{staticClass:"statefont"},[t._v(" Normal")])]):2===e.row.state?i("i",{staticClass:"el-icon-error red"},[i("span",{staticClass:"statefont"},[t._v(" Fault")])]):3===e.row.state?i("span",[i("i",{staticClass:"el-icon-loading orange"}),t._v(" "),i("span",{staticClass:"statefont"},[t._v(" Failover")])]):4===e.row.state?i("span",[i("i",{staticClass:"el-icon-loading black"}),i("span",{staticClass:"statefont"},[t._v(" Switching")])]):5===e.row.state?i("span",[i("i",{staticClass:"el-icon-loading green"}),t._v(" "),i("span",{staticClass:"statefont"},[t._v(" Repairing")])]):t._e()]}}])}),i("el-table-column",{attrs:{prop:"is_primary",label:t.$t("dbList.zhu-bei-ku"),align:"center",width:"140px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.is_primary&&2!==e.row.state?i("span",[t._v(" "+t._s(t.$t("replDelay.zhu")))]):t._e(),0===e.row.is_primary&&2!==e.row.state?i("span",[t._v(" "+t._s(t.$t("replDelay.bei")))]):t._e(),1===e.row.is_primary&&2==e.row.state?i("del",{staticStyle:{"text-decoration":"line-through",color:"#000"}},[i("span",{staticStyle:{color:"#9a9a9a"}},[t._v(t._s(t.$t("replDelay.zhu")))])]):t._e(),0===e.row.is_primary&&2==e.row.state?i("del",{staticStyle:{"text-decoration":"line-through",color:"#000"}},[i("span",{staticStyle:{color:"#9a9a9a"}},[t._v(t._s(t.$t("replDelay.bei")))])]):t._e()]}}])}),i("el-table-column",{attrs:{prop:"host",label:t.$t("replDelay.suozai-zhuji"),align:"center",width:"180px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-dropdown",{attrs:{trigger:"click"},on:{command:t.funChandleClick}},[i("span",{staticClass:"el-dropdown-link",staticStyle:{color:"#0070cc","font-weight":"500"}},[t._v(" "+t._s(e.row.host)),i("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{staticClass:"session",attrs:{command:t.composeValue("conversation",e.$index,e.row)}},[t._v(t._s(t.$t("dbList.huihua-jiankong"))+" ")]),i("el-dropdown-item",{staticClass:"lock",attrs:{command:t.composeValue("lock",e.$index,e.row)}},[t._v(t._s(t.$t("dbList.suo-guan-li"))+" ")])],1)],1)]}}])}),i("el-table-column",{attrs:{prop:"repl_ip",label:t.$t("polarDbEditDBList.liufuzhi-IP"),align:"center",width:"140px"}}),i("el-table-column",{attrs:{prop:"room_name",label:t.$t("dbList.jifang-mingcheng"),align:"center",width:"140px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"statefont"},[t._v(" "+t._s("默认机房"==e.row.room_name?t.$t("dbList.moren-jifang"):e.row.room_name))])]}}])}),i("el-table-column",{attrs:{prop:"pgdata",label:t.$t("defineDatabasePage.shuju-mulu"),align:"center","header-align":"center","min-width":"160px","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"scores",label:t.$t("createStreamReplicationCluster.youxianji"),align:"center","header-align":"center","min-width":"60px","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(" "+t._s(null==e.row.scores?"0":e.row.scores))])]}}])}),i("el-table-column",{attrs:{prop:"db_state",label:t.$t("dbList.zhuang-tai"),align:"left","header-align":"center",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[2===e.row.db_state?i("span",[i("i",{staticClass:"el-icon-loading"}),i("span",{staticClass:"statefont"},[t._v(" "+t._s(t.$t("dbList.chuang-jian-zhong")))])]):t._e(),0===e.row.db_state?i("i",{staticClass:"el-icon-success green"},[i("span",{staticClass:"statefont"},[t._v(" "+t._s(t.$t("dbList.yun-xing-zhong")))])]):1===e.row.db_state?i("i",{staticClass:"el-icon-info"},[i("span",{staticClass:"statefont"},[t._v(" "+t._s(t.$t("dbList.ting-zhi")))])]):-1===e.row.db_state?i("i",{staticClass:"el-icon-warning orange"},[i("span",{staticClass:"statefont"},[t._v(" "+t._s(t.$t("dbList.agent-yichang")))])]):4===e.row.db_state?i("i",{staticClass:"el-icon-error red"},[i("span",{staticClass:"statefont"},[t._v(t._s(t.$t("dbLists.chuangjian-shibai")))])]):t._e()]}}])}),i("el-table-column",{attrs:{prop:"handle",label:t.$t("clusterDefine.caozuo"),align:"center",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==t.clusterState||-1==t.clusterState?i("span",[i("el-link",{staticClass:"normal modify",on:{click:function(i){return t.showEditDialog(e.$index,e.row)}}},[t._v(t._s(t.$t("alarmSet.xiugai")))]),1!==e.row.is_primary?i("el-link",{staticClass:"normal move",on:{click:function(i){return t.deldbList(e.$index,e.row)}}},[t._v(t._s(t.$t("alarmInformationConfig.yichu")))]):t._e()],1):t._e()]}}])})],1),i("div",{staticClass:"block",staticStyle:{float:"right"}},[i("el-pagination",{ref:"pagination",attrs:{layout:"total, sizes, prev, pager, next, jumper",total:t.total,"page-sizes":[20,30,40,50,100]},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),i("el-dialog",{staticClass:"modifyDialog",attrs:{title:t.$t("alarmSet.xiugai"),"append-to-body":!0,visible:t.editFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.editFormVisible=e}}},[i("el-form",{ref:"editForm",staticStyle:{width:"90%"},attrs:{model:t.editForm,"label-width":"en"==t.language?"150px":"140px",rules:t.editFormRules}},[i("el-form-item",{attrs:{label:t.$t("dbList.jiqun-id"),prop:"cluster_id"}},[i("el-input",{attrs:{readonly:""},model:{value:t.editForm.cluster_id,callback:function(e){t.$set(t.editForm,"cluster_id",e)},expression:"editForm.cluster_id"}})],1),i("el-form-item",{attrs:{label:t.$t("switchDatabasePage.shujuku-ID"),prop:"db_id"}},[i("el-input",{model:{value:t.editForm.db_id,callback:function(e){t.$set(t.editForm,"db_id",e)},expression:"editForm.db_id"}})],1),i("el-form-item",{attrs:{label:t.$t("createStreamReplicationCluster.youxianji"),prop:"scores"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("polarDbEditDBList.youxainji-dec"),placement:"top-start"}},[i("el-input",{model:{value:t.editForm.scores,callback:function(e){t.$set(t.editForm,"scores",t._n(e))},expression:"editForm.scores"}})],1)],1),i("el-form-item",{attrs:{label:t.$t("replDelay.suozai-zhuji"),prop:"host"}},[i("el-input",{model:{value:t.editForm.host,callback:function(e){t.$set(t.editForm,"host",e)},expression:"editForm.host"}})],1),0==t.editForm.is_primary?i("el-form-item",{attrs:{label:t.$t("polarDbEditDBList.shangji-zhuku-ID"),prop:"up_db_id"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("polarDbEditDBList.gaicaozuo-buhuixiugai-message"),placement:"top-start"}},[i("el-select",{attrs:{placeholder:t.$t("createDatabasePage.qing-xuan-ze")},model:{value:t.editForm.up_db_id,callback:function(e){t.$set(t.editForm,"up_db_id",e)},expression:"editForm.up_db_id"}},t._l(t.upDbList,(function(e,a){return i("el-option",{key:a,attrs:{disabled:e.host==t.editForm.host,label:e.host+":"+e.port,value:e.db_id}})})),1)],1)],1):t._e(),i("el-form-item",{attrs:{label:"application_name",prop:"repl_app_name"}},[i("el-input",{model:{value:t.editForm.repl_app_name,callback:function(e){t.$set(t.editForm,"repl_app_name",e)},expression:"editForm.repl_app_name"}})],1),i("el-form-item",{attrs:{label:t.$t("polarDbEditDBList.liufuzhi-IP"),prop:"repl_ip"}},[i("el-input",{model:{value:t.editForm.repl_ip,callback:function(e){t.$set(t.editForm,"repl_ip",e)},expression:"editForm.repl_ip"}})],1),i("el-form-item",{directives:[{name:"loading",rawName:"v-loading",value:t.loading_pgdata,expression:"loading_pgdata"}],attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0)",label:t.$t("defineDatabasePage.shuju-mulu"),prop:"pgdata"}},[i("el-input",{model:{value:t.editForm.pgdata,callback:function(e){t.$set(t.editForm,"pgdata",e)},expression:"editForm.pgdata"}})],1),i("el-form-item",{attrs:{label:t.$t("polarDbEditDBList.suozai-jifang"),prop:"room_id"}},[i("el-select",{attrs:{placeholder:t.$t("createDatabasePage.qing-xuan-ze")},model:{value:t.editForm.room_id,callback:function(e){t.$set(t.editForm,"room_id",e)},expression:"editForm.room_id"}},t._l(t.roomList,(function(e,a){return i("el-option",{key:a,attrs:{label:"默认机房"==e.room_name?t.$t("dbList.moren-jifang"):e.room_name,value:e.room_id}})})),1)],1),i("div",{staticStyle:{"text-align":"center",color:"#282828"}},[i("el-divider",{attrs:{"content-position":"center"}},[t._v(t._s(t.$t("polarDbEditDBList.guzhanghou-zidongjiahui-message")))])],1),i("el-form-item",{attrs:{label:"pg_rewind",prop:"is_rewind"}},[i("el-checkbox",{model:{value:t.editForm.is_rewind,callback:function(e){t.$set(t.editForm,"is_rewind",e)},expression:"editForm.is_rewind"}}),i("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:t.$t("polarDbEditDBList.shiyong-pg_rewind-huifu-message"),placement:"top-start"}},[i("i",{staticClass:"el-icon-question",staticStyle:{"margin-left":"10px",color:"#afaeae"}})])],1),i("el-form-item",{attrs:{label:t.$t("polarDbEditDBList.chongxindajian-beiku")}},[i("el-checkbox",{model:{value:t.editForm.is_rebuild,callback:function(e){t.$set(t.editForm,"is_rebuild",e)},expression:"editForm.is_rebuild"}}),t.editForm.is_rebuild?i("div",{staticStyle:{"margin-left":"20px","font-size":"14px",display:"inline-block"}},[i("el-radio",{attrs:{label:0},model:{value:t.editForm.rm_pgdata,callback:function(e){t.$set(t.editForm,"rm_pgdata",e)},expression:"editForm.rm_pgdata"}},[t._v(t._s(t.$t("polarDbEditDBList.chongmingming-jiude-shujuku")))]),i("el-radio",{staticStyle:{"margin-right":"80px"},attrs:{label:1},model:{value:t.editForm.rm_pgdata,callback:function(e){t.$set(t.editForm,"rm_pgdata",e)},expression:"editForm.rm_pgdata"}},[t._v(t._s(t.$t("polarDbEditDBList.shanchu-yuanyou-shujumulu"))+" ")])],1):t._e()],1),i("el-form-item",[i("p",{staticStyle:{color:"red","font-size":"14px"}},[t._v(" "+t._s(t.$t("baseInfo.jinggao-xiugai-shili-warning-m")))])])],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(e){t.editFormVisible=!1}}},[t._v(t._s(t.$t("index.qu-xiao")))]),i("el-button",{attrs:{type:"primary",loading:t.loading},nativeOn:{click:function(e){return t.editFormSubmit(e)}}},[t._v(t._s(t.$t("defineDatabasePage.ti-jiao")))])],1)],1)],1)],1)}),[],!1,_,"c5297e60",null,null);function _(t){for(let e in h)this[e]=h[e]}var f=function(){return b.exports}();const w={};var y=p({name:"dbList",inject:["reload"],components:{taskLog:m},data:()=>({rows:[],total:0,page:1,size:20,oldpage:1,loading:!1}),methods:{tableRowClassName:({row:t,rowIndex:e})=>e%2!=0?"warning-row":"success-row",handleSizeChange(t){this.size=t,this.oldpage=this.page,this.showHostList()},handleCurrentChange(t){this.page=t,this.oldpage=this.page,this.showHostList()},showHostList:function(){let t=this;t.loading=!0;let e={page_size:t.$route.query.page_size,page_num:t.$route.query.page_num,cluster_id:t.$route.query.cluster_id};r.getHostList(e).then((function(e){t.loading=!1,e&&e.rows&&(t.total=e.total,t.rows=e.rows,null!=t.$refs.pagination&&(t.$refs.pagination.internalCurrentPage=t.oldpage))}),(function(e){t.loading=!1}))},SdClusterSwitch:function(t,e){let i=this;this.$confirm(this.$t("polarDbEditHostList.ninqueding-yaojiangshujuku-qiehuandao-zhuji")+e.ip+this.$t("polarDbEditHostList.yunxingma-message"),this.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{i.loading=!0;let t={cluster_id:e.cluster_id,ip:e.ip};r.sdSwitch(t).then((function(t){i.loading=!1,i.$refs.tasklog.openDialog(t.task_id,i.showHostList,2),i.showHostList()}),(function(t){i.loading=!1}))})).catch((t=>{}))}},mounted:function(){this.showHostList()}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-row",[i("el-col",[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{"row-class-name":t.tableRowClassName,data:t.rows,border:"","element-loading-text":t.$t("Public.ping-ming-jia-zai-zhong")}},[i("el-table-column",{attrs:{prop:"db_state",label:t.$t("polarDbEditHostList.DB-zhuangtai"),align:"center","min-width":"80px"}}),i("el-table-column",{attrs:{prop:"vip_state",label:t.$t("polarDbEditHostList.VIP-zhuangtai"),align:"center","min-width":"80px"}}),i("el-table-column",{attrs:{prop:"is_primary",label:t.$t("dashboard.zhu-bei"),align:"center","min-width":"80px"}}),i("el-table-column",{attrs:{prop:"ip",label:t.$t("polarDbEditHostList.jiqi-IP"),align:"center","min-width":"130px"}}),i("el-table-column",{attrs:{prop:"handle",label:t.$t("clusterDefine.caozuo"),align:"center","min-width":"165px"},scopedSlots:t._u([{key:"default",fn:function(t){}}])})],1),i("div",{staticClass:"block",staticStyle:{float:"right"}},[i("el-pagination",{ref:"pagination",attrs:{layout:"total, sizes, prev, pager, next, jumper",total:t.total,"page-sizes":[20,30,40,50,100]},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)],1)}),[],!1,$,"55058289",null,null);function $(t){for(let e in w)this[e]=w[e]}const v={};var x=p({name:"ModifyCluster",inject:["reload"],components:{clusterInfo:n,editDBList:f,editHostList:function(){return y.exports}(),computerRoomConfig:d},data:()=>({activeName:"clusterInfo",dialogWidth:0,isSmallSidebar:1,row:{},modifyShow:!1,tabShow:!0,clusterType:"",clusterName:"",clusterState:"",Permission_repu:!1}),methods:{clusterOffline(){const t=JSON.parse(JSON.stringify(this.$route.query));this.$confirm(this.$t("HAManage.queren-jiang-message")+t.cluster_id+this.$t("HAManage.lixianma"),this.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{const e=l(".component");let i={cluster_id:t.cluster_id};r.offline(i).then((()=>{t.cluster_state=0,this.$router.replace({query:t}),this.refresh(),this.$message.success({showClose:!0,message:this.$t("ModifyCluster.lixian-chenggong"),duration:2e3}),e.close()}),(t=>e.close()))})).catch((()=>{}))},refresh(){this.tabShow=!1,this.$nextTick((()=>this.tabShow=!0))},updateTable:function(){this.modifyShow=!1,this.$emit("refreshTable")},openDialog:function(t){const e=this;this.$router.push({query:{}}),this.$router.push({query:t}),0==document.getElementsByClassName("showSidebar").length?(e.isSmallSidebar=1,e.dialogWidth=document.body.clientWidth-60):(e.dialogWidth=document.body.clientWidth-180,e.isSmallSidebar=2),e.row=t,e.modifyShow=!0,this.clusterName=t.cluster_name,this.clusterType=t.cluster_type,this.clusterState=t.cluster_state,this.tabShow=!1,this.$nextTick((()=>this.tabShow=!0)),2===this.clusterType&&(this.activeName="clusterInfo")}},mounted:function(){g.$on("Permission_repu",(t=>{this.Permission_repu=t}))}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{ref:"queryLog",attrs:{title:t.$t("polarDbModifyCluster.jiqunmingcheng")+t.clusterName+", ID="+t.row.cluster_id,"append-to-body":!0,"custom-class":1==t.isSmallSidebar?"querylog querylogmin":"querylog querylogmax",modal:!1,width:t.dialogWidth+"px",top:"0",visible:t.modifyShow,"close-on-click-modal":!0},on:{close:t.updateTable,"update:visible":function(e){t.modifyShow=e}}},[i("el-row",{staticClass:"warp"},[i("el-col",{staticClass:"warp-breadcrum",attrs:{span:24}},[i("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:t.refresh}},[t._v(t._s(t.$t("resourceManagement.shua-xin")))]),"clusterInfo"===t.activeName&&1===t.$route.query.cluster_state?i("div",{staticClass:"warp-breadcrum_words"},[i("span",[t._v(t._s(t.$t("ModifyCluster.lixian-m")))]),i("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:t.clusterOffline}},[t._v(t._s(t.$t("dashboard.li-xian")))])],1):t._e()],1),i("el-col",{staticClass:"warp-main",attrs:{span:24}},[1===t.clusterType||"1"===t.clusterType?[i("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:t.$t("createStreamReplicationCluster.jiqun-xinxi"),name:"clusterInfo"}}),i("el-tab-pane",{attrs:{label:t.$t("polarDbModifyCluster.zhubei-shujuku"),name:"editDBList"}}),t.Permission_repu?t._e():i("el-tab-pane",{attrs:{label:t.$t("polarDbModifyCluster.jifang-peizhi"),name:"computerRoomConfig"}})],1)]:2===t.clusterType||"2"===t.clusterType?[i("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:t.$t("createStreamReplicationCluster.jiqun-xinxi"),name:"clusterInfo"}}),i("el-tab-pane",{attrs:{label:t.$t("ModifyCluster.zhubei-jiqi"),name:"editHostList"}})],1)]:t._e(),t.tabShow?i(t.activeName,{tag:"component",staticClass:"component"}):t._e()],2)],1)],1)],1)}),[],!1,F,"bbb631ea",null,null);function F(t){for(let e in v)this[e]=v[e]}var k=function(){return x.exports}();export{k as default};
