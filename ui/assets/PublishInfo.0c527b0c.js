import{n as t,_ as e}from"./index.851f4377.js";import{A as l}from"./api_operationTools.441466ef.js";import{s}from"./staticTools.84335405.js";import{m as i}from"./dynamicTools.f0febdba.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";const a={};var o=t({data(){return{loading:!1,creat_Publish_visible:!1,paginationInfo:{currentPage:1,size:10,total:0},filters:{cluster_name:"",host:"",slot_type:""},publicationList:[],clusterList:[],HostList:[],TypeList:[],slotList:[],filterTotalArray:[],clusterName:"",hostDress:"",soltType:"",way:"",selectedCommand:"",margeObj:{},margeArr:["cluster_name"],currentCommon:-1,dbShowList:[{label:this.$t("PublicInfo.fabu-xinxi"),type:1,isShow:!0,dbType:1},{label:this.$t("PublicInfo.dingyue-xinxi"),type:2,isShow:!0,dbType:11}]}},components:{CreatPublish:()=>e((()=>import("./addOrModifyPublishList.8e2df5f0.js")),["assets/addOrModifyPublishList.8e2df5f0.js","assets/addOrModifyPublishList.32b3605a.css","assets/staticTools.84335405.js","assets/vendor.194c4086.js","assets/api_operationTools.441466ef.js","assets/index.dfdb83b1.js","assets/bus.d56574c1.js","assets/index.851f4377.js","assets/index.738ab243.css"])},computed:{computedSlotList:function(){return this.publicationList}},methods:{refresh(){console.log("刷新"),location.reload(!1)},modify(t){this.data_rows=t,this.way="modify",this.creat_Publish_visible=!0},creat(){this.data_rows={},this.way="creat",this.creat_Publish_visible=!0},handleSizeChange(t){this.size=t,this.total=0,this.showList()},sizeChange(t){this.paginationInfo.size=t,this.getInfo()},currentChange(t){this.paginationInfo.currentPage=t,this.getInfo()},checkboxChange(){this.showList()},showList(){console.log(this.filters);let t=this.slotList;console.log(t),t=t.filter((t=>Object.keys(this.filters).every((e=>""===this.filters[e]||-1!==t[e].indexOf(this.filters[e]))))),console.log(t),this.filterTotalArray=t},filterFunc:(t,e,l)=>(console.log(t),null==t||""==t?l:l.filter((l=>(console.log(l),l[e].indexOf(t)>-1)))),delate(t){console.log(t);let e={slot_id:t.slot_id};"physical"==t.slot_type?i(this.$t("poolList.shifoushanchu-vip-chi-m",[t.slot_id])).then((()=>{this.loading=!0,l.delPhysicalSlot(e).then((t=>{this.loading=!1,s(this.$t("alarmInformationConfig.shanchu-chenggong")),this.getInfo()}),(t=>{this.loading=!1}))})).catch((t=>{})):i(this.$t("poolList.shifoushanchu-vip-chi-m",[t.slot_id])).then((()=>{this.loading=!0,l.delLogicalSlot(e).then((t=>{this.loading=!1,s(this.$t("alarmInformationConfig.shanchu-chenggong")),this.getInfo()}))})).catch((t=>{}))},checkPGType(t){console.log(t),this.selectedCommand=t,t&&this.creat()},getInfo(){this.filters.cluster_name="",this.filters.host="",this.filters.slot_type="";let t={page_size:this.paginationInfo.size,page_num:this.paginationInfo.currentPage};this.loading=!0,l.getpublicationList(t).then((t=>{this.publicationList=t.rows})),l.getSlotList(t).then((t=>{this.paginationInfo.total=t.total,console.log(t),this.slotList=t.rows,this.filterTotalArray=t.rows,this.filterTotalArray.sort(((t,e)=>t.cluster_name===e.cluster_name?t.db_id-e.db_id:t.cluster_name.localeCompare(e.cluster_name))),this.findMargeDataInfo(this.filterTotalArray),this.loading=!1;let e=t.rows;this.clusterList=[...new Set(e.map((t=>t.cluster_name)))],this.HostList=[...new Set(e.map((t=>t.host)))],this.TypeList=[...new Set(e.map((t=>t.slot_type)))]}),(t=>{this.loading=!1}))},findMargeDataInfo(t){this.margeArr.forEach((e=>{let l=0;this.margeObj[e]=[];let s=null;t.forEach((t=>{const i=t[e];null===s||i!==s?(l+=1,s=i,this.margeObj[e].push(1)):(this.margeObj[e][l-1]+=1,this.margeObj[e].push(0))}))}))},arraySpanMethod({row:t,column:e,rowIndex:l,columnIndex:s}){if(this.margeArr.includes(e.property)){let t=this.margeObj[e.property][l];return t?[t,1]:[0,0]}},rowClassName({row:t}){return t.cluster_name===this.currentCommon?"my-hover-row":""},cellMouseEnter(t,e,l,s){this.currentCommon=t.cluster_name},cellMouseLeave(){this.currentCommon=-1}},mounted(){this.getInfo()}},(function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",[l("el-form",{staticClass:"filterForm",attrs:{"label-width":"80px",model:t.filters},nativeOn:{submit:function(t){t.preventDefault()}}},[l("el-form-item",{attrs:{label:t.$t("ReSlotInfo.jiqun-mingcheng")}},[l("el-select",{attrs:{placeholder:t.$t("ReSlotInfo.jiqun-mingcheng"),clearable:""},on:{change:t.checkboxChange},model:{value:t.filters.cluster_name,callback:function(e){t.$set(t.filters,"cluster_name",e)},expression:"filters.cluster_name"}},t._l(t.clusterList,(function(t,e){return l("el-option",{key:e,attrs:{label:t,value:t}})})),1)],1),l("el-form-item",{attrs:{label:t.$t("ReSlotInfo.zhuji-dizhi")}},[l("el-select",{attrs:{placeholder:t.$t("ReSlotInfo.zhuji-dizhi"),clearable:""},on:{change:t.checkboxChange},model:{value:t.filters.host,callback:function(e){t.$set(t.filters,"host",e)},expression:"filters.host"}},t._l(t.HostList,(function(t,e){return l("el-option",{key:e,attrs:{label:t,value:t}})})),1)],1),l("el-form-item",{attrs:{label:"类型"}},[l("el-select",{attrs:{placeholder:"类型",clearable:""},on:{change:t.checkboxChange},model:{value:t.filters.slot_type,callback:function(e){t.$set(t.filters,"slot_type",e)},expression:"filters.slot_type"}},t._l(t.TypeList,(function(t,e){return l("el-option",{key:e,attrs:{label:t,value:t}})})),1)],1),l("el-form-item",{staticStyle:{flex:"1","text-align":"right",color:"red"}},[l("el-button",{staticClass:"normal el-icon-refresh-right",on:{click:t.getInfo}},[t._v(" "+t._s(t.$t("resourceManagement.shua-xin")))]),l("el-dropdown",{staticClass:"create",staticStyle:{"margin-right":"10px"},on:{command:t.checkPGType}},[l("el-button",{attrs:{type:"primary"}},[t._v(" "+t._s(t.$t("PublicInfo.chuangjian-fabudingyue"))),l("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),l("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t._l(t.dbShowList,(function(e,s){return[e.isShow?l("el-dropdown-item",{key:s,attrs:{command:e.type}},[t._v(t._s(e.label))]):t._e()]}))],2)],1)],1)],1),l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"row-class-name":t.rowClassName,"span-method":t.arraySpanMethod,data:t.computedSlotList,border:"","element-loading-text":t.$t("Public.ping-ming-jia-zai-zhong")},on:{"cell-mouse-enter":t.cellMouseEnter,"cell-mouse-leave":t.cellMouseLeave}},[l("el-table-column",{attrs:{prop:"cluster_name",label:"集群名称",align:"center"}}),l("el-table-column",{attrs:{prop:"slot_id",label:"slot_id",align:"center"}}),l("el-table-column",{attrs:{prop:"db_id",label:"db_id",align:"center"}}),l("el-table-column",{attrs:{prop:"host",label:"host",align:"center"}}),l("el-table-column",{attrs:{prop:"slot_name",label:"slot_name",align:"center"}}),l("el-table-column",{attrs:{prop:"slot_type",label:"slot_type",align:"center"}}),l("el-table-column",{attrs:{prop:"catalog_xmin",label:"catalog_xmin",align:"center"}}),l("el-table-column",{attrs:{prop:"restart_lsn",label:"restart_lsn",align:"center"}}),l("el-table-column",{attrs:{prop:"confirmed_flush_lsn",label:"confirmed_flush_lsn",align:"center"}}),l("el-table-column",{attrs:{prop:"active",label:"active",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.active?l("span",[t._v("true")]):l("span",[t._v("false")])]}}])}),l("el-table-column",{attrs:{label:t.$t("dbList.cao-zuo"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[l("el-link",{staticClass:"detail",attrs:{size:"mini",disabled:!s.active&&"physical"==s.slot_type},on:{click:function(e){return t.delate(s)}}},[t._v(t._s(t.$t("dbList.shan-chu")))]),"logical"==s.slot_type?l("el-link",{staticClass:"detail",attrs:{size:"mini"},on:{click:function(e){return t.modify(s)}}},[t._v(t._s(t.$t("alarmSet.xiugai")))]):t._e()]}}])})],1),l("div",{staticClass:"block clearfix"},[l("div",{staticClass:"fr"},[l("el-pagination",{ref:"pagination",attrs:{layout:"total, sizes, prev, pager, next, jumper","page-size":t.paginationInfo.size,"current-page":t.paginationInfo.currentPage,total:t.paginationInfo.total,"page-sizes":[10,20,30,40,50]},on:{"size-change":t.sizeChange,"current-change":t.currentChange}})],1)]),t.creat_Publish_visible?l("CreatPublish",{ref:"addOrModifyPublishList",attrs:{"is-show":t.creat_Publish_visible,"data-way":t.way,"data-rows":t.data_rows,select:t.selectedCommand},on:{refresh:t.getInfo,"update:isShow":function(e){t.creat_Publish_visible=e},"update:is-show":function(e){t.creat_Publish_visible=e},"update:select":function(e){t.selectedCommand=e}}}):t._e()],1)}),[],!1,n,"112d9d84",null,null);function n(t){for(let e in a)this[e]=a[e]}var r=function(){return o.exports}();export{r as default};
