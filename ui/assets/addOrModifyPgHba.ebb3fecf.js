import{A as e}from"./api_dbManage.0ed831fd.js";import{a as t,s}from"./staticTools.84335405.js";import{n as a}from"./index.851f4377.js";import"./index.dfdb83b1.js";import"./vendor.194c4086.js";import"./bus.d56574c1.js";const o={};var d=a({data(){return{addOrModifyPgHbaVisible:!1,isUsedNetMask:!0,typeIsLocal:!1,is_reload:!0,optionsIsIncludeMap:!1,userIsMultiple:!0,type:"",typeTitle:"",db_id:"",line_number:"",modelInfoFrom:{},modelInfoFromRules:{type:[{required:!0,message:this.$t("createDatabasePage.qingxuanze-neirong",["Type"]),trigger:"change"}],database:[{required:!0,message:this.$t("createDatabasePage.qingxuanze-neirong",["Database"]),trigger:"change"}],user_name:[{required:!0,message:this.$t("createDatabasePage.qingxuanze-neirong",["User Name"]),trigger:"change"}],address:[{required:!1,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["Address"]),trigger:"blur"}],netmask:[{required:!1,validator:(e,t,s)=>{if(t)if(-1!==t.indexOf(".")){/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/.test(t)?s():s(new Error("IPV4"+this.$t("addOrModifyPgHba.geshiyouwu-qingjiacha")))}else{/^([\da-fA-F]{1,4}:){6}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^::([\da-fA-F]{1,4}:){0,4}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:):([\da-fA-F]{1,4}:){0,3}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:){2}:([\da-fA-F]{1,4}:){0,2}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:){3}:([\da-fA-F]{1,4}:){0,1}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:){4}:((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$|^([\da-fA-F]{1,4}:){7}[\da-fA-F]{1,4}$|^:((:[\da-fA-F]{1,4}){1,6}|:)$|^[\da-fA-F]{1,4}:((:[\da-fA-F]{1,4}){1,5}|:)$|^([\da-fA-F]{1,4}:){2}((:[\da-fA-F]{1,4}){1,4}|:)$|^([\da-fA-F]{1,4}:){3}((:[\da-fA-F]{1,4}){1,3}|:)$|^([\da-fA-F]{1,4}:){4}((:[\da-fA-F]{1,4}){1,2}|:)$|^([\da-fA-F]{1,4}:){5}:([\da-fA-F]{1,4})?$|^([\da-fA-F]{1,4}:){6}:$/.test(t)?s():s(new Error("IPV6"+this.$t("addOrModifyPgHba.geshiyouwu-qingjiacha")))}else s()},trigger:"blur"}],auth_method:[{required:!0,message:this.$t("createDatabasePage.qingxuanze-neirong",["Auth Method"]),trigger:"change"}],options:[{required:!1,validator:(e,t,a)=>{if(t)if(t.includes("map=")){if(this.modelInfoFrom.user_name&&Array.isArray(this.modelInfoFrom.user_name)){const e=this.modelInfoFrom.user_name.find((e=>"all"!==e));(this.modelInfoFrom.user_name.length>1||this.modelInfoFrom.user_name.find((e=>"all"===e)))&&s(this.$t("addOrModifyPgHba.shiyong-map-m"),"warning"),this.modelInfoFrom.user_name=e||""}this.userIsMultiple=!1;const e=["ident","peer","gssapi","cert"];if(this.optionsIsIncludeMap=!0,this.modelInfoFrom.auth_method&&!e.includes(this.modelInfoFrom.auth_method))return a(new Error(this.$t("addOrModifyPgHba.shenfenyanzheng-fangfa-m",[e.join("、")])));a()}else{this.optionsIsIncludeMap=!1,this.userIsMultiple=!0;const e=this.modelInfoFrom.user_name;Array.isArray(e)||(this.modelInfoFrom.user_name=e?e.split():[]),a()}else{this.optionsIsIncludeMap=!1,this.userIsMultiple=!0;const e=this.modelInfoFrom.user_name;Array.isArray(e)||(this.modelInfoFrom.user_name=e?e.split():[]),a()}},trigger:"blur"}],map_name:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["Map Name"]),trigger:"blur"}],system_username:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["System Username"]),trigger:"blur"}],database_username:[{required:!0,message:this.$t("addOrModifyPgHba.qingshuru-neirong",["Database Username"]),trigger:"blur"}]},typeOptions:["local","host","hostssl","hostnossl","hostgssenc","hostnogssenc"],databaseOptions:["all","replication"],userOptions:["all"],methodOptions:["peer","trust","reject","md5","ident","ldap","scram-sha-256","password","gss","sspi","radius","cert","pam","bsd"]}},props:["db_id_prop","db_names_prop","user_names_prop"],watch:{"modelInfoFrom.address":{handler(e,t){/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)\/(\d|[1-2]\d|3[0-2])$/.test(e)||/^([\da-fA-F]{1,4}:){6}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^::([\da-fA-F]{1,4}:){0,4}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:):([\da-fA-F]{1,4}:){0,3}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:){2}:([\da-fA-F]{1,4}:){0,2}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:){3}:([\da-fA-F]{1,4}:){0,1}((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:){4}:((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:){7}[\da-fA-F]{1,4}\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^:((:[\da-fA-F]{1,4}){1,6}|:)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^[\da-fA-F]{1,4}:((:[\da-fA-F]{1,4}){1,5}|:)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:){2}((:[\da-fA-F]{1,4}){1,4}|:)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:){3}((:[\da-fA-F]{1,4}){1,3}|:)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:){4}((:[\da-fA-F]{1,4}){1,2}|:)\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:){5}:([\da-fA-F]{1,4})?\/([1-9]?\d|(1([0-1]\d|2[0-8])))$|^([\da-fA-F]{1,4}:){6}:\/([1-9]?\d|(1([0-1]\d|2[0-8])))$/.test(e)?(this.isUsedNetMask=!1,this.$set(this.modelInfoFrom,"netmask","")):this.isUsedNetMask=!0}},"modelInfoFrom.database":{handler(e,t){if(e&&t){let s=e.filter((e=>!t.includes(e)));if(0===s.length)return!1;if(s.includes("all"))this.$set(this.modelInfoFrom,"database",["all"]);else{let t=e.filter((e=>"all"!==e));this.$set(this.modelInfoFrom,"database",t)}}},immediate:!0},"modelInfoFrom.user_name":{handler(e,t){if(!this.userIsMultiple)return!1;if(e&&t){let s=e.filter((e=>!t.includes(e)));if(0===s.length)return!1;if(s.includes("all"))this.$set(this.modelInfoFrom,"user_name",["all"]);else{let t=e.filter((e=>"all"!==e));this.$set(this.modelInfoFrom,"user_name",t)}}},immediate:!0}},methods:{selectAuthMethod(e){this.$refs.modelInfoFrom.validateField("options")},selectType(e){"local"===e?(this.typeIsLocal=!0,this.$set(this.modelInfoFrom,"netmask",""),this.$set(this.modelInfoFrom,"address",""),this.modelInfoFromRules.address.forEach((e=>{e.required=!1}))):(this.typeIsLocal=!1,this.modelInfoFromRules.address.forEach((e=>{e.required=!0})))},submit(){this.$refs.modelInfoFrom.validateField("options"),this.$nextTick((()=>{this.$refs.modelInfoFrom.validate((a=>{if(a){const a=JSON.parse(JSON.stringify(this.modelInfoFrom)),o=["map_name","system_username","database_username"];let d=[];for(const e in a)o.includes(e)&&(d.push(a[e]),delete a[e]);let i={db_id:this.db_id,is_reload:this.is_reload?1:0,conf_dict:a};i.conf_dict.pg_ident=d.join(" ");const r=i.conf_dict.user_name;if(i.conf_dict.user_name=Array.isArray(r)?r:r.split(),"modify"===this.type){i.option="update",i.line_number=this.line_number;const a=t(".addOrModifyPgHbaDialog .el-dialog");e.updatePgHba(i).then((e=>{a.close(),s(this.$t("baseInfo.xiugai-chenggong")),this.$emit("submit")}),(e=>{this.$emit("submit"),a.close()}))}else{i.option="add";const a=t(".addOrModifyPgHbaDialog .el-dialog");e.updatePgHba(i).then((e=>{a.close(),s(this.$t("addOrModifyPoolList.tianjiachenggong")),this.$emit("submit")}),(e=>{a.close()}))}}}))}))},openDialog(e,t=""){if(this.addOrModifyPgHbaVisible=!0,this.type=e,this.db_id=this.$props.db_id_prop,this.$props.db_names_prop.forEach((e=>{this.databaseOptions.push(e)})),this.$props.user_names_prop.forEach((e=>{this.userOptions.push(e)})),"modify"===e){this.typeTitle=this.$t("addOrModifyPgHba.xiugai-pg_hba-jilu"),this.line_number=t.line_number;const{type:e,database:a,user_name:o,address:d,netmask:i,auth_method:r,options:n}=t;this.$set(this.modelInfoFrom,"type",e),this.selectType(e),this.$set(this.modelInfoFrom,"database",a),this.$set(this.modelInfoFrom,"user_name",o),this.$set(this.modelInfoFrom,"address",d),this.$set(this.modelInfoFrom,"netmask",i),this.$set(this.modelInfoFrom,"auth_method",r),this.$set(this.modelInfoFrom,"options",n?n.join(","):""),t.pg_ident&&(this.optionsIsIncludeMap=!0,this.userIsMultiple=!1,"all"!==o[0]&&this.$set(this.modelInfoFrom,"user_name",o[0]),this.$set(this.modelInfoFrom,"map_name",t.pg_ident[0]?t.pg_ident[0]:""),this.$set(this.modelInfoFrom,"system_username",t.pg_ident[1]?t.pg_ident[1]:""),this.$set(this.modelInfoFrom,"database_username",t.pg_ident[2]?t.pg_ident[2]:""),this.$nextTick((()=>{Array.isArray(t.user_name)&&(t.user_name.length>1||t.user_name.find((e=>"all"===e)))&&this.$nextTick((()=>{s(this.$t("addOrModifyPgHba.shiyong-map-m"),"warning")}))})))}else this.$set(this.modelInfoFrom,"database",[]),this.$set(this.modelInfoFrom,"user_name",[]),this.typeTitle=this.$t("addOrModifyPgHba.tianjia-pg_hba-jilu")},closeDialog(){this.addOrModifyPgHbaVisible=!1,this.$emit("close")}}},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"addOrModifyPgHbaDialog",attrs:{"append-to-body":!0,title:e.typeTitle,visible:e.addOrModifyPgHbaVisible,"close-on-click-modal":!1},on:{close:e.closeDialog,"update:visible":function(t){e.addOrModifyPgHbaVisible=t}}},[s("el-form",{ref:"modelInfoFrom",attrs:{model:e.modelInfoFrom,rules:e.modelInfoFromRules,"label-width":"140px"}},[s("el-row",[s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"Type",prop:"type"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("createDatabasePage.qingxuanze-neirong",["Type"])},on:{change:e.selectType},model:{value:e.modelInfoFrom.type,callback:function(t){e.$set(e.modelInfoFrom,"type",t)},expression:"modelInfoFrom.type"}},e._l(e.typeOptions,(function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"Database",prop:"database"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"","collapse-tags":"",placeholder:e.$t("createDatabasePage.qingxuanze-neirong",["Database"])},model:{value:e.modelInfoFrom.database,callback:function(t){e.$set(e.modelInfoFrom,"database",t)},expression:"modelInfoFrom.database"}},e._l(e.databaseOptions,(function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"User Name",prop:"user_name"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{multiple:e.userIsMultiple,"collapse-tags":"",placeholder:e.$t("createDatabasePage.qingxuanze-neirong",["User Name"])},model:{value:e.modelInfoFrom.user_name,callback:function(t){e.$set(e.modelInfoFrom,"user_name",t)},expression:"modelInfoFrom.user_name"}},e._l(e.userOptions,(function(t){return s("el-option",{key:t,attrs:{disabled:!e.userIsMultiple&&"all"===t,label:t,value:t}})})),1)],1)],1),s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"Address",prop:"address"}},[s("el-input",{attrs:{disabled:e.typeIsLocal,placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["Address"])},model:{value:e.modelInfoFrom.address,callback:function(t){e.$set(e.modelInfoFrom,"address",t)},expression:"modelInfoFrom.address"}})],1)],1),s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"Netmask",prop:"netmask"}},[s("el-input",{attrs:{disabled:!e.isUsedNetMask||e.typeIsLocal,placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["Netmask"])},model:{value:e.modelInfoFrom.netmask,callback:function(t){e.$set(e.modelInfoFrom,"netmask",t)},expression:"modelInfoFrom.netmask"}})],1)],1),s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"Auth Method",prop:"auth_method"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("createDatabasePage.qingxuanze-neirong",["Auth Method"])},on:{change:e.selectAuthMethod},model:{value:e.modelInfoFrom.auth_method,callback:function(t){e.$set(e.modelInfoFrom,"auth_method",t)},expression:"modelInfoFrom.auth_method"}},e._l(e.methodOptions,(function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"Options",prop:"options"}},[s("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["Options"])},model:{value:e.modelInfoFrom.options,callback:function(t){e.$set(e.modelInfoFrom,"options",t)},expression:"modelInfoFrom.options"}})],1)],1),e.optionsIsIncludeMap?s("div",[s("el-col",{attrs:{span:24}},[s("el-form-item",{key:"map_name",attrs:{label:"Map Name",prop:"map_name"}},[s("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["Map Name"])},model:{value:e.modelInfoFrom.map_name,callback:function(t){e.$set(e.modelInfoFrom,"map_name",t)},expression:"modelInfoFrom.map_name"}})],1)],1),s("el-col",{attrs:{span:24}},[s("el-form-item",{key:"system_username",attrs:{label:"System Username",prop:"system_username"}},[s("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["System Username"])},model:{value:e.modelInfoFrom.system_username,callback:function(t){e.$set(e.modelInfoFrom,"system_username",t)},expression:"modelInfoFrom.system_username"}})],1)],1),s("el-col",{attrs:{span:24}},[s("el-form-item",{key:"database_username",attrs:{label:"Database Username",prop:"database_username"}},[s("el-input",{attrs:{placeholder:e.$t("addOrModifyPgHba.qingshuru-neirong",["Database Username"])},model:{value:e.modelInfoFrom.database_username,callback:function(t){e.$set(e.modelInfoFrom,"database_username",t)},expression:"modelInfoFrom.database_username"}})],1)],1)],1):e._e(),s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:e.$t("editConfigTab.shifou-reload"),prop:"is_reload"}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.is_reload,callback:function(t){e.is_reload=t},expression:"is_reload"}})],1)],1)],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.addOrModifyPgHbaVisible=!1}}},[e._v(e._s(e.$t("index.qu-xiao")))]),s("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("defineDatabasePage.ti-jiao")))])],1)],1)}),[],!1,i,"0c0d7adc",null,null);function i(e){for(let t in o)this[t]=o[t]}var r=function(){return d.exports}();export{r as default};
