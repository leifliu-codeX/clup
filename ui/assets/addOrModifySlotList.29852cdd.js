import{a as e,s as t}from"./staticTools.84335405.js";import{A as s}from"./api_operationTools.441466ef.js";import{n as o}from"./index.8ae6cd07.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";const a={};var l=o({data:()=>({addOrModifySlotListVisible:!1,oidIsdisabled:!0,row:null,formInfo:{cluster_name:"",slot_name:"",db_id:"",apply_db_id:"",is_restart:1,plug_name:"",db_name:"",apply_name:""},is_restart:!0,dialogTitle:"",clusterList:[],db_nameList:[],slotList:[],logicalSourceList:[],applyList:[],formInfoRules:{cluster_name:[{required:!0,message:"请选择集群名称",trigger:"change"}],db_id:[{required:!0,message:"请选择源数据库",trigger:"change"}],db_name:[{required:!0,message:"请选择数据库名称",trigger:"change"}],plug_name:[{required:!0,message:"请输入插件名称",trigger:"blur"}],apply_db_id:[{required:!0,message:"请选择目标数据库",trigger:"change"}],slot_name:[{required:!0,message:"请输入复制槽名称",trigger:"blur"}],apply_name:[{required:!0,message:"请输入消费者名称",trigger:"blur"}]},curHostOptions:[],zqpoolConfs:[],curVerionOptions:[],data_rows:{},way:"",selectedCommand:"",arr:[],cluster_name:""}),computed:{isModify(){return"modify"===this.way}},props:["is-show","data-way","data-rows","select"],methods:{switchChange(e){console.log(e),e?(console.log(11111),this.formInfo.is_restart=1):this.formInfo.is_restart=0,console.log(this.formInfo.is_restart)},submit(){this.$refs.formInfo.validate((o=>{if(o){let o=Object.assign({},this.formInfo);const a=e(".creatSlotDialog .el-dialog");switch(this.way){case"creat":1==this.selectedCommand?s.creatPhysicalSlot(o).then((e=>{t(this.$t("ConnectionPoolManagement.chuangjian-chenggong")),this.$emit("refresh"),this.closeDialog(),a.close()}),(e=>{a.close()})):2==this.selectedCommand&&s.creatLogicalSlot(o).then((e=>{t(this.$t("ConnectionPoolManagement.chuangjian-chenggong")),this.$emit("refresh"),this.closeDialog(),a.close()}),(e=>{a.close()}));break;case"modify":["cluster_name","db_id","db_name","plug_name","slot_name"].forEach((e=>{delete o[e]})),console.log(o),o.slot_id=this.data_rows.slot_id,s.modifyLogicalSlot(o).then((e=>{t(this.$t("baseInfo.xiugai-chenggong")),this.$emit("refresh"),this.closeDialog(),a.close()}),(e=>{a.close()}))}}}))},async getInfo(){const t=e(".addOrModifySlotListDaialog .el-dialog");try{"creat"===this.way&&await this.getDBHostList(),await this.getCsuPackageInfo(),t.close()}catch(s){t.close()}},getDBHostList(){return new Promise(((e,o)=>{s.getDBHostList().then((s=>{0===s.length&&(t(this.$t("createStreamReplicationCluster.shujuku-suozai-m"),"warning"),o(!1)),this.curHostOptions=s,e(!0)}),(e=>{o(!1)}))}))},getCsuPackageInfo(){return new Promise(((e,t)=>{s.getCsuPackageInfo({package_name:"zqpool"}).then((t=>{this.zqpoolConfs=t.rows,this.curVerionOptions=this.zqpoolConfs.map((e=>({package:e.package,package_id:e.package_id}))),this.curVerionOptions.length&&this.$set(this.formInfo,"package_id",this.curVerionOptions[0].package_id),e(!0)}),(e=>{t(!1)}))}))},closeDialog(){this.addOrModifySlotListVisible=!1,this.$emit("update:isShow",this.addOrModifySlotListVisible)},setFrom(){console.log(this.data_rows),this.formInfo=this.data_rows,this.formInfo.db_name=this.data_rows.database,this.formInfo.plug_name=this.data_rows.plugin,this.submit()},getCsuster_name(){const e={page_num:1,page_size:2e4};return new Promise(((t,o)=>{s.getClusterList(e).then((e=>{this.arr=e.rows;let s=e.rows;this.clusterList=s.map((e=>({name:e.cluster_name,value:e.cluster_id}))),t(!0)}),(e=>{o(!1)}))}))},clusterChange(e){this.formInfo.db_id="",this.formInfo.apply_db_id="",this.formInfo.db_name="";let t={cluster_id:this.formInfo.cluster_name,page_num:1,page_size:20};s.getclusterdbList(t).then((e=>{this.slotList=e.rows.map((e=>({name:e.host+":"+e.port,value:e.db_id,is_primary:e.is_primary}))),this.logicalSourceList=this.slotList.filter((e=>1===e.is_primary))}))},sourceChange(e){this.formInfo.apply_db_id="";let t={db_id:e};s.getAllChildDb(t).then((e=>{this.applyList=e.rows.map((e=>({name:e.host+":"+e.port,value:e.db_id})))})),s.getDbName(t).then((e=>{this.db_nameList=e.rows.map((t=>(console.log(e),{name:t.datname,value:t.oid})))}))}},mounted(){this.getInfo()},created(){this.addOrModifySlotListVisible=this.$props.isShow,this.way=this.$props.dataWay,this.data_rows=this.$props.dataRows,this.selectedCommand=this.$props.select,"creat"==this.way?1==this.selectedCommand?this.dialogTitle="创建物理复制槽":2==this.selectedCommand&&(this.dialogTitle="创建逻辑复制槽"):"modify"==this.way&&(this.dialogTitle="修改逻辑复制槽",this.selectedCommand=2,this.setFrom()),this.getCsuster_name()}},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"addOrModifySlotListDaialog",attrs:{"append-to-body":!0,title:e.dialogTitle,visible:e.addOrModifySlotListVisible,"close-on-click-modal":!1},on:{close:e.closeDialog,"update:visible":function(t){e.addOrModifySlotListVisible=t}}},[s("el-form",{ref:"formInfo",attrs:{model:e.formInfo,rules:e.formInfoRules,"label-width":"110px"}},[s("el-row",[s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:e.$t("addorModifySlotList.jiqunmingcheng"),prop:"cluster_name"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择集群名称",clearable:"",disabled:e.isModify},on:{change:e.clusterChange},model:{value:e.formInfo.cluster_name,callback:function(t){e.$set(e.formInfo,"cluster_name",t)},expression:"formInfo.cluster_name"}},e._l(e.clusterList,(function(e){return s("el-option",{key:e.vlaue,attrs:{label:e.name,value:e.value}})})),1)],1)],1),s("el-col",{attrs:{span:24}},[1==e.selectedCommand?s("el-form-item",{attrs:{label:"源数据库",prop:"db_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择源数据库",clearable:"",disabled:e.isModify},on:{change:e.sourceChange},model:{value:e.formInfo.db_id,callback:function(t){e.$set(e.formInfo,"db_id",t)},expression:"formInfo.db_id"}},e._l(e.slotList,(function(e){return s("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1):e._e(),2==e.selectedCommand?s("el-form-item",{attrs:{label:"源数据库",prop:"db_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择源数据库",clearable:"",disabled:e.isModify},on:{change:e.sourceChange},model:{value:e.formInfo.db_id,callback:function(t){e.$set(e.formInfo,"db_id",t)},expression:"formInfo.db_id"}},e._l(e.logicalSourceList,(function(e){return s("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1):e._e()],1),2==e.selectedCommand?s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"数据库名称",prop:"db_name"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择数据库名称",clearable:"",disabled:e.isModify},model:{value:e.formInfo.db_name,callback:function(t){e.$set(e.formInfo,"db_name",t)},expression:"formInfo.db_name"}},e._l(e.db_nameList,(function(e){return s("el-option",{key:e.vlaue,attrs:{label:e.name,value:e.name}})})),1)],1)],1):e._e(),s("el-col",{attrs:{span:24}},[1==e.selectedCommand?s("el-form-item",{attrs:{label:"目标数据库",prop:"apply_db_id"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择目标数据库",clearable:""},model:{value:e.formInfo.apply_db_id,callback:function(t){e.$set(e.formInfo,"apply_db_id",t)},expression:"formInfo.apply_db_id"}},e._l(e.applyList,(function(e){return s("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1):e._e(),2==e.selectedCommand?s("el-form-item",{attrs:{label:"插件名称",prop:"plug_name"}},[s("el-input",{attrs:{placeholder:"请输入插件名称",disabled:e.isModify},model:{value:e.formInfo.plug_name,callback:function(t){e.$set(e.formInfo,"plug_name",t)},expression:"formInfo.plug_name"}})],1):e._e()],1),s("el-col",{attrs:{span:24}},[s("el-form-item",{attrs:{label:"复制槽名称",prop:"slot_name"}},[s("el-input",{attrs:{placeholder:"请输入复制槽名称",disabled:e.isModify},model:{value:e.formInfo.slot_name,callback:function(t){e.$set(e.formInfo,"slot_name",t)},expression:"formInfo.slot_name"}})],1)],1),s("el-col",{attrs:{span:24}},[1==e.selectedCommand?s("el-form-item",{attrs:{label:"重启目标库",prop:"is_restart"}},[s("el-switch",{on:{change:e.switchChange},model:{value:e.is_restart,callback:function(t){e.is_restart=t},expression:"is_restart"}})],1):s("el-form-item",{attrs:{label:"消费者",prop:"apply_name"}},[s("el-input",{attrs:{placeholder:"请输入消费者"},model:{value:e.formInfo.apply_name,callback:function(t){e.$set(e.formInfo,"apply_name",t)},expression:"formInfo.apply_name"}})],1)],1)],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.closeDialog}},[e._v(e._s(e.$t("index.qu-xiao")))]),s("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v(e._s(e.$t("defineDatabasePage.ti-jiao")))])],1)],1)}),[],!1,i,"060b719c",null,null);function i(e){for(let t in a)this[t]=a[t]}var r=function(){return l.exports}();export{r as default};
