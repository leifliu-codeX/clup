import{A as e}from"./api_dbManage.0ed831fd.js";import{b as t,c as a}from"./verificationRules.bef90446.js";import{n as i}from"./index.8ae6cd07.js";import"./index.dfdb83b1.js";import"./vendor.194c4086.js";import"./bus.d56574c1.js";const n={};var o=i({name:"baseInfo",data(){return{row:this.dbData,instanceType:this.dbData.instance_type?this.dbData.instance_type:this.$t("baseInfo.mo-ren"),loading:!1,dbrows:[],whereport:"",isValidateName:!1,baseInfoForm:{port:"",instance_name:""},baseInfoFormRules:{instance_name:[{message:this.$t("defineDatabasePage.qingshuru-shujujku-mingcheng"),trigger:"blur"}],repl_ip:[{required:!1,validator:(e,t,a)=>{if(t){let e=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=t.split(",");for(let t=0;t<i.length;t++)if(!1===e.test(i[t]))return a(new Error(this.$t("createStandbyPage.IP-dizhi-buguifan-message")));return a()}return a()},trigger:"blur"}],port:[{required:!0,validator:t,trigger:"blur"},{required:!0,validator:(t,a,i)=>{if(""==this.baseInfoForm.port)return i();let n={host:this.rowValue.host,port:a};if(this.loading_port=!0,this.rowValue.port==a)return this.loading_port=!1,i();e.checkPortIsUsed(n).then((e=>(this.loading_port=!1,0==e.err_code?0==e.is_used?i():i(new Error(this.$t("verificationRules.gaiduankou-yibei-m"))):i(new Error(e.err_msg)))),(function(e){return this.loading_port=!1,i(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo")))}))},trigger:"submit"}],pgdata:[{required:!0,validator:a,trigger:"blur"},{required:!0,validator:(t,a,i)=>{if(!a)return i();{let t={host:this.rowValue.host,pgdata:a};if(this.rowValue.pgdata==a)return i();e.checkPgdataIsUsed(t).then((e=>0==e.used||(1==e.used?i(new Error(this.$t("verificationRules.gaishuju-mulu-m"))):i(new Error(e.err_msg)))),(e=>i(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo"))))).then((a=>{1==a&&e.checkTheDirIsEmpty(t).then((e=>1==e.is_empty?i(new Error(this.$t("verificationRules.mulubucunzai-huoweikong"))):0==e.is_empty?i():i(new Error(e.err_msg))),(e=>i(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo")))))}))}},trigger:"blur"}]},rowValue:"",loading_port:!1}},mounted(){this.baseInfoList(this.row)},props:{dbData:{required:!0}},methods:{baseInfoList(e){let t="";this.rowValue=e,console.log(e),e.repl_ip&&null!=e.repl_ip&&"None"!=e.repl_ip&&(t=e.repl_ip),this.baseInfoForm={db_id:e.db_id,instance_name:e.instance_name,repl_ip:t,port:e.port,pgdata:e.pgdata}},saveModifySubmit(){const t=this;!0!==t.isValidateName?t.$refs.baseInfoForm.validate((a=>{if(a){t.loading=!0;let a=Object.assign({},this.baseInfoForm);e.modifyDBInfo(a).then((function(){t.loading=!1,t.$message({type:"success",message:t.$t("baseInfo.xiugai-chenggong")}),t.getDBList()}),(function(e){t.loading=!1}))}})):t.$message({type:"error",message:this.$t("defineDatabasePage.mingcheng-yibei-shiyong")})},validateNameFn(t){const a=this;e.getAllDbList().then((function(e){e.rows.find((e=>e.instance_name===t&&""!=e.instance_name))?a.isValidateName=!0:a.isValidateName=!1}))},renewPGBinInfo(){const t=this;let a={db_id:t.row.db_id};t.loading=!0,e.renewPGBinInfo(a).then((function(e){t.loading=!1,t.getDBList()}),(function(e){t.loading=!1}))},getDBList(){const t=this;let a={db_id:t.row.db_id};e.getDbInfo(a).then((function(e){t.loading=!1;const a=e;t.row=e,t.baseInfoList(a)}),(function(e){t.loading=!1}))}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":e.$t("Public.ping-ming-jia-zai-zhong"),span:12}},[a("el-form",{ref:"baseInfoForm",staticStyle:{"margin-top":"20px"},attrs:{model:e.baseInfoForm,rules:e.baseInfoFormRules,"max-width":"600px","label-width":"150px"}},[a("el-form-item",{class:{"is-error":e.isValidateName},attrs:{label:e.$t("SessionManage.shujuku-ming"),prop:"instance_name"}},[a("div",{staticClass:"demo-input-suffix"},[a("el-input",{attrs:{placeholder:e.$t("baseInfo.qingshuru-mingcheng")},on:{change:function(t){return e.validateNameFn(e.baseInfoForm.instance_name)}},model:{value:e.baseInfoForm.instance_name,callback:function(t){e.$set(e.baseInfoForm,"instance_name",t)},expression:"baseInfoForm.instance_name"}},[e.isValidateName?a("i",{staticClass:"red el-input__icon el-icon-error",staticStyle:{"font-size":"14px"},attrs:{slot:"suffix"},slot:"suffix"}):e._e()])],1),e.isValidateName?a("div",{staticClass:"el-form-item__error"},[e._v(e._s(e.$t("defineDatabasePage.yibei-shiyong-message")))]):e._e()]),a("el-form-item",{attrs:{label:e.$t("baseInfo.shujuku-fuzhi-ip"),prop:"repl_ip"}},[a("el-input",{model:{value:e.baseInfoForm.repl_ip,callback:function(t){e.$set(e.baseInfoForm,"repl_ip",t)},expression:"baseInfoForm.repl_ip"}})],1),a("el-form-item",{attrs:{label:e.$t("dbList.shujuku-leixing")}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceType,callback:function(t){e.instanceType=t},expression:"instanceType"}})],1),a("el-row",[a("el-col",{attrs:{span:14}},[a("el-form-item",{attrs:{label:e.$t("createDatabasePage.shujuku-ruanjian"),width:"100%"}},[a("el-input",{attrs:{disabled:""},model:{value:e.row.pg_bin_path,callback:function(t){e.$set(e.row,"pg_bin_path",t)},expression:"row.pg_bin_path"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:e.$t("licManager.ban-ben"),"label-width":"60px",prop:"version"}},[a("el-input",{attrs:{disabled:""},model:{value:e.row.version,callback:function(t){e.$set(e.row,"version",t)},expression:"row.version"}})],1)],1),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"","label-width":"10px"}},[a("el-button",{staticClass:"normal el-icon-refresh-right",on:{click:e.renewPGBinInfo}},[e._v(" "+e._s(e.$t("baseInfo.geng-xin")))])],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:14}},[a("el-form-item",{attrs:{label:e.$t("createDatabasePage.caozuo-xitong-yonghu"),prop:"os_user"}},[a("el-input",{attrs:{disabled:""},model:{value:e.row.os_user,callback:function(t){e.$set(e.row,"os_user",t)},expression:"row.os_user"}})],1)],1),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"UID","label-width":"50px",prop:"os_uid"}},[a("el-input",{attrs:{disabled:""},model:{value:e.row.os_uid,callback:function(t){e.$set(e.row,"os_uid",t)},expression:"row.os_uid"}})],1)],1)],1),a("el-form-item",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_port,expression:"loading_port"}],attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0)",label:e.$t("dashboard.duan-kou"),prop:"port"}},[a("el-input",{model:{value:e.baseInfoForm.port,callback:function(t){e.$set(e.baseInfoForm,"port",t)},expression:"baseInfoForm.port"}})],1),a("el-form-item",{attrs:{label:e.$t("defineDatabasePage.shuju-mulu"),prop:"pgdata"}},[a("el-input",{model:{value:e.baseInfoForm.pgdata,callback:function(t){e.$set(e.baseInfoForm,"pgdata",t)},expression:"baseInfoForm.pgdata"}})],1),a("el-form-item",[a("span",{staticStyle:{color:"red","font-size":"14px"}},[e._v(" "+e._s(e.$t("baseInfo.jinggao-xiugai-shili-warning-m")))])]),a("el-form-item",[a("el-button",{staticClass:"main",attrs:{loading:e.loading},on:{click:e.saveModifySubmit}},[e._v(e._s(e.$t("editConfigTab.baocun-xiugai")))])],1)],1)],1)}),[],!1,s,"2c523964",null,null);function s(e){for(let t in n)this[t]=n[t]}var r=function(){return o.exports}();export{r as default};
