import{n as e,_ as t}from"./index.851f4377.js";import{A as s}from"./api_clusterManage.788b7961.js";import{b as a}from"./bus.d56574c1.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";const i={};var n=e({name:"clusterDefine",data:()=>({filters:{name:""},dbShowList:[{label1:"创建PostgreSQL流复制集群",label2:"导入PostgreSQL流复制集群",type:1,isShowImport:!0,isShow:!0,dbType:1,showLine:!1},{label1:"创建PolarDB非共享存储集群",type:3,isShow:!0,isShowImport:!1,dbType:11,showLine:!0},{label1:"创建PolarDB共享存储集群",type:2,isShow:!0,isShowImport:!1,dbType:11,showLine:!1}],total:0,page:1,size:20,loading:!1,rows:[],totleRow:null,needToFirstPage:!1,Permission_repu:!1,Type:""}),watch:{"filters.name"(e,t){e!=t&&""!=e&&(this.needToFirstPage=!0)}},components:{taskLog:()=>t((()=>import("./taskLog.d0e23faf.js")),["assets/taskLog.d0e23faf.js","assets/HALog.b0ac6c6b.css","assets/index.dfdb83b1.js","assets/vendor.194c4086.js","assets/bus.d56574c1.js","assets/index.851f4377.js","assets/index.738ab243.css"]),ModifyCluster:()=>t((()=>import("./ModifyCluster.7a97bf25.js")),["assets/ModifyCluster.7a97bf25.js","assets/ModifyCluster.09989ace.css","assets/api_clusterManage.788b7961.js","assets/index.dfdb83b1.js","assets/vendor.194c4086.js","assets/bus.d56574c1.js","assets/staticTools.84335405.js","assets/clusterInfo.959a0fa7.js","assets/clusterInfo.7c62c11d.css","assets/verificationRules.43272891.js","assets/index.851f4377.js","assets/index.738ab243.css","assets/taskLog.d0e23faf.js","assets/HALog.b0ac6c6b.css"]),createCluster:()=>t((()=>import("./createStreamReplicationCluster.24ae6a39.js")),["assets/createStreamReplicationCluster.24ae6a39.js","assets/createStreamReplicationCluster.96341e60.css","assets/api_clusterManage.788b7961.js","assets/index.dfdb83b1.js","assets/vendor.194c4086.js","assets/bus.d56574c1.js","assets/index.851f4377.js","assets/index.738ab243.css","assets/verificationRules.43272891.js","assets/staticTools.84335405.js"]),prodbCluster:()=>t((()=>import("./createPolardbCluster.aff91e49.js")),["assets/createPolardbCluster.aff91e49.js","assets/createPolardbCluster.da4aa145.css","assets/index.851f4377.js","assets/index.738ab243.css","assets/vendor.194c4086.js","assets/api_clusterManage.788b7961.js","assets/index.dfdb83b1.js","assets/bus.d56574c1.js","assets/verificationRules.43272891.js","assets/staticTools.84335405.js"]),PolarModify:()=>t((()=>import("./polarDbModifyCluster.6e8450e1.js")),["assets/polarDbModifyCluster.6e8450e1.js","assets/polarDbModifyCluster.8e6e6145.css","assets/api_clusterManage.788b7961.js","assets/index.dfdb83b1.js","assets/vendor.194c4086.js","assets/bus.d56574c1.js","assets/staticTools.84335405.js","assets/index.851f4377.js","assets/index.738ab243.css","assets/verificationRules.43272891.js","assets/polarDbComputerRoomConfig.04d926b0.js","assets/polarDbComputerRoomConfig.c4d81c89.css","assets/taskLog.d0e23faf.js","assets/HALog.b0ac6c6b.css"]),streamCluster:()=>t((()=>import("./ImportStreamReplicationCluster.f0d2fd76.js")),["assets/ImportStreamReplicationCluster.f0d2fd76.js","assets/ImportStreamReplicationCluster.40e61f9c.css","assets/api_clusterManage.788b7961.js","assets/index.dfdb83b1.js","assets/vendor.194c4086.js","assets/bus.d56574c1.js","assets/index.851f4377.js","assets/index.738ab243.css","assets/verificationRules.43272891.js","assets/staticTools.84335405.js"])},methods:{checkPGType(e){const t=this;1==e?t.createSrClusterDialog(e):2==e?t.createPolardbDialog():3==e&&t.createSrClusterDialog(e)},importCheckPGType(e){1==e&&this.addSrClusterDialog(e)},tableRowClassName:({row:e,rowIndex:t})=>t%2!=0?"warning-row":"success-row",openTaskDialog(e){const t=this;t.$nextTick((function(){t.$refs.tasklog.openDialog(e,"",1)}))},handleSizeChange(e){this.size=e,this.needToFirstPage=!0,this.showList()},handleCurrentChange(e){this.page=e,this.showList()},changeIpData(){this.createSrClusterDbForm.repl_ip=this.createSrClusterDbForm.host},handleSearch(){this.showList()},showList:function(){let e=this;this.needToFirstPage&&(this.page=1),1==this.page&&(this.total=0);let t={page_size:e.size,page_num:e.page};""!==e.filters.name&&(t.filter=e.filters.name),e.loading=!0,s.getClusterList(t).then((function(t){e.loading=!1,e.totleRow=t,t&&t.rows&&(e.total=t.total,e.rows=t.rows,e.needToFirstPage=!1),e.$nextTick((()=>{e.$emit("btnHidden")}))}),(function(t){e.loading=!1}))},showDetailView:function(e,t){const s=this;let a={page_size:this.size,page_num:this.page,cluster_id:t.cluster_id,cluster_name:t.cluster_name,cluster_type:t.cluster_type,cluster_state:t.state};11==t.cluster_type?s.$refs.PolarModify.openDialog(a):s.$refs.ModifyCluster.openDialog(a)},createSrClusterDialog:function(e){const t=this;t.Type=e,this.$nextTick((()=>{t.$refs.createCluster.openCreateDialog()}))},createPolardbDialog:function(){this.$refs.prodbCluster.openCreateDialog()},addSrClusterDialog(){this.$refs.streamCluster.openCreateDialog()},delCluter:function(e,t){let a=this;this.$confirm("<p>"+this.$t("clusterDefine.querenjiang-cijiqun")+t.cluster_id+this.$t("clusterDefine.shanchuma-message")+"<p><p>"+this.$t("clusterDefine.shifou-shanchu-jiqunvip")+'</p><p id="p" style="display:inline-block"><input class="ischeckInput" name="ischeckInput" type="radio" checked id="dbdefined_radio_rm_pgdata_yes" value=true> <label for="r">'+this.$t("dbList.shi")+'</label></p>   <p id="p" style="display:inline-block"><input type="radio"   name="ischeckInput"  class="ischeckInput" id="a" value=false> <label for="a">'+this.$t("dbList.fou")+"</label></p>",this.$t("index.ti-shi"),{confirmButtonText:this.$t("index.que-ding"),cancelButtonText:this.$t("index.qu-xiao"),dangerouslyUseHTMLString:!0,closeOnClickModal:!1}).then((({value:e})=>{a.loading=!0;let i={cluster_id:t.cluster_id,vip_delete_flag:0};document.getElementById("dbdefined_radio_rm_pgdata_yes").checked&&(i.vip_delete_flag=1,console.log("rm_pgdata is true .")),s.delete(i).then((function(){a.loading=!1;let e=Math.ceil((a.total-1)/a.size),t=a.page>e?e:a.page;a.page=t<1?1:t,a.showList()}),(function(e){a.loading=!1}))})).catch((e=>{}))},recleI18nFunc(e){return this.$t("clusterDefine."+e)?this.$t("clusterDefine."+e):e}},mounted:function(){const e=this;e.loading=!0,s.getPgFamilyInfo().then((function(t){e.pgTypeText=t.pg_family_name,e.dbShowList[0].label1="创建"+t.pg_family_name+"流复制集群",e.showList()})),a.$on("Permission_repu",(e=>{this.Permission_repu=e}))}},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-row",{staticClass:"warp"},[s("el-col",{staticClass:"warp-breadcrum",attrs:{span:24}},[s("el-breadcrumb",{attrs:{separator:"/"}},[s("el-breadcrumb-item",[s("span",[e._v(e._s(e.$t("clusterDefine.jiqun-dingyi")))])])],1)],1),s("el-col",{staticClass:"warp-main",attrs:{span:24}},[s("el-form",{staticClass:"demo-form-inline",staticStyle:{display:"inline-block"},attrs:{inline:!0,model:e.filters},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",[s("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:e.$t("HAManage.qingshuru-jiqun-message")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)}},model:{value:e.filters.name,callback:function(t){e.$set(e.filters,"name",t)},expression:"filters.name "}},[s("el-button",{attrs:{slot:"append",type:"primary"},on:{click:e.handleSearch},slot:"append"},[e._v(e._s(e.$t("dbList.shou-suo")))])],1),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("Public.question"),placement:"top"}},[s("i",{staticClass:"el-icon-question",staticStyle:{"margin-left":"5px"}})])],1)],1),s("div",{staticStyle:{float:"right","margin-top":"6px"}},[s("el-dropdown",{staticClass:"create",staticStyle:{"margin-right":"10px"},on:{command:e.checkPGType}},[s("el-button",{attrs:{type:"primary"}},[e._v(" "+e._s(e.$t("clusterDefine.chuangjian-jiqun"))),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e._l(e.dbShowList,(function(t,a){return[t.isShow?s("el-dropdown-item",{key:a,class:{"dropdown-item-line":t.showLine},attrs:{command:t.type}},[e._v(e._s(e.recleI18nFunc(t.label1)))]):e._e()]}))],2)],1),s("el-dropdown",{staticClass:"import",staticStyle:{"margin-right":"10px"},on:{command:e.importCheckPGType}},[s("el-button",{attrs:{type:"primary"}},[e._v(" "+e._s(e.$t("clusterDefine.daoru-jiqun"))),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e._l(e.dbShowList,(function(t,a){return[!t.isShowImport||e.Permission_repu&&"创建Patroni集群"==t.label1?e._e():s("el-dropdown-item",{key:a,class:{"dropdown-item-line":t.showLine},attrs:{command:t.type}},[e._v(e._s(e.recleI18nFunc(t.label2)))])]}))],2)],1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.rows,"row-class-name":e.tableRowClassName,border:"","element-loading-text":e.$t("Public.ping-ming-jia-zai-zhong")}},[s("el-table-column",{attrs:{prop:"display_state",label:e.$t("dbList.zhuang-tai"),"header-align":"center",align:"left",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.state?s("i",{staticClass:"el-icon-success green"},[s("span",{staticClass:"statefont"},[e._v(" "+e._s(t.row.display_state))])]):0===t.row.state?s("i",{staticClass:"el-icon-success"},[s("span",{staticClass:"statefont"},[e._v(" "+e._s(t.row.display_state))])]):-1===t.row.state?s("i",{staticClass:"el-icon-error red"},[s("span",{staticClass:"statefont"},[e._v(" "+e._s(t.row.display_state))])]):4===t.row.state?s("span",{staticClass:"statefont"},[s("i",{staticClass:"el-icon-loading green"}),e._v(" "+e._s(t.row.display_state))]):s("span",{staticClass:"statefont"},[s("i",{staticClass:"el-icon-success red"}),e._v(" Failed")])]}}])}),s("el-table-column",{attrs:{prop:"cluster_id",label:e.$t("dbList.jiqun-id"),align:"center",width:"100px"}}),s("el-table-column",{attrs:{prop:"cluster_type",label:e.$t("HAManage.gaokeyong-leixing"),align:"center",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.cluster_type?s("span",[e._v(" "+e._s(e.$t("HAManage.liufuzhi")))]):2===t.row.cluster_type?s("span",[e._v(" "+e._s(e.$t("HAManage.gongxiang-cipan")))]):11===t.row.cluster_type?s("span",[e._v(" "+e._s(e.$t("HAManage.polardb-gongxiang-cunchu")))]):21===t.row.cluster_type?s("span",[e._v(" "+e._s(e.$t("HAManage.patroni-jiqun")))]):e._e()]}}])}),s("el-table-column",{attrs:{prop:"cluster_name",label:e.$t("clusterDefine.jiqun-mingcheng"),align:"center","min-width":"100px","show-overflow-tooltip":""}}),s("el-table-column",{attrs:{prop:"vip",label:"VIP",align:"center","min-width":"100px"}}),s("el-table-column",{attrs:{prop:"handle",label:e.$t("clusterDefine.caozuo"),align:"center","min-width":"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[21!=t.row.cluster_type?s("span",[-1===t.row.state||0===t.row.state&&e.totleRow.is_superuser?s("el-link",{staticClass:"edit",attrs:{size:"mini"},on:{click:function(s){return e.showDetailView(t.$index,t.row)}}},[e._v(e._s(e.$t("dbList.bian-ji"))+" ")]):5!==t.row.state?s("el-link",{staticClass:"see",attrs:{size:"mini"},on:{click:function(s){return e.showDetailView(t.$index,t.row)}}},[e._v(e._s(e.$t("clusterDefine.cha-kan")))]):e._e(),1!==t.row.state?s("span",{staticStyle:{color:"rgb(218 220 224)","font-size":"12px"}},[e._v("|")]):e._e()],1):e._e(),1!==t.row.state||21==t.row.cluster_type?s("el-link",{staticClass:"del",attrs:{size:"mini"},on:{click:function(s){return e.delCluter(t.$index,t.row)}}},[e._v(e._s(e.$t("dbList.shan-chu"))+" ")]):e._e()]}}])})],1),s("div",{staticClass:"block",staticStyle:{float:"right"}},[s("el-pagination",{ref:"pagination",attrs:{showList:"",layout:"total, sizes, prev, pager, next, jumper",total:e.total,"page-sizes":[20,30,40,50,100]},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),s("task-log",{ref:"tasklog",on:{"close-refresh":e.showList}}),s("create-cluster",{ref:"createCluster",attrs:{"data-type":e.Type},on:{"open-task":e.openTaskDialog,refreshTable:e.showList}}),s("modify-cluster",{ref:"ModifyCluster",on:{refreshTable:e.showList}}),s("polar-modify",{ref:"PolarModify",on:{refreshTable:e.showList}}),s("stream-cluster",{ref:"streamCluster",on:{refreshTable:e.showList}}),s("prodb-cluster",{ref:"prodbCluster",on:{"open-task":e.openTaskDialog,refreshTable:e.showList}})],1)}),[],!1,l,"3715db82",null,null);function l(e){for(let t in i)this[t]=i[t]}var o=function(){return n.exports}();export{o as default};
