import{n as e,D as t,_ as r}from"./index.851f4377.js";import{A as a}from"./api_clusterManage.788b7961.js";import{b as s,e as i,c as l,i as o,g as n}from"./verificationRules.43272891.js";import{s as u,d as c,t as p,a as m,g,f as d,b as _}from"./staticTools.84335405.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";var b=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"createPolardbCluster",attrs:{visible:e.createSrClusterFormVisible,"close-on-click-modal":!1,modal:!0,"element-loading-text":e.$t("Public.ping-ming-jia-zai-zhong"),width:"75%"},on:{"update:visible":function(t){e.createSrClusterFormVisible=t}}},[r("div",{attrs:{slot:"title"},slot:"title"},[r("span",{staticClass:"el-dialog__title"},[e._v(e._s(e.$t("createPolardbCluster.chuangjian-polardb-jiqun")))]),r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:e.$t("createStreamReplicationCluster.genju-suotan-message"),placement:"top"}},[r("i",{staticClass:"el-icon-question"})])],1),r("el-steps",{staticStyle:{"margin-bottom":"20px"},attrs:{active:e.active,"finish-status":"success","align-center":""}},[r("el-step",{attrs:{title:e.$t("createDatabasePage.xuanze-shujuku")}}),r("el-step",{attrs:{title:e.$t("createStreamReplicationCluster.jiqun-xinxi")}}),r("el-step",{attrs:{title:e.$t("createPolardbCluster.gongxiangcipan-peizhi")}}),r("el-step",{attrs:{title:e.$t("createStreamReplicationCluster.jiqun-tance")}}),r("el-step",{attrs:{title:e.$t("createPolardbCluster.shujuku-peizhi")}})],1),r("el-col",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active===0"}],staticClass:"valitateError"},[r("el-form",{ref:"createSrClusterDbForm",attrs:{model:e.createSrClusterDbForm,"label-width":"en"==e.language?"130px":"120px",rules:e.createSrClusterDbFormRules}},[r("el-row",[e._l(e.initCreateOption,(function(t){return r("div",{key:t.name},[r("el-col",{attrs:{span:t.span}},[r("el-form-item",{attrs:{label:t.cname,prop:t.name}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("createDatabasePage.qingxuanze-neirong",[t.cname])},model:{value:e.createSrClusterDbForm[t.name],callback:function(r){e.$set(e.createSrClusterDbForm,t.name,r)},expression:"createSrClusterDbForm[item.name]"}},e._l(t.countType,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1),"wal_segsize"===t.name?r("el-col",{staticClass:"wal_segsize-warning",attrs:{span:6}},[r("span",{staticClass:"wal_segsize-warning_words",attrs:{title:e.$t("createDatabasePage.cicanshu-zhizhichi-m")}},[e._v(" "+e._s(e.$t("createDatabasePage.cicanshu-zhizhichi-m"))+" ")])]):e._e()],1)})),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("dbList.suozai-zhuji"),prop:"host"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("defineDatabasePage.qingxuanze-shujiku-message")},on:{change:e.changeIpData},model:{value:e.createSrClusterDbForm.host,callback:function(t){e.$set(e.createSrClusterDbForm,"host",t)},expression:"createSrClusterDbForm.host"}},e._l(e.curHostOptions,(function(t){return r("el-option",{key:t.hid,attrs:{label:t.ip,value:t.ip,disabled:1!==t.state||1===t.is_using||t.mem_size<64}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,placement:"top",disabled:t.mem_size>64&&1===t.state,effect:"dark",content:1!==t.state?e.$t("dbList.agent-yichang"):e.$t("createDatabasePage.gaizhuji-shengyu-message")}},[r("div",{staticStyle:{overlow:"hiedden"}},[r("span",{staticStyle:{float:"left"}},[e._v(e._s(t.ip))]),r("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.hostname))])])])],1)})),1)],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.fuzhi-ip"),prop:"repl_ip"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-shujukude-fuzhiip")},on:{blur:function(t){e.createSrClusterDbForm.repl_ip=t.target.value.trim()}},model:{value:e.createSrClusterDbForm.repl_ip,callback:function(t){e.$set(e.createSrClusterDbForm,"repl_ip",t)},expression:"createSrClusterDbForm.repl_ip"}})],1)],1)],2),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{staticStyle:{width:"100%",float:"left"},attrs:{label:e.$t("createDatabasePage.caozuo-xitong-yonghu"),prop:"os_user"}},[r("el-input",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_os_user,expression:"loading_os_user"}],attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0)",placeholder:e.$t("createPolardbCluster.qingshuru-caocuo-message")},model:{value:e.createSrClusterDbForm.os_user,callback:function(t){e.$set(e.createSrClusterDbForm,"os_user",t)},expression:"createSrClusterDbForm.os_user"}})],1)],1),r("el-col",{attrs:{span:4}},[r("el-form-item",{attrs:{label:"UID",prop:"os_uid","label-width":"50px"}},[r("el-input",{attrs:{placeholder:e.$t("createDatabasePage.shuru-yonghu-UID"),disabled:e.os_uid_disabled},model:{value:e.createSrClusterDbForm.os_uid,callback:function(t){e.$set(e.createSrClusterDbForm,"os_uid",e._n(t))},expression:"createSrClusterDbForm.os_uid"}})],1)],1),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:e.$t("createDatabasePage.shujuku-ruanjian"),prop:"pg_bin_path"}},[r("el-select",{staticStyle:{width:"100%",float:"left"},attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:e.$t("createDatabasePage.qingxuanze-shujuku-ruanjian")},on:{change:e.selectPgBinPath},model:{value:e.createSrClusterDbForm.pg_bin_path,callback:function(t){e.$set(e.createSrClusterDbForm,"pg_bin_path",t)},expression:"createSrClusterDbForm.pg_bin_path"}},e._l(e.pg_bin_path_list,(function(t){return r("el-option",{key:t,attrs:{label:t,value:t}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,placement:"top",effect:"dark",content:"数据库软件的路径"}},[r("div",{staticStyle:{overlow:"hiedden"}},[r("span",{staticStyle:{float:"left"}},[e._v(e._s(t))])])])],1)})),1)],1)],1),r("el-col",{attrs:{span:4}},[r("el-form-item",{attrs:{label:e.$t("licManager.ban-ben"),"label-width":"60px",prop:"version"}},[r("el-input",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_version,expression:"loading_version"}],staticStyle:{width:"100%",float:"left"},attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0)",disabled:""},model:{value:e.createSrClusterDbForm.version,callback:function(t){e.$set(e.createSrClusterDbForm,"version",t)},expression:"createSrClusterDbForm.version"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("defineDatabasePage.shuju-mulu"),prop:"pgdata"}},[r("el-input",{directives:[{name:"loading",rawName:"v-loading",value:e.loading_pgdata,expression:"loading_pgdata"}],attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0)",placeholder:e.$t("defineDatabasePage.shuju-mulu-placeholder")},on:{blur:function(t){e.createSrClusterDbForm.pgdata=t.target.value.trim()}},model:{value:e.createSrClusterDbForm.pgdata,callback:function(t){e.$set(e.createSrClusterDbForm,"pgdata",t)},expression:"createSrClusterDbForm.pgdata"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.youxianji"),prop:"scores"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-shujuke-youxianji-message")},model:{value:e.createSrClusterDbForm.scores,callback:function(t){e.$set(e.createSrClusterDbForm,"scores",e._n(t))},expression:"createSrClusterDbForm.scores"}})],1)],1),r("el-col",{attrs:{span:"en"==e.language?22:12}},[r("el-form-item",{attrs:{label:e.$t("createPolardbCluster.fangnaolie-reset-mingling"),prop:"reset_cmd","label-width":"en"==e.language?"210px":"120px"}},[r("el-input",{attrs:{placeholder:e.$t("createPolardbCluster.qingshuru-fangnaolie-message")},model:{value:e.createSrClusterDbForm.reset_cmd,callback:function(t){e.$set(e.createSrClusterDbForm,"reset_cmd",e._n(t))},expression:"createSrClusterDbForm.reset_cmd"}})],1)],1),r("el-col",{attrs:{span:2}},[r("div",{staticStyle:{"margin-left":"5px",height:"20px","padding-top":"8px"}},[r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top"}},[r("div",{staticStyle:{"overflow-y":"auto","white-space":"pre-wrap"},attrs:{slot:"content"},slot:"content"},[r("pre",[e._v(e._s(e.$t("createPolardbCluster.fangnaolie-question")))])]),r("i",{staticClass:"el-icon-question",staticStyle:{"margin-left":"5px"}}),r("i",{staticClass:"el-icon-question"})])],1)])],1),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:e.$t("createPolardbCluster.hulue-reset-zhixingjieguo"),prop:"ignore_reset_cmd_return_code","label-width":"en"==e.language?"210px":"120px"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:e.$t("createPolardbCluster.zaijiqun-xiufu-guochengzhong-message"),placement:"top-end"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("createDatabasePage.qing-xuan-ze")},model:{value:e.createSrClusterDbForm.ignore_reset_cmd_return_code,callback:function(t){e.$set(e.createSrClusterDbForm,"ignore_reset_cmd_return_code",t)},expression:"createSrClusterDbForm.ignore_reset_cmd_return_code"}},[r("el-option",{attrs:{label:e.$t("dbList.shi"),value:1}}),r("el-option",{attrs:{label:e.$t("dbList.fou"),value:0}})],1)],1)],1)],1)],1)],1),r("div",{staticStyle:{"text-align":"right"}},[r("span",{staticStyle:{color:"red","font-size":"14px"}},[e._v(e._s(e.$t("createStreamReplicationCluster.moren-huijiang-message")))]),r("el-button",{staticClass:"normal el-icon-delete",on:{click:e.emptyClusterDbBtn}},[e._v(" "+e._s(e.$t("createStreamReplicationCluster.qing-kong")))]),r("el-button",{staticClass:"highlight el-icon-plus",staticStyle:{"background-color":"#0070cc"},attrs:{disabled:e.iscanpush},on:{click:e.addClusterDbBtn}},[e._v(" "+e._s(e.$t("createStreamReplicationCluster.tian-jia")))])],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.ClusterDbRows,border:"","element-loading-text":e.$t("Public.zhengzai-jiazai"),"row-class-name":e.tableRowClassName},on:{"cell-mouse-enter":e.handleCellEnter,"cell-mouse-leave":e.handleCellLeave,"cell-click":e.handleCellClick}},[r("el-table-column",{attrs:{prop:"host",label:e.$t("dashboard.zhu-ji"),align:"center"}}),r("el-table-column",{attrs:{prop:"repl_ip",label:e.$t("createStreamReplicationCluster.fuzhi-ip"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return r("div",{staticClass:"item"},[r("el-input",{staticClass:"item__input",attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-fuzhiip")},model:{value:t.row.repl_ip,callback:function(r){e.$set(t.row,"repl_ip",r)},expression:"scope.row.repl_ip"}}),r("div",{staticClass:"item__txt"},[e._v(e._s(t.row.repl_ip))])],1)}}])}),r("el-table-column",{attrs:{prop:"os_user",label:e.$t("createDatabasePage.caozuo-xitong-yonghu"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return r("div",{staticClass:"item"},[r("el-input",{staticClass:"item__input",model:{value:t.row.os_user,callback:function(r){e.$set(t.row,"os_user",r)},expression:"scope.row.os_user"}}),r("div",{staticClass:"item__txt"},[e._v(e._s(t.row.os_user))])],1)}}])}),r("el-table-column",{attrs:{prop:"os_uid",label:"UID",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return r("div",{staticClass:"item"},[r("el-input",{staticClass:"item__input",model:{value:t.row.os_uid,callback:function(r){e.$set(t.row,"os_uid",r)},expression:"scope.row.os_uid"}}),r("div",{staticClass:"item__txt"},[e._v(e._s(t.row.os_uid))])],1)}}])}),r("el-table-column",{attrs:{width:"150px",prop:"pg_bin_path",label:e.$t("createStreamReplicationCluster.PG-ruanjian-mulu"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return r("div",{staticClass:"item"},[r("el-input",{staticClass:"item__input",model:{value:t.row.pg_bin_path,callback:function(r){e.$set(t.row,"pg_bin_path",r)},expression:"scope.row.pg_bin_path"}}),r("div",{staticClass:"item__txt"},[e._v(e._s(t.row.pg_bin_path))])],1)}}])}),r("el-table-column",{attrs:{width:"115px",prop:"version",label:e.$t("createStreamReplicationCluster.ruanjian-banben"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return r("div",{staticClass:"item"},[r("el-input",{staticClass:"item__input",model:{value:t.row.version,callback:function(r){e.$set(t.row,"version",r)},expression:"scope.row.version"}}),r("div",{staticClass:"item__txt"},[e._v(e._s(t.row.version))])],1)}}])}),r("el-table-column",{attrs:{width:"205px",prop:"reset_cmd",label:e.$t("createPolardbCluster.fangnaolie-reset-mingling"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return r("div",{staticClass:"item"},[r("div",{staticClass:"item__txt"},[e._v(e._s(t.row.reset_cmd))])])}}])}),r("el-table-column",{attrs:{prop:"pgdata",label:e.$t("defineDatabasePage.shuju-mulu"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return r("div",{staticClass:"item"},[r("el-input",{staticClass:"item__input",attrs:{placeholder:e.$t("verificationRules.qingshuru-shuji-mulu")},model:{value:t.row.pgdata,callback:function(r){e.$set(t.row,"pgdata",r)},expression:"scope.row.pgdata"}}),r("div",{staticClass:"item__txt"},[e._v(e._s(t.row.pgdata))])],1)}}])}),r("el-table-column",{attrs:{prop:"scores",label:e.$t("createStreamReplicationCluster.youxianji"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return r("div",{staticClass:"item"},[r("el-input",{staticClass:"item__input",attrs:{placeholder:"$t('createStreamReplicationCluster.qingshuru-youxianji')"},model:{value:t.row.scores,callback:function(r){e.$set(t.row,"scores",r)},expression:"scope.row.scores"}}),r("div",{staticClass:"item__txt"},[e._v(e._s(t.row.scores))])],1)}}])}),r("el-table-column",{attrs:{prop:"detail",label:e.$t("clusterDefine.caozuo"),align:"center",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{on:{click:function(r){return e.deleteClusterDbBtn(t.$index,t.row)}}},[e._v(e._s(e.$t("dbList.shan-chu")))])]}}])})],1)],1),r("el-form",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active===1"},{name:"loading",rawName:"v-loading",value:e.clusterInformationLoading,expression:"clusterInformationLoading"}],ref:"createSrClusterInfoForm",attrs:{"element-loading-text":e.$t("Public.ping-ming-jia-zai-zhong"),model:e.createSrClusterInfoForm,"label-width":"180px",rules:e.createSrClusterInfoFormRules}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("clusterDefine.jiqun-mingcheng"),prop:"cluster_name"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-jiqun-mingcheng")},on:{blur:function(t){e.createSrClusterInfoForm.cluster_name=t.target.value.trim()}},model:{value:e.createSrClusterInfoForm.cluster_name,callback:function(t){e.$set(e.createSrClusterInfoForm,"cluster_name",t)},expression:"createSrClusterInfoForm.cluster_name"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("defineDatabasePage.shuju-duankou"),prop:"port"}},[r("el-input",{attrs:{placeholder:e.$t("defineDatabasePage.shuju-duankou-placeholder")},on:{blur:function(t){e.createSrClusterInfoForm.port=t.target.value.trim()}},model:{value:e.createSrClusterInfoForm.port,callback:function(t){e.$set(e.createSrClusterInfoForm,"port",t)},expression:"createSrClusterInfoForm.port"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("defineDatabasePage.DB-zhongde-yonghu"),prop:"db_user"}},[r("el-input",{attrs:{placeholder:e.$t("createPolardbCluster.qingshuru-shujuku-yonghuming-message")},model:{value:e.createSrClusterInfoForm.db_user,callback:function(t){e.$set(e.createSrClusterInfoForm,"db_user",t)},expression:"createSrClusterInfoForm.db_user"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("defineDatabasePage.DB-zhongde-mima"),prop:"db_pass"}},[r("el-input",{attrs:{"show-password":"",placeholder:e.$t("defineDatabasePage.DB-zhongde-mima-placeholder")},model:{value:e.createSrClusterInfoForm.db_pass,callback:function(t){e.$set(e.createSrClusterInfoForm,"db_pass",t)},expression:"createSrClusterInfoForm.db_pass"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("createStandbyPage.liufuzhi-yonghu"),prop:"repl_user"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-liufuzhi-yonghu")},on:{blur:function(t){e.createSrClusterInfoForm.repl_user=t.target.value.trim()}},model:{value:e.createSrClusterInfoForm.repl_user,callback:function(t){e.$set(e.createSrClusterInfoForm,"repl_user",t)},expression:"createSrClusterInfoForm.repl_user"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("createStandbyPage.liufuzhi-mima"),prop:"repl_pass"}},[r("el-input",{attrs:{"show-password":"",placeholder:e.$t("createStreamReplicationCluster.qingshuru-liufuzhi-yonghude-mima"),disabled:e.ischeckpass},on:{blur:function(t){e.createSrClusterInfoForm.repl_pass=t.target.value.trim()}},model:{value:e.createSrClusterInfoForm.repl_pass,callback:function(t){e.$set(e.createSrClusterInfoForm,"repl_pass",t)},expression:"createSrClusterInfoForm.repl_pass"}})],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("computerRoomConfig.vip-chi"),prop:"pool_id"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("computerRoomConfig.qingxuanze-vip-chi-id")},model:{value:e.createSrClusterInfoForm.pool_id,callback:function(t){e.$set(e.createSrClusterInfoForm,"pool_id",t)},expression:"createSrClusterInfoForm.pool_id"}},e._l(e.vipPoolList,(function(t){return r("el-option",{key:t.pool_id,attrs:{label:t.pool_id+" ("+t.start_ip+"~"+t.end_ip+")",value:t.pool_id}},[r("span",{staticClass:"fl"},[e._v(e._s(t.pool_id))]),r("span",{staticClass:"fr",staticStyle:{color:"#8492a6","font-size":"13px"}},[e._v("("+e._s(t.start_ip)+" ~ "+e._s(t.end_ip)+")")])])})),1)],1)],1)],1),r("el-row",[r("el-col",{attrs:{span:10}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.jiqun-vip"),prop:"vip"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-jiqunde-vip")},on:{blur:function(t){e.createSrClusterInfoForm.vip=t.target.value.trim()}},model:{value:e.createSrClusterInfoForm.vip,callback:function(t){e.$set(e.createSrClusterInfoForm,"vip",t)},expression:"createSrClusterInfoForm.vip"}})],1)],1),r("el-col",{attrs:{span:2}},[r("el-form-item",{attrs:{label:"",prop:"","label-width":"10px"}},[r("el-button",{attrs:{type:"primary"},on:{click:e.allotOneVip}},[e._v(e._s(e.$t("computerRoomConfig.fenpei")))])],1)],1)],1),r("el-row")],1),r("el-form",{directives:[{name:"show",rawName:"v-show",value:2===e.active,expression:"active===2"},{name:"loading",rawName:"v-loading",value:e.pfsDiskNmaeFromLoading,expression:"pfsDiskNmaeFromLoading"}],ref:"pfsDiskNmaeFrom",attrs:{"element-loading-text":e.$t("Public.ping-ming-jia-zai-zhong"),model:e.pfsDiskNmaeFrom,"label-width":"180px",rules:e.pfsDiskNmaeRules}},[r("el-row",{staticStyle:{display:"flex","align-items":"center"}},[r("el-col",{staticClass:"prefix_style",attrs:{span:12}},[r("el-form-item",{attrs:{label:"pfs_disk_name",prop:"pfs_disk_name"}},[r("el-input",{staticStyle:{"margin-top":"6px"},attrs:{placeholder:e.$t("createPolardbCluster.qingshuru-pfs_disk_name")},on:{input:e.diskNameInput},model:{value:e.pfsDiskNmaeFrom.pfs_disk_name,callback:function(t){e.$set(e.pfsDiskNmaeFrom,"pfs_disk_name",t)},expression:"pfsDiskNmaeFrom.pfs_disk_name"}},[r("template",{slot:"prepend"},[e._v("/dev/")]),r("el-button",{staticStyle:{"font-size":"12px"},attrs:{slot:"append",icon:"iconfont el-icon-jiance"},on:{click:e.inspectionDiskName},slot:"append"},[e._v(e._s(e.$t("createPolardbCluster.jian-ce")))])],2)],1)],1),-1==e.pfsDiskNmaeStep?r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{"label-width":"20px"}},[r("el-tag",{attrs:{type:"warning"}},[e._v(e._s(e.$t("createPolardbCluster.cipanmingcheng-jiance-m")))])],1)],1):r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{"label-width":"20px"}},[r("el-tag",{attrs:{type:"warning"}},[e._v(e._s(e.$t("createPolardbCluster.zaicigenggai-cipanming-m")))])],1)],1)],1),1==e.pfsDiskNmaeStep?r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"polar_datadir",prop:"polar_datadir"}},[r("el-input",{attrs:{placeholder:e.$t("createPolardbCluster.qingshuru-polar_datadir")},on:{blur:function(t){e.pfsDiskNmaeFrom.polar_datadir=t.target.value.trim()}},model:{value:e.pfsDiskNmaeFrom.polar_datadir,callback:function(t){e.$set(e.pfsDiskNmaeFrom,"polar_datadir",t)},expression:"pfsDiskNmaeFrom.polar_datadir"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"pfsdaemon_params",prop:"pfsdaemon_params"}},[r("el-input",{attrs:{placeholder:e.$t("createPolardbCluster.qingshuru-pfsdaemon_parms")},on:{blur:function(t){e.pfsDiskNmaeFrom.pfsdaemon_params=t.target.value.trim()}},model:{value:e.pfsDiskNmaeFrom.pfsdaemon_params,callback:function(t){e.$set(e.pfsDiskNmaeFrom,"pfsdaemon_params",t)},expression:"pfsDiskNmaeFrom.pfsdaemon_params"}})],1)],1),r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"",prop:""}},[r("span",{staticStyle:{"font-size":"14px"}},[e._v(e._s(e.$t("createPolardbCluster.qingdianji-geshihuaanniu-m"))),r("span",{staticStyle:{color:"red"}},[e._v(e._s(e.$t("createPolardbCluster.geshihua-jiangshi-m")))]),e._v("）")]),r("el-button",{class:{greenBtn:e.isFormat},staticStyle:{"margin-top":"12px"},attrs:{type:"primary",loading:e.formatLoading,icon:"iconfont el-icon-geshihua"},on:{click:e.formatDisk}},[e._v(e._s(e.$t("createPolardbCluster.ge-shi-hua")))])],1)],1)],1):e._e(),r("span",{staticStyle:{display:"block",color:"red","font-size":"14px","margin-left":"60px","text-align":"left"}},[e._v(e._s(e.showmessage))]),e.showDialog?r("ENVDialog",{attrs:{resuletArray:e.value_array},on:{close:e.closeDetailView}}):e._e()],1),r("el-col",{directives:[{name:"show",rawName:"v-show",value:3===e.active,expression:"active===3"}],staticStyle:{margin:"5px 0"}},[r("el-form",{ref:"createSrClusterProbeForm",attrs:{model:e.createSrClusterProbeForm,"label-width":"en"==e.language?"180px":"120px",rules:e.createSrClusterProbeFormRules}},[r("el-row",[r("el-col",{attrs:{span:"en"==e.language?12:8}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.tance-DB"),prop:"probe_db_name"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:"cs_sys_ha",placement:"top-start"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-tance-DB")},model:{value:e.createSrClusterProbeForm.probe_db_name,callback:function(t){e.$set(e.createSrClusterProbeForm,"probe_db_name",t)},expression:"createSrClusterProbeForm.probe_db_name"}})],1)],1)],1),r("el-col",{attrs:{span:"en"==e.language?12:8}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.tance-zhouqi-miao"),prop:"probe_interval"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:e.$t("createStreamReplicationCluster.qingshuru-tance-zhouqi-miao"),placement:"top-start"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-tance-zhouqi-miao")},model:{value:e.createSrClusterProbeForm.probe_interval,callback:function(t){e.$set(e.createSrClusterProbeForm,"probe_interval",t)},expression:"createSrClusterProbeForm.probe_interval"}})],1)],1)],1),r("el-col",{attrs:{span:"en"==e.language?12:8}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.tance-chaoshi-miao"),prop:"probe_timeout"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:e.$t("createStreamReplicationCluster.qingshuru-tance-chaoshi-miao"),placement:"top-start"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-tance-chaoshi-miao")},model:{value:e.createSrClusterProbeForm.probe_timeout,callback:function(t){e.$set(e.createSrClusterProbeForm,"probe_timeout",t)},expression:"createSrClusterProbeForm.probe_timeout"}})],1)],1)],1),r("el-col",{attrs:{span:"en"==e.language?12:8}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.tance-chongshi-cishu"),prop:"probe_retry_cnt"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:e.$t("createStreamReplicationCluster.qingshuru-tanceshibai-message"),placement:"top-start"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-tanceshibai-message")},model:{value:e.createSrClusterProbeForm.probe_retry_cnt,callback:function(t){e.$set(e.createSrClusterProbeForm,"probe_retry_cnt",t)},expression:"createSrClusterProbeForm.probe_retry_cnt"}})],1)],1)],1),r("el-col",{attrs:{span:"en"==e.language?13:8}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.chongshi-jiange-miao"),prop:"probe_retry_interval"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:e.$t("createPolardbCluster.qingshuru-tanceshibaihou-message"),placement:"top-start"}},[r("el-input",{attrs:{placeholder:e.$t("createPolardbCluster.qingshuru-tanceshibaihou-message")},model:{value:e.createSrClusterProbeForm.probe_retry_interval,callback:function(t){e.$set(e.createSrClusterProbeForm,"probe_retry_interval",t)},expression:"createSrClusterProbeForm.probe_retry_interval"}})],1)],1)],1),r("el-col",{attrs:{span:"en"==e.language?11:8}},[r("el-form-item",{attrs:{"label-width":"en"==e.language?"260px":"120px",label:e.$t("createStreamReplicationCluster.shifou-zidong-jiahui-jiqun"),prop:"auto_failback"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:e.$t("createStreamReplicationCluster.beikuguzhang-message"),placement:"top-end"}},[r("el-select",{attrs:{placeholder:e.$t("createDatabasePage.qing-xuan-ze")},model:{value:e.createSrClusterProbeForm.auto_failback,callback:function(t){e.$set(e.createSrClusterProbeForm,"auto_failback",t)},expression:"createSrClusterProbeForm.auto_failback"}},[r("el-option",{attrs:{label:e.$t("dbList.shi"),value:!0}}),r("el-option",{attrs:{label:e.$t("dbList.fou"),value:!1}})],1)],1)],1)],1)],1),r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.tance-zhuku-SQL"),prop:"probe_pri_sql"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:"UPDATE cs_sys_heartbeat SET hb_time = now()",placement:"top-start"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-tance-zhuku-SQL")},on:{blur:function(t){e.createSrClusterProbeForm.probe_pri_sql=t.target.value.trim()}},model:{value:e.createSrClusterProbeForm.probe_pri_sql,callback:function(t){e.$set(e.createSrClusterProbeForm,"probe_pri_sql",t)},expression:"createSrClusterProbeForm.probe_pri_sql"}})],1)],1),r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.tance-beiku-SQL"),prop:"probe_stb_sql"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:"SELECT 1",placement:"top-start"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-tance-beiku-SQL")},on:{blur:function(t){e.createSrClusterProbeForm.probe_stb_sql=t.target.value.trim()}},model:{value:e.createSrClusterProbeForm.probe_stb_sql,callback:function(t){e.$set(e.createSrClusterProbeForm,"probe_stb_sql",t)},expression:"createSrClusterProbeForm.probe_stb_sql"}})],1)],1),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.chufa-DBmingcheng"),prop:"trigger_db_name"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:e.$t("createStreamReplicationCluster.dangfasheng-guzhang-qiehuanshi-message"),placement:"top-start"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.dangfasheng-guzhang-qiehuanshi-message")},on:{blur:function(t){e.createSrClusterProbeForm.trigger_db_name=t.target.value.trim()}},model:{value:e.createSrClusterProbeForm.trigger_db_name,callback:function(t){e.$set(e.createSrClusterProbeForm,"trigger_db_name",t)},expression:"createSrClusterProbeForm.trigger_db_name"}})],1)],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.chufa-DBhanshu"),prop:"trigger_db_func"}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:e.$t("createStreamReplicationCluster.dangfasheng-guzhang-qiehuan-message"),placement:"top-start"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.dangfasheng-guzhang-qiehuan-message")},on:{blur:function(t){e.createSrClusterProbeForm.trigger_db_func=t.target.value.trim()}},model:{value:e.createSrClusterProbeForm.trigger_db_func,callback:function(t){e.$set(e.createSrClusterProbeForm,"trigger_db_func",t)},expression:"createSrClusterProbeForm.trigger_db_func"}})],1)],1)],1)],1),r("el-form-item",{attrs:{label:e.$t("createStreamReplicationCluster.bei-zhu"),prop:"remark"}},[r("el-input",{attrs:{placeholder:e.$t("createStreamReplicationCluster.qingshuru-beizhu")},on:{blur:function(t){e.createSrClusterProbeForm.remark=t.target.value.trim()}},model:{value:e.createSrClusterProbeForm.remark,callback:function(t){e.$set(e.createSrClusterProbeForm,"remark",t)},expression:"createSrClusterProbeForm.remark"}})],1)],1)],1),r("el-col",{directives:[{name:"show",rawName:"v-show",value:4===e.active,expression:"active===4"}],staticStyle:{margin:"5px 0"}},[r("el-form",{ref:"createPolardbClusterSetting",attrs:{"label-width":"220px"}},[r("el-row",e._l(e.createPolardbClusterSetting,(function(t,a){return r("el-col",{key:a,attrs:{span:10}},[1==t.setting_type?r("el-form-item",{attrs:{label:t.key}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:"",placement:"top-end"}},[r("el-input",{attrs:{placeholder:e.$t("createDatabasePage.qingshuru-neirong")},model:{value:e.createPolardbClusterSetting[a].val,callback:function(t){e.$set(e.createPolardbClusterSetting[a],"val",t)},expression:"createPolardbClusterSetting[index].val"}})],1)],1):e._e(),2==t.setting_type?r("el-form-item",{key:a,attrs:{label:t.key}},[r("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,effect:"dark",content:"",placement:"top-end"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("createDatabasePage.qing-xuan-ze"),disabled:e.createPolardbClusterSetting[a].disabled},model:{value:e.createPolardbClusterSetting[a].val,callback:function(t){e.$set(e.createPolardbClusterSetting[a],"val",t)},expression:"createPolardbClusterSetting[index].val"}},[r("el-option",{attrs:{label:"off",value:"off"}}),r("el-option",{attrs:{label:"on",value:"on"}})],1)],1)],1):e._e(),3==t.setting_type?r("el-form-item",{attrs:{label:t.key}},[r("el-input",{staticStyle:{width:"70%",float:"left"},attrs:{placeholder:e.$t("createDatabasePage.qingshuru-neirong")},model:{value:e.createPolardbClusterSetting[a].val,callback:function(t){e.$set(e.createPolardbClusterSetting[a],"val",t)},expression:"createPolardbClusterSetting[index].val"}}),r("el-select",{staticStyle:{width:"30%",float:"left"},attrs:{placeholder:e.$t("createDatabasePage.qing-xuan-ze")},model:{value:e.createPolardbClusterSetting[a].unit,callback:function(t){e.$set(e.createPolardbClusterSetting[a],"unit",t)},expression:"createPolardbClusterSetting[index].unit"}},e._l(e.byteUnitDict,(function(e,t){return r("el-option",{key:e,attrs:{label:e,value:t}})})),1)],1):e._e()],1)})),1)],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{disabled:e.isTesting},nativeOn:{click:function(t){e.createSrClusterFormVisible=!1}}},[e._v(e._s(e.$t("index.qu-xiao")))]),0===e.active?r("el-button",{staticStyle:{"margin-top":"12px"},attrs:{disabled:e.ClusterDbRows.length<=1},on:{click:e.next_step}},[e._v(e._s(e.$t("createDatabasePage.xia-yi-bu")))]):1===e.active||2==e.active||3===e.active?[r("el-button",{staticStyle:{"margin-top":"12px"},attrs:{disabled:e.isTesting},on:{click:e.lastfun}},[e._v(e._s(e.$t("createDatabasePage.shang-yi-bu")))]),2===e.active?r("el-tooltip",{attrs:{disabled:e.isFormat,placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.$t("createPolardbCluster.jiancecipanming-tongguo-m")))]),r("span",{staticStyle:{"margin-left":"10px"}},[2===e.active?r("el-button",{staticStyle:{"margin-top":"12px"},attrs:{disabled:!e.isFormat,loading:e.isTestingLoading},on:{click:e.next_step}},[e._v(e._s(e.$t("createDatabasePage.xia-yi-bu")))]):e._e()],1)]):e._e(),3===e.active||1===e.active?r("el-button",{staticStyle:{"margin-top":"12px"},on:{click:e.next_step}},[e._v(e._s(e.$t("createDatabasePage.xia-yi-bu")))]):e._e()]:e.active>=4?[r("el-button",{staticStyle:{"margin-top":"12px"},on:{click:e.lastfun}},[e._v(e._s(e.$t("createDatabasePage.shang-yi-bu")))]),4==e.active?r("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.createSrClusteSubmit}},[e._v(e._s(e.$t("defineDatabasePage.ti-jiao")))]):e._e()]:e._e()],2)],1)},h=[];const f={name:"clusterDefine",data(){let e=(e,t,r)=>{const a=this;return t?(a.createSrClusterInfoForm.db_user==a.createSrClusterInfoForm.repl_user?(a.ischeckpass=!0,a.createSrClusterInfoForm.repl_pass=a.createSrClusterInfoForm.db_pass):a.ischeckpass=!1,r()):r(new Error(e.message))};return{loading:!1,isTesting:!1,isTestingLoading:!1,loading_pgdata:!1,loading_port:!1,os_uid_disabled:!0,loading_os_user:!1,loading_pg_bin_path_list:!1,pg_bin_path_list:[],loading_version:!1,showmessage:"",createPolardbClusterSetting:[],createPolardbClusterSetting1:[{key:"polar_storage_cluster_name",val:"disk",setting_type:1},{key:"shared_preload_libraries",val:"polar_vfs,polar_worker,pg_stat_statements",setting_type:1},{key:"logging_collector",val:"on",setting_type:2,disabled:!1},{key:"log_line_prefix",val:"%p\t%r\t%u\t%m\t",setting_type:1},{key:"log_directory",val:"pg_log",setting_type:1},{key:"log_destination",val:"stderr",setting_type:1},{key:"listen_addresses",val:"*",setting_type:1},{key:"max_connections",val:"1000",setting_type:1},{key:"wal_keep_size",val:"1",unit:"GB",setting_type:3,db_version:15},{key:"wal_keep_segments",val:"64",setting_type:1,db_version:11},{key:"full_page_writes",val:"on",setting_type:2,disabled:!1},{key:"min_wal_size",val:"320",unit:"MB",setting_type:3},{key:"max_wal_size",val:"1",unit:"GB",setting_type:3},{key:"polar_vfs.localfs_mode",val:"off",setting_type:2,disabled:!0},{key:"polar_enable_shared_storage_mode",val:"on",setting_type:2,disabled:!0}],createPolardbClusterSettingRules:{},createSrClusterFormVisible:!1,ischeckpass:!1,createSrClusterInfoFormRules:{cluster_name:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-jiqun-mingcheng"),trigger:"blur"}],pool_id:[{required:!0,message:"请选择VIP池ID",trigger:"change"}],vip:[{required:!0,message:this.$t("polarDbComputerRoomConfig.qingshuru-VIP"),trigger:"change"},{required:!0,validator:(e,t,r)=>{let a=this;if(t){let e=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=t.split(",");for(let t in s)if(!1===e.test(s[t]))return r(new Error(this.$t("verificationRules.IP-dizhi-buguifan-message")));return null!=a.ClusterDbRows.find((e=>e.repl_ip===t))?r(new Error(this.$t("createStreamReplicationCluster.IPdizhi-chongfu-message"))):r()}return r(new Error(this.$t("verificationRules.qingshuru-IP-dizhi")))},trigger:"blur"},{required:!0,validator:(e,t,r)=>{if(""===t)r(new Error(this.$t("computerRoomConfig.qingxuanze-vip-chi-id")));else{let e={pool_id:this.createSrClusterInfoForm.pool_id,vip:this.createSrClusterInfoForm.vip};a.checkVipInPool(e).then((e=>{r()}))}},trigger:"blur"}],port:[{required:!0,validator:s,trigger:"blur"},{required:!0,validator:(e,t,r)=>{if(""==this.createSrClusterInfoForm.port)return r();this.loading_port=!0;let s=[];for(let a=0;a<this.ClusterDbRows.length;a++){let e={host:this.ClusterDbRows[a].host,port:t};s.push(e)}Promise.all(s.map((e=>a.checkPortIsUsed(e)))).then((e=>{console.log(e),this.loading_port=!1,e.forEach(((t,a)=>0!=t.err_code?r(new Error(e.err_msg)):0==t.is_used&&a==e.length-1?r():1==t.is_used?r(new Error(this.$t("verificationRules.gaiduankou-yibei-m"))):void 0))}),(e=>(this.loading_port=!1,r(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo"))))))},trigger:"submit"}],pgdata:[{required:!0,message:this.$t("verificationRules.qingshuru-shuji-mulu"),trigger:"blur"}],db_user:[{required:!0,validator:e,message:this.$t("createDatabasePage.HA-guanli-yonghu-message"),trigger:"blur"}],os_uid:[{required:!0,message:this.$t("qingshur-yonghu-UID"),trigger:"blur"},{type:"number",message:this.$t("createDatabasePage.qingshuru-shuzi"),trigger:"blur"}],db_pass:[{required:!0,validator:e,message:this.$t("defineDatabasePage.DB-zhongde-mima-placeholder"),trigger:"blur"}],repl_user:[{required:!0,validator:e,message:this.$t("createStreamReplicationCluster.qingshuru-liufuzhi-yonghu"),trigger:"blur"}],repl_pass:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-liufuzhi-yonghude-mima"),trigger:"blur"}],db_ip_list:[{required:!0,validator:i,trigger:"blur"}],repl_ip_list:[{required:!0,validator:i,trigger:"blur"}],probe_db_name:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-DB"),trigger:"blur"}],probe_interval:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-zhouqi-miao"),trigger:"blur"}],probe_timeout:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-chaoshi-miao"),trigger:"blur"}],probe_retry_cnt:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tanceshibai-message"),trigger:"blur"}],probe_retry_interval:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-shibaihou-message"),trigger:"blur"}],probe_pri_sql:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-zhuku-SQL"),trigger:"blur"}],probe_stb_sql:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-beiku-SQL"),trigger:"blur"}]},createSrClusterInfoForm:{pfsdaemon_params:"-w 2"},createSrClusterDbForm:{scores:0,repl_ip:"",pgdata:"",ignore_reset_cmd_return_code:0,wal_segsize:"16MB",storage_size:"10GB"},createSrClusterDbFormRules:{reset_cmd:[{required:!0,message:this.$t("createPolardbCluster.qingshuru-fangnaolie-reset-mingling"),trigger:"blur"}],host:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-zhuji"),trigger:"submit"}],pg_bin_path:[{required:!0,message:this.$t("createDatabasePage.bixu-xuanze-youxiao-raunjianmulu"),trigger:"submit"}],os_user:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-caozuo-xitong-yonghu"),trigger:"blur"}],os_uid:[{required:!0,message:this.$t("qingshur-yonghu-UID"),trigger:"blur"},{type:"number",message:this.$t("createDatabasePage.qingshuru-shuzi"),trigger:"blur"}],sync:[{required:!0,trigger:"change"}],repl_ip:[{required:!0,validator:i,trigger:"blur"}],pgdata:[{required:!0,message:this.$t("verificationRules.qingshuru-shuji-mulu"),trigger:"blur"},{required:!0,validator:(e,t,r)=>{if(""===t)r(new Error(this.$t("verificationRules.qingshuru-shuji-mulu")));else{if(!this.createSrClusterDbForm.host)return r(this.$t("createDatabasePage.xuanzezhuji-kechakan-message"));{let e={host:this.createSrClusterDbForm.host,pgdata:t};this.loading_pgdata=!0,a.checkTheDirIsEmpty(e).then((e=>(this.loading_pgdata=!1,1==e.is_empty?r():0==e.is_empty?r(new Error(this.$t("verificationRules.gaishuju-mulu-m"))):r(new Error(e.err_msg)))),(e=>(this.loading_pgdata=!1,r(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo"))))))}}},trigger:"submit"},{required:!0,validator:l,trigger:"blur"}],conn_cnt:[{required:!0,validator:(e,t,r)=>{if(t)return t<20||t>1e4?r(new Error(this.$t("createDatabasePage.lianjie-fanwewi"))):r();r(new Error(this.$t("createDatabasePage.qingshuru-lianjieshu")))},trigger:"blur"},{type:"number",message:this.$t("createDatabasePage.lianjieshu-bixuwei-shuzizhi")}],mem_size:[{required:!0,message:this.$t("createDatabasePage.qingshuru-neicun-daxiao"),trigger:"blur"},{type:"number",message:this.$t("createDatabasePage.neicun-bixuei-shuzizhi")}],scores:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-shujukude-youxianji"),trigger:"blur"},{type:"number",message:this.$t("createStreamReplicationCluster.youxianji-bixuwei-shuzi")}],storage_size:[{required:!0,message:this.$t("createDatabasePage.qingxuanze-cunchu-guige"),trigger:"change"}],wal_segsize:[{required:!0,message:this.$t("createPolardbCluster.qingxuanze-wal-wenjian-daxiao"),trigger:"change"}]},createSrClusterProbeForm:{},createSrClusterProbeFormRules:{probe_db_name:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-DB"),trigger:"blur"}],probe_interval:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-zhouqi-miao"),trigger:"blur"}],probe_timeout:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-chaoshi-miao"),trigger:"blur"}],probe_retry_cnt:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tanceshibai-message"),trigger:"blur"}],probe_retry_interval:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-shibaihou-message"),trigger:"blur"}],probe_pri_sql:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-zhuku-SQL"),trigger:"blur"}],probe_stb_sql:[{required:!0,message:this.$t("createStreamReplicationCluster.qingshuru-tance-beiku-SQL"),trigger:"blur"}]},active:0,ClusterDbRows:[],memMax:1024,iscanpush:!1,curHostOptions:[],editProp:["repl_ip","pgdata","scores"],clusterInformationLoading:!1,language:"",pfsDiskNmaeFrom:{pfs_disk_name:"",link_file_name:"nvmecsu01"},pfsDiskNmaeRules:{pfs_disk_name:[{required:!0,message:this.$t("createPolardbCluster.qingshuru-pfs_disk_name"),trigger:"blur"},{required:!0,validator:o}],polar_datadir:[{required:!0,message:this.$t("createPolardbCluster.qingshuru-polar_datadir"),trigger:"blur"}],link_file_name:[{required:!0,message:this.$t("createPolardbCluster.qingshuru-lianjie-wenjianming"),trigger:"blur"},{required:!0,validator:o,trigger:"blur"}],value_select:[{required:!0,message:this.$t("createPolardbCluster.qingxuanze-ENV"),trigger:"change"}]},pfsDiskNmaeStep:-1,value_array:[],pfsDiskNmaeFromLoading:!1,showDialog:!1,formatLoading:!1,isFormat:!1,initCreateOption:[{name:"storage_size",cname:this.$t("createDatabasePage.cunchu-guige"),countType:["10GB","100GB","1TB","2TB","5TB","10TB"],span:12},{name:"wal_segsize",cname:this.$t("createPolardbCluster.wal-wenjian-daxiao"),countType:["16MB","32MB","64MB","128MB","256MB","512MB","1GB","2GB","4GB"],span:6}],byteUnitDict:{B:"",kB:"kB",MB:"MB",GB:"GB",TB:"TB"},vipPoolList:[]}},watch:{createSrClusterFormVisible:function(e){!1===e&&(this.createSrClusterInfoForm={},this.createSrClusterDbForm={wal_segsize:"16MB",storage_size:"10GB",scores:0,repl_ip:"",pgdata:"",ignore_reset_cmd_return_code:0},this.createSrClusterProbeForm={},this.ClusterDbRows=[],this.active=0)},"createSrClusterInfoForm.pfs_disk_name":{handler(e,t){"undefined"!=e&&(this.showmessage="")}},"createSrClusterInfoForm.polar_datadir":{handler(e,t){"undefined"!=e&&(this.showmessage="")}}},components:{ENVDialog:()=>r((()=>import("./ENVDialog.14f105c1.js")),["assets/ENVDialog.14f105c1.js","assets/ENVDialog.180cadbd.css","assets/index.851f4377.js","assets/index.738ab243.css","assets/vendor.194c4086.js"])},methods:{allotOneVip(){if(!this.createSrClusterInfoForm.pool_id)return u(this.$t("computerRoomConfig.qingxuanze-vip-chi-id"),"warning"),!1;let e={pool_id:this.createSrClusterInfoForm.pool_id};a.allotOneVip(e).then((e=>{u(this.$t("computerRoomConfig.fenpei-vip-wei-m",[e])),this.createSrClusterInfoForm.vip=e}))},selectPgBinPath(e){let t=this;if(this.$set(this.createSrClusterDbForm,"pg_bin_path",e),!e)return!1;let r={host:t.createSrClusterDbForm.host,pg_bin_path:t.createSrClusterDbForm.pg_bin_path};t.loading_version=!0,a.getPgBinVersion(r).then((e=>{if(0==e.err_code){this.$set(t.createSrClusterDbForm,"version",e.version);const r=e.version.split(".")[0];let a=t.createPolardbClusterSetting1;t.createPolardbClusterSetting=r>=14?a.filter((e=>"wal_keep_segments"!==e.key)):a.filter((e=>"wal_keep_size"!==e.key)),console.log(t.createPolardbClusterSetting)}else t.$message({message:e.err_msg,type:"error"});t.loading_version=!1}),(function(e){t.loading_version=!1}))},diskNameInput:c((function(...e){this.diskNameInputFunc(...e)}),240),diskNameInputFunc(e){const t=this;t.pfsDiskNmaeStep=-1,t.pfsDiskNmaeFrom={pfs_disk_name:e,link_file_name:"nvmecsu01",pfsdaemon_params:"-w 2",polar_datadir:"shared_data"},t.value_array=[],t.isFormat=!1},closeDetailView(e){this.showDialog=e},inspectionDiskName(){const e=this;e.diskNameInputFunc(e.pfsDiskNmaeFrom.pfs_disk_name),this.$nextTick((()=>{e.$refs.pfsDiskNmaeFrom.validate((t=>{if(t){let t={pfs_disk_name:e.pfsDiskNmaeFrom.pfs_disk_name,host_list:e.ClusterDbRows.map((e=>e.host))};e.pfsDiskNmaeFromLoading=!0,e.isTesting=!0,a.checkPfsDiskNameValidity(t).then((t=>{t.is_valid?(e.showmessage="",e.pfsDiskNmaeStep=1,e.pfsDiskNmaeFromLoading=!1,e.isTesting=!1,!0===t.formated&&(e.isFormat=!0,u(e.$t("createPolardbCluster.cipan-yijing-geshihua-next-m")))):(e.pfsDiskNmaeFromLoading=!1,e.isTesting=!1,e.$alert(t.err_msg,e.$t("createPolardbCluster.cipanjiance-yichang-m"),{confirmButtonText:e.$t("createDatabasePage.wozhidaole"),type:"error"}),e.showmessage=t.err_msg)})).catch((()=>{e.pfsDiskNmaeFromLoading=!1,e.isTesting=!1}))}}))}))},formatDisk(){const e=this;let t=(!0===e.isFormat?e.$t("createPolardbCluster.cipan-yijing-geshihua-question-m"):"")+e.$t("createPolardbCluster.geshihua-jiangshi-m-t"),r=!0===e.isFormat?e.$t("dbList.shi"):e.$t("dynamicTools.que-ren"),s=e.isFormat?e.$t("dbList.fou"):e.$t("dynamicTools.qu-xiao");e.$confirm(t,e.$t("polarDbEditDBList.jing-gao"),{confirmButtonText:r,cancelButtonText:s,type:"warning",iconClass:"el-icon-warning",dangerouslyUseHTMLString:!0}).then((()=>{e.formatLoading=!0,e.pfsDiskNmaeFromLoading=!0,e.isTesting=!0;let t={pfs_disk_name:e.pfsDiskNmaeFrom.pfs_disk_name,host_list:e.ClusterDbRows.map((e=>e.host))};a.formatPfsDisk(t).then((t=>{p(e.$t("createPolardbCluster.geshihua-chenggong"),"success"),e.isFormat=!0,e.formatLoading=!1,e.pfsDiskNmaeFromLoading=!1,e.isTesting=!1}),(t=>{e.isFormat=!1,e.formatLoading=!1,e.pfsDiskNmaeFromLoading=!1,e.isTesting=!1}))})).catch((()=>{e.formatLoading=!1,e.pfsDiskNmaeFromLoading=!1,e.isTesting=!1}))},validOsUser(e,t,r){const s=this;if(""==s.createSrClusterDbForm.os_user)return void r();let i={host:s.createSrClusterDbForm.host,user:t};s.loading_os_user=!0,a.checkOsUserExists(i).then((e=>{s.loading_os_user=!1,0==e.err_code?0==e.exists?(s.os_uid_disabled=!1,s.createSrClusterDbForm.create_os_user=!0,s.createSrClusterDbForm.os_uid&&s.$refs.createSrClusterDbForm.validateField("os_uid"),r()):(s.os_uid_disabled=!0,s.createSrClusterDbForm.create_os_user=!1,s.$refs.createSrClusterDbForm.clearValidate("os_uid"),s.$set(s.createSrClusterDbForm,"os_uid",e.exists),r()):r(new Error(e.err_msg))}),(function(e){r(new Error(e)),s.loading_os_user=!1}))},validOsUid(e,t,r){const s=this;if(""==s.createSrClusterDbForm.os_uid)return void r();if(s.os_uid_disabled)return void r();let i={host:s.createSrClusterDbForm.host,os_uid:t};s.loading_os_user=!0,a.checkOsUidExists(i).then((e=>{s.loading_os_user=!1,0==e.err_code?0==e.exists||s.os_uid_disabled?r():r(new Error(this.$t("createDatabasePage.yonghu-uid")+t+this.$t("createDatabasePage.yicunzai"))):r(new Error(e.err_msg))}),(function(e){r(new Error(e)),s.loading_os_user=!1}))},openCreateDialog(){const e=this;this.createSrClusterFormVisible=!0,this.createSrClusterInfoForm={cluster_name:"",vip:"",port:"",pgdata:"",db_user:"",db_pass:"",repl_user:"",repl_pass:"",pfs_disk_name:"",pfsdaemon_params:"-w 2",polar_datadir:"shared_data"},this.createSrClusterProbeForm={auto_failback:!1,probe_db_name:"cs_sys_ha",probe_interval:"10",probe_timeout:"10",probe_retry_cnt:"2",probe_retry_interval:"5",probe_pri_sql:"UPDATE cs_sys_heartbeat SET hb_time = now()",probe_stb_sql:"SELECT 1",trigger_db_name:"",trigger_db_func:"",remark:""},this.pfsDiskNmaeFrom={pfsdaemon_params:"-w 2",polar_datadir:"shared_data",pfs_disk_name:"",link_file_name:"nvmecsu01"};const t=m(".createPolardbCluster .el-dialog");e.isFormat=!1,e.pfsDiskNmaeStep=-1,a.getDBHostList().then((function(r){if(0===r.length)return t.close(),e.$message({type:"warning",message:e.$t("createStreamReplicationCluster.shujuku-suozai-m")});e.curHostOptions=r;let a=r.find((e=>e.mem_size>=64));return null==a&&(a=e.curHostOptions[0]),e.memMax=a.mem_size,t.close(),e.memMax<64?e.$message({type:"error",message:e.$t("createDatabasePage.gaizhuji-shengyu-message")}):void 0}),(function(e){t.close()}))},validPgBinPath(e,t,r){const s=this;if(""==s.createSrClusterDbForm.host||null==s.createSrClusterDbForm.host)return void r();let i={host:s.createSrClusterDbForm.host,pg_bin_path:s.createSrClusterDbForm.pg_bin_path};s.loading_version=!0,a.getPgBinVersion(i).then((e=>{0==e.err_code?(this.$set(s.createSrClusterDbForm,"version",e.version),r()):r(new Error(e.err_msg)),s.loading_version=!1}),(function(e){s.loading_version=!1,r(new Error(e))}))},getPgPathList(){const e=this;this.$set(e.createSrClusterDbForm,"pg_bin_path",""),this.$set(e.createSrClusterDbForm,"version","");let t={host:e.createSrClusterDbForm.host};e.loading_pg_bin_path_list=!0,a.getPgBinPathList(t).then((t=>{if(e.loading_pg_bin_path_list=!1,e.pg_bin_path_list=t,e.ClusterDbRows.length>0){e.pg_bin_path_list.find((t=>t==e.ClusterDbRows[0].pg_bin_path))&&(this.$set(e.createSrClusterDbForm,"pg_bin_path",e.ClusterDbRows[0].pg_bin_path),this.selectPgBinPath(e.ClusterDbRows[0].pg_bin_path))}}),(function(t){e.loading_pg_bin_path_list=!1}))},tableRowClassName:({row:e,rowIndex:t})=>t%2!=0?"warning-row":"success-row",changeIpData(e){const t=this;if(t.createSrClusterDbForm.repl_ip=t.createSrClusterDbForm.host,this.createSrClusterDbForm.pgdata&&this.$refs.createSrClusterDbForm.validateField("pgdata"),!e)return!1;t.getPgPathList()},createSrClusteSubmit:function(){let e=this;this.$refs.createSrClusterProbeForm.validate((r=>{if(r){const r=m(".createPolardbCluster .el-dialog");let s=Object.assign({},e.createPolardbClusterSetting),i=[];for(let e in s)s[e].unit?i.push({setting_name:s[e].key,val:s[e].val,unit:s[e].unit}):i.push({setting_name:s[e].key,val:s[e].val});let l=Object.assign(this.createSrClusterInfoForm,this.pfsDiskNmaeFrom,{db_list:this.ClusterDbRows},{setting_list:i},this.createSrClusterProbeForm),o=n(l);o.db_type=11,o.reset_cmd=e.ClusterDbRows[0].reset_cmd,o.repl_pass=t.ToDbText(o.repl_pass),o.db_pass=t.ToDbText(o.db_pass),o.pfs_disk_name=o.pfs_disk_name,o.port=Number(o.port),o.wal_segsize=g(e.createSrClusterDbForm.wal_segsize),delete o.storage_size,a.createPolarSdCluster(o).then((function(t){r.close(),e.$emit("refreshTable"),e.$emit("open-task",t.task_id),e.createSrClusterFormVisible=!1}),(function(e){r.close()}))}}))},modifyPolarInitConf(){let e=JSON.parse(JSON.stringify(this.createPolardbClusterSetting));for(let t=0;t<e.length;t++)if(3===e[t].setting_type){let r=["min_wal_size","max_wal_size","wal_keep_size"],a=e[t].unit,s=Number(e[t].val),i=null;r.includes(e[t].key)&&(i=d(this.modifyDBConfigFun(e[t].key))),null!=i&&(s=i.value,a=i.unit),this.$set(e[t],"val",s),this.$set(e[t],"unit",a)}else{let r=e[t].val;["wal_keep_segments"].includes(e[t].key)&&(r=this.modifyDBConfigFun(e[t].key)),this.$set(e[t],"val",r)}this.createPolardbClusterSetting=e,console.log(this.createPolardbClusterSetting)},modifyDBConfigFun(e){let t=g(this.createSrClusterDbForm.wal_segsize),{value:r,unit:a}=_(this.createSrClusterDbForm.storage_size),s=g(this.createSrClusterDbForm.storage_size),i=1024;if("min_wal_size"===e||"max_wal_size"===e){let s,i;10===r&&"GB"===a?(s=Math.floor(g("320MB")/t),i=Math.floor(g("1GB")/t)):100===r&&"GB"===a?(s=Math.floor(g("1GB")/t),i=Math.floor(g("5GB")/t)):(s=Math.floor(g("2GB")/t),i=Math.floor(g("20GB")/t));let l=s>=2?t*s:2*t,o=i>0?t*i:4*t;return o<=l&&(o=4*l),o>=20480&&(o=20480),"min_wal_size"===e?l:o}if("wal_keep_size"===e){let e=s/i,t=g(Number((.1*e/(e/10)**.25).toFixed(2)),"GB");return Math.ceil(t)}if("wal_keep_segments"===e){let e=s/i,r=g(Number((.1*e/(e/10)**.25).toFixed(2)),"GB")/t;return Math.ceil(r)}throw new Error("没有找到对应的参数")},next_step:function(){const e=this;if(0===e.active){this.active++;let e={page_num:1,page_size:9999,filter:""};a.getVipPool(e).then((e=>{this.vipPoolList=e.rows}))}else 1==e.active?e.$refs.createSrClusterInfoForm.validate((t=>{t&&(e.active++,this.modifyPolarInitConf())})):2==e.active?(console.log(e.pfsDiskNmaeFrom.value_select),e.$refs.pfsDiskNmaeFrom.validate((t=>{if(t){let t={host:e.ClusterDbRows[0].host,pfs_disk_name:e.pfsDiskNmaeFrom.pfs_disk_name,polar_datadir:e.pfsDiskNmaeFrom.polar_datadir};e.isTesting=!0,e.isTestingLoading=!0,e.pfsDiskNmaeFromLoading=!0,a.checkPolarSharedDirs(t).then((function(t){e.pfsDiskNmaeFromLoading=!1,e.isTesting=!1,e.isTestingLoading=!1,0==t.err_code?(e.showmessage="",e.active++):e.showmessage=t.err_msg}),(function(t){e.isTesting=!1,e.isTestingLoading=!1,e.loading=!1,e.pfsDiskNmaeFromLoading=!1}))}}))):3==e.active&&this.$refs.createSrClusterProbeForm.validate((t=>{t&&e.active++}))},lastfun(){const e=this;1==e.active&&(e.showmessage=""),e.active--},showRow(e){this.radio=this.ClusterDbRows.indexOf(e),this.selected=e},addClusterDbBtn(){const e=this;e.$refs.createSrClusterDbForm.validate((t=>{if(t){e.version=e.createSrClusterDbForm.version;let t=Object.assign({},e.createSrClusterDbForm);for(var r in e.ClusterDbRows.push(t),console.log(e.ClusterDbRows),e.curHostOptions)e.curHostOptions[r].ip===e.createSrClusterDbForm.host&&(e.curHostOptions[r].is_using=1);e.createSrClusterDbForm.host="",e.createSrClusterDbForm.repl_ip="",e.createSrClusterDbForm.ignore_reset_cmd_return_code=0,e.pg_bin_path_list=[],e.$set(e.createSrClusterDbForm,"pg_bin_path",""),e.$set(e.createSrClusterDbForm,"version","")}}))},emptyClusterDbBtn(){for(var e in this.ClusterDbRows=[],this.curHostOptions){this.curHostOptions[e].is_using=0}},deleteClusterDbBtn(e,t){for(var r in this.ClusterDbRows.splice(e,1),this.curHostOptions)this.curHostOptions[r].ip===t.host&&(this.curHostOptions[r].is_using=0)},handleCellEnter(e,t,r,a){t.property in this.editProp&&null!=r.querySelector(".item__txt")&&r.querySelector(".item__txt").classList.add("item__txt--hover")},handleCellLeave(e,t,r,a){const s=t.property;this.editProp.includes(s)&&null!=r.querySelector(".item__txt")&&(r.querySelector(".item__txt").classList.remove("item__txt--hover"),r.querySelector(".item__txt").style.display="block",r.querySelector(".item__input").style.display="none")},handleCellClick(e,t,r,a){const s=t.property;this.editProp.includes(s)&&(r.querySelector(".item__txt").style.display="none",r.querySelector(".item__input").style.display="block",r.querySelector("input").focus())},cancelEditable(e,t,r,a){const s=t.property;this.editProp.includes(s)&&(r.querySelector(".item__txt").style.display="block",r.querySelector(".item__input").style.display="none")}},mounted:function(){this.language=localStorage.getItem("language_clup"),this.createSrClusterDbFormRules.os_user.push({required:!0,validator:this.validOsUser,trigger:"blur"}),this.createSrClusterDbFormRules.os_uid.push({required:!0,validator:this.validOsUid,trigger:"blur"})}},C={};var v=e(f,b,h,!1,S,"4f8567b8",null,null);function S(e){for(let t in C)this[t]=C[t]}var k=function(){return v.exports}();export{k as default};
