var s=Object.defineProperty,r=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,d=(r,e,a)=>e in r?s(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a,o=(s,o)=>{for(var t in o||(o={}))e.call(o,t)&&d(s,t,o[t]);if(r)for(var t of r(o))a.call(o,t)&&d(s,t,o[t]);return s};"undefined"!=typeof require&&require;import{A as t}from"./api_dbManage.0ed831fd.js";import{n as i,D as l}from"./index.8ae6cd07.js";import"./index.dfdb83b1.js";import"./vendor.194c4086.js";import"./bus.d56574c1.js";const b={};var u=i({name:"dbPassword",data(){return{is_primary:this.dbData.is_primary,dbUser:this.dbData.db_user?this.dbData.db_user:"postgres",row:this.dbData,loading:!1,dbPasswordForm:{repl_pass:""},dbPasswordFormRules:{db_user:[{required:!0,message:this.$t("createDatabasePage.HA-guanli-yonghu-message"),trigger:"blur"}],db_pass:[{required:!0,message:this.$t("defineDatabasePage.DB-zhongde-mima-placeholder"),trigger:"blur"}],repl_user:[{required:!0,message:this.$t("createStandbyPage.qingshuru-shujuku-message"),trigger:"blur"}],repl_pass:[{required:!0,message:this.$t("createStandbyPage.qingshuru-shujuku-zhongde-message"),trigger:"blur"}]}}},mounted(){this.dbPasswordList(this.row)},watch:{"dbPasswordForm.repl_user":{handler(s,r){s==this.dbPasswordForm.db_user&&(this.dbPasswordForm.repl_pass=this.dbPasswordForm.db_pass),""!=s?(this.$set(this.dbPasswordFormRules.repl_user[0],"required",!0),this.$set(this.dbPasswordFormRules.repl_pass[0],"required",!0)):""==s&&""==this.dbPasswordForm.repl_pass&&(this.$set(this.dbPasswordFormRules.repl_user[0],"required",!1),this.$set(this.dbPasswordFormRules.repl_pass[0],"required",!1),this.$refs.dbPasswordForm.clearValidate(["repl_user","repl_pass"]))}},"dbPasswordForm.repl_pass":{handler(s,r){""!=s?(this.$set(this.dbPasswordFormRules.repl_user[0],"required",!0),this.$set(this.dbPasswordFormRules.repl_pass[0],"required",!0)):""==s&&""==this.dbPasswordForm.repl_user&&(this.$set(this.dbPasswordFormRules.repl_user[0],"required",!1),this.$set(this.dbPasswordFormRules.repl_pass[0],"required",!1),this.$refs.dbPasswordForm.clearValidate(["repl_user","repl_pass"]))}},"dbPasswordForm.db_user":{handler(s,r){s==this.dbPasswordForm.repl_user&&(this.dbPasswordForm.repl_pass=this.dbPasswordForm.db_pass)}}},props:{dbData:{required:!0}},methods:{dbPasswordList(s){this.dbPasswordForm={db_id:s.db_id,db_user:s.db_user?s.db_user:"postgres",db_pass:l.FromDbText(s.db_pass),repl_user:s.repl_user?s.repl_user:"",repl_pass:s.repl_pass?l.FromDbText(s.repl_pass):""}},saveModifySubmit(){const s=this;let r=o({db_id:this.dbPasswordForm.db_id,db_user:this.dbPasswordForm.db_user,db_pass:this.dbPasswordForm.db_pass},this.dbPasswordForm.repl_user&&{repl_user:this.dbPasswordForm.repl_user});s.dbPasswordForm.db_user==s.dbPasswordForm.repl_user?this.$confirm(this.$t("dbPassword.fuzhiyonghu-yu-HA-message"),this.$t("index.ti-shi"),{iconClass:"el-icon-warning",customClass:"icon_red",closeOnClickModal:!1}).then((()=>{this.$refs.dbPasswordForm.validate((e=>{if(e){s.loading=!0;let e=o({},this.dbPasswordForm.repl_pass&&{repl_pass:l.ToDbText(this.dbPasswordForm.db_pass)});Object.assign(r,e),r.db_pass=l.ToDbText(r.db_pass),t.modifyDBInfo(r).then((function(){s.loading=!1,s.getDBList(),s.$message({type:"success",message:s.$t("baseInfo.xiugai-chenggong")})}),(function(r){s.loading=!1}))}}))})).catch((()=>{})):this.$refs.dbPasswordForm.validate((e=>{if(e){s.loading=!0;let e=o({},this.dbPasswordForm.repl_pass&&{repl_pass:l.ToDbText(this.dbPasswordForm.repl_pass)});Object.assign(r,e),r.db_pass=l.ToDbText(r.db_pass),t.modifyDBInfo(r).then((function(){s.loading=!1,s.getDBList(),s.$message({type:"success",message:s.$t("baseInfo.xiugai-chenggong")})}),(function(r){s.loading=!1}))}}))},getDBList(){const s=this;let r={db_id:s.row.db_id};t.getDbInfo(r).then((function(r){s.loading=!1;const e=r;s.row=r,s.dbPasswordList(e)}),(function(r){s.loading=!1}))}}},(function(){var s=this,r=s.$createElement,e=s._self._c||r;return e("el-col",{attrs:{span:12}},[e("el-form",{ref:"dbPasswordForm",staticStyle:{"margin-top":"20px"},attrs:{model:s.dbPasswordForm,rules:s.dbPasswordFormRules,"label-width":"165px"}},[e("el-form-item",{attrs:{label:s.$t("defineDatabasePage.DB-zhongde-yonghu"),prop:"db_user"}},[e("el-input",{model:{value:s.dbPasswordForm.db_user,callback:function(r){s.$set(s.dbPasswordForm,"db_user",r)},expression:"dbPasswordForm.db_user"}})],1),e("el-form-item",{attrs:{label:s.$t("defineDatabasePage.DB-zhongde-mima"),prop:"db_pass"}},[e("el-input",{attrs:{"show-password":""},model:{value:s.dbPasswordForm.db_pass,callback:function(r){s.$set(s.dbPasswordForm,"db_pass",r)},expression:"dbPasswordForm.db_pass"}})],1),e("el-form-item",{attrs:{label:s.$t("createStandbyPage.liufuzhi-yonghu"),prop:"repl_user"}},[e("el-input",{model:{value:s.dbPasswordForm.repl_user,callback:function(r){s.$set(s.dbPasswordForm,"repl_user",r)},expression:"dbPasswordForm.repl_user"}})],1),e("el-form-item",{attrs:{label:s.$t("createStandbyPage.liufuzhi-mima"),prop:"repl_pass"}},[e("el-input",{attrs:{disabled:s.dbPasswordForm.db_user==s.dbPasswordForm.repl_user,"show-password":""},model:{value:s.dbPasswordForm.repl_pass,callback:function(r){s.$set(s.dbPasswordForm,"repl_pass",r)},expression:"dbPasswordForm.repl_pass"}})],1),e("el-form-item",{attrs:{label:"",prop:""}},[e("span",{staticStyle:{color:"red","word-break":"normal","overflow-wrap":"break-word","font-size":"14px"}},[s._v(s._s(s.$t("dbPassword.qingxianxiugai-shujuku-meassage")))])]),e("el-form-item",[e("p",{directives:[{name:"show",rawName:"v-show",value:s.row.cluster_id&&1===s.row.cluster_type,expression:"row.cluster_id&&row.cluster_type ===1"}],staticStyle:{color:"red","font-size":"14px"}},[s._v(s._s(s.$t("dbPassword.gaishujuku-zailiufuzhi-message"))+" ")]),e("el-button",{staticClass:"main",attrs:{loading:s.loading,disabled:1==s.row.cluster_type&&!0},on:{click:s.saveModifySubmit}},[s._v(s._s(s.$t("editConfigTab.baocun-xiugai")))])],1)],1)],1)}),[],!1,p,"3378dde8",null,null);function p(s){for(let r in b)this[r]=b[r]}var n=function(){return u.exports}();export{n as default};
