import{A as e}from"./api_dbManage.0ed831fd.js";import{b as a,c as t}from"./verificationRules.43272891.js";import{n as s,D as i}from"./index.851f4377.js";import"./index.dfdb83b1.js";import"./vendor.194c4086.js";import"./bus.d56574c1.js";const r={};var o=s({name:"baseInfo",data(){return{loading:!1,isValidateName_add:"",addDbForm:{},addDbFormRules:{instance_name:[{message:this.$t("defineDatabasePage.qingshuru-shujujku-mingcheng"),trigger:"blur"}],host:[{required:!0,message:this.$t("defineDatabasePage.qingxuanze-zhuji"),trigger:"blur"}],port:[{required:!0,message:this.$t("defineDatabasePage.qingshuru-duankou"),trigger:"blur"},{required:!0,validator:a,trigger:"blur"},{type:"number",message:this.$t("defineDatabasePage.duankou-bixuwei-shuzizhi")}],pgdata:[{required:!0,message:this.$t("defineDatabasePage.qingshuru-shuju-mulu"),trigger:"blur"},{required:!0,validator:t,trigger:"blur"},{required:!0,validator:(a,t,s)=>{if(!t)return s();{let a={host:this.addDbForm.host,pgdata:t};e.checkPgdataIsUsed(a).then((e=>0==e.used||(1==e.used?s(new Error(this.$t("verificationRules.gaishuju-mulu-m"))):s(new Error(e.err_msg)))),(e=>s(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo"))))).then((t=>{1==t&&e.checkTheDirIsEmpty(a).then((e=>1==e.is_empty?s(new Error(this.$t("verificationRules.mulubucunzai-huoweikong"))):0==e.is_empty?s():s(new Error(e.err_msg))),(e=>s(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo")))))}))}},trigger:"blur"}],db_pass:[{required:!0,message:this.$t("defineDatabasePage.DB-zhongde-mima-placeholder"),trigger:"blur"}]},curHostOptions:[],rows:[],pgUser:""}},props:{databaselistData:{required:!0},addType:{required:!0}},computed:{curHostOptionsComputed(){let e=[];return this.curHostOptions.length>0&&(e=this.curHostOptions.map((e=>{const a=[];return 1!==e.state&&a.push(this.$t("dbList.agent-yichang")),e.mem_size<64&&a.push(this.$t("createDatabasePage.gaizhuji-shengyu-message")),e.disableMessage=a.join("<br />"),e.isDisable=a.length>0,e}))),e}},mounted(){this.rows=this.databaselistData;const a=this;a.addDbFormRules.port.push({required:!0,validator:a.validDbPort,trigger:"blur"}),e.getPgFamilyInfo().then((function(e){a.pgUser=e.pg_family_user,a.getDefineData()}))},methods:{changeHost(){this.addDbForm.pgdata&&this.$refs.addDbForm.validateField("pgdata"),this.addDbForm.port&&this.$refs.addDbForm.validateField("port")},validDbPath(a,t,s){if(""==this.addDbForm.host)return void s();let i={host:this.addDbForm.host,path:t};e.checkPathIsDir(i).then((e=>{console.log(e),0==e.err_code?s():s(new Error(e.err_msg))}),(function(e){s(new Error(e))}))},validDbPort(a,t,s){const i=this;if(""==i.addDbForm.host||null==i.addDbForm.host)return void s();if(""==i.addDbForm.pgdata||null==i.addDbForm.pgdata)return void s();let r={host:i.addDbForm.host,pgdata:i.addDbForm.pgdata,port:t};e.checkPortIsRight(r).then((e=>{console.log(e),0==e.err_code?s():"Please check whether the database is started."==e.err_msg?s(new Error(this.$t("defineDatabasePage.qingjiancha-shujuku-m"))):s(new Error(this.$t("verificationRules.duankou-yushujumulu-m")))}),(function(e){s(new Error(this.$t("verificationRules.jiancha-qingqiu-chucuo")))}))},getDefineData(){const a=this;a.loading=!0,e.getDBHostList().then((function(t){a.curHostOptions=t;let s=t.find((e=>1==e.state&&e.mem_size>=64)),i="";s&&(i=s.ip),e.getPgFamilyInfo().then((function(e){a.addDbForm={host:i,db_user:e.pg_family_user},a.loading=!1}))}),(function(e){a.loading=!1}))},closeDiaLog:function(){this.$emit("close-form")},validateNameFn(e,a){this.rows.find((a=>a.instance_name===e))?this["isValidateName_"+a]=!0:this["isValidateName_"+a]=!1},createDbDialog:function(){console.log("执行了"),this.createDataBaseShow=!0},addDbSubmit:function(){console.log("11111111");let a=this;if(!0===a.isValidateName_add)return console.log("2222222"),void a.$message({type:"error",message:a.$t("defineDatabasePage.mingcheng-yibei-shiyong")});this.$refs.addDbForm.validate((t=>{if(console.log("valid",t),t){a.loading=!0,a.$emit("refresh-form");let t=Object.assign({},this.addDbForm);t.port=Number(t.port),t.db_pass=i.ToDbText(t.db_pass),t.db_type=1,1==a.addType&&(t.db_type=11),e.addDb(t).then((function(){a.loading=!1,a.$emit("close-form"),a.$refs.addDbForm.resetFields(),a.addDbFormVisible=!1}),(function(e){a.$emit("down-form"),a.loading=!1}))}}))}}},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{overflow:"hidden"},attrs:{"element-loading-text":e.$t("Public.ping-ming-jia-zai-zhong")}},[t("el-col",{attrs:{span:24}},[t("el-form",{ref:"addDbForm",attrs:{model:e.addDbForm,"label-width":"120px",rules:e.addDbFormRules}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{class:{"is-error":e.isValidateName_add},attrs:{label:e.$t("dbList.shujuku-mingcheng"),prop:"instance_name"}},[t("div",{staticClass:"demo-input-suffix"},[t("el-input",{attrs:{placeholder:e.$t("defineDatabasePage.qingshuru-shujujku-mingcheng")},on:{change:function(a){return e.validateNameFn(e.addDbForm.instance_name,"add")}},model:{value:e.addDbForm.instance_name,callback:function(a){e.$set(e.addDbForm,"instance_name",a)},expression:"addDbForm.instance_name"}},[e.isValidateName_add?t("i",{staticClass:"red el-input__icon el-icon-error",staticStyle:{"font-size":"14px"},attrs:{slot:"suffix"},slot:"suffix"}):e._e()])],1),e.isValidateName_add?t("div",{staticClass:"el-form-item__error"},[e._v(e._s(e.$t("defineDatabasePage.yibei-shiyong-message")))]):e._e()])],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("dbList.suozai-zhuji"),prop:"host"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:e.$t("defineDatabasePage.qingxuanze-shujiku-message")},on:{change:e.changeHost},model:{value:e.addDbForm.host,callback:function(a){e.$set(e.addDbForm,"host",a)},expression:"addDbForm.host"}},e._l(e.curHostOptionsComputed,(function(a){return t("el-option",{key:a.hid,attrs:{label:a.ip,value:a.ip,disabled:a.isDisable}},[t("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,placement:"top",disabled:!a.isDisable,effect:"dark"}},[t("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(a.disableMessage)},slot:"content"}),t("div",{staticStyle:{overflow:"hidden"}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(a.ip))]),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(a.hostname))])])])],1)})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("defineDatabasePage.shuju-mulu"),prop:"pgdata"}},[t("el-input",{attrs:{placeholder:e.$t("defineDatabasePage.shuju-mulu-placeholder")},model:{value:e.addDbForm.pgdata,callback:function(a){e.$set(e.addDbForm,"pgdata",a)},expression:"addDbForm.pgdata"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("defineDatabasePage.shuju-duankou"),prop:"port"}},[t("el-input",{attrs:{placeholder:e.$t("defineDatabasePage.shuju-duankou-placeholder")},model:{value:e.addDbForm.port,callback:function(a){e.$set(e.addDbForm,"port",e._n(a))},expression:"addDbForm.port"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("defineDatabasePage.DB-zhongde-yonghu"),prop:"db_user"}},[t("el-input",{attrs:{placeholder:e.pgUser},model:{value:e.addDbForm.db_user,callback:function(a){e.$set(e.addDbForm,"db_user",a)},expression:"addDbForm.db_user"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:e.$t("defineDatabasePage.DB-zhongde-mima"),prop:"db_pass"}},[t("el-input",{attrs:{autocomplete:"new-password",placeholder:e.$t("defineDatabasePage.DB-zhongde-mima-placeholder"),"show-password":""},model:{value:e.addDbForm.db_pass,callback:function(a){e.$set(e.addDbForm,"db_pass",a)},expression:"addDbForm.db_pass"}})],1)],1)],1)],1),t("div",{staticClass:"dialog-footer",staticStyle:{float:"right","margin-top":"10px"}},[t("el-button",{nativeOn:{click:function(a){return e.closeDiaLog(a)}}},[e._v(e._s(e.$t("index.qu-xiao")))]),t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.addDbSubmit}},[e._v(e._s(e.$t("defineDatabasePage.ti-jiao")))])],1)],1)],1)}),[],!1,d,"267d5ba7",null,null);function d(e){for(let a in r)this[a]=r[a]}var n=function(){return o.exports}();export{n as default};
