import{n as t,_ as e}from"./index.8e63218a.js";import{A as i}from"./api_dbManage.c76fae4d.js";import{s as n}from"./staticTools.84335405.js";import{m as o}from"./dynamicTools.f0febdba.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";const a={};var l=t({data:()=>({loading:!1,isShowComponents:!1,row:{},paginationInfo:{currentPage:1,size:10,total:0},filters:{},replicationList:[]}),props:["props_row"],components:{onSyncReplicationForm:()=>e((()=>import("./onSyncReplicationForm.210c1ee5.js")),["assets/onSyncReplicationForm.210c1ee5.js","assets/onSyncReplicationForm.e27391a1.css","assets/api_dbManage.c76fae4d.js","assets/index.dfdb83b1.js","assets/vendor.194c4086.js","assets/bus.d56574c1.js","assets/staticTools.84335405.js","assets/index.8e63218a.js","assets/index.738ab243.css"])},methods:{onSyncReplication(){this.isShowComponents=!0},offSyncReplication(){o(this.$t("modifyReplicationMode.qingqeuren-m")).then((t=>{const e={db_id:this.row.db_id};this.loading=!0,i.disableStandbySync(e).then((t=>{n(this.$t("modifyReplicationMode.guanbi-chengggong")),this.loading=!1,this.getInfo()}),(t=>{this.loading=!1}))})).catch((t=>{console.log(t)}))},async getInfo(){let t={page_size:this.paginationInfo.size,page_num:this.paginationInfo.currentPage,cluster_id:this.row.cluster_id};this.loading=!0;try{const e=await i.getSyncReplDelay(t);this.paginationInfo.total=e.total,this.replicationList=e.rows.sort(((t,e)=>t.sync_priority-e.sync_priority)),this.loading=!1}catch(e){console.error("internal error"),this.loading=!1}}},mounted(){if(this.row=this.$props.props_row,!this.row.cluster_id)return this.replicationList=[],n(this.$t("modifyReplicationMode.jiqun-id-bucunzai"),"error");this.getInfo()}},(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-form",{staticClass:"filterForm",attrs:{model:t.filters},nativeOn:{submit:function(t){t.preventDefault()}}},[i("el-form-item"),i("el-form-item",{staticStyle:{flex:"1","text-align":"right",color:"red"}},[i("el-button",{staticClass:"normal el-icon-refresh-right",on:{click:t.getInfo}},[t._v(" "+t._s(t.$t("resourceManagement.shua-xin")))]),t.replicationList.length?i("el-button",{attrs:{type:"warning"},on:{click:t.offSyncReplication}},[t._v(t._s(t.$t("modifyReplicationMode.guanbi-tongbufuzhi")))]):i("el-button",{attrs:{type:"primary"},on:{click:t.onSyncReplication}},[t._v(t._s(t.$t("modifyReplicationMode.kaiqi-tongbufuzhi")))])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.replicationList,border:"","element-loading-text":t.$t("Public.ping-ming-jia-zai-zhong")}},[i("el-table-column",{attrs:{label:t.$t("viewDatabaseLogs.xuhao"),align:"center",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.$index;return[t._v(" "+t._s(i+1)+" ")]}}])}),i("el-table-column",{attrs:{prop:"host",label:t.$t("modifyReplicationMode.beiku-ip"),align:"center"}}),i("el-table-column",{attrs:{sortable:"",prop:"sync_priority",label:t.$t("createStreamReplicationCluster.youxianji"),align:"center"}}),i("el-table-column",{attrs:{prop:"current_lsn",label:t.$t("replDelay.dangqian-lsn"),align:"center","min-width":"100px"}}),i("el-table-column",{attrs:{prop:"sent_delay",label:t.$t("replDelay.fasong-yanchi"),align:"center","min-width":"100px"}}),i("el-table-column",{attrs:{prop:"write_delay",label:t.$t("replDelay.xie-yan-chi"),align:"center","min-width":"100px"}}),i("el-table-column",{attrs:{prop:"flush_delay",label:t.$t("replDelay.shuaxin-yanshi"),align:"center","min-width":"100px"}}),i("el-table-column",{attrs:{prop:"replay_delay",label:t.$t("replDelay.zhenshi-yanshi"),align:"center","min-width":"100px"}}),i("el-table-column",{attrs:{prop:"is_sync",label:t.$t("replDelay.tong-bu"),align:"center","min-width":"100px"}}),i("el-table-column",{attrs:{prop:"repl_state",label:t.$t("replDelay.shiji-zhuangtai"),align:"center","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return["streaming"===e.row.repl_state?i("span",{staticClass:"el-icon-success green"},[t._v(" "+t._s(e.row.repl_state))]):"N/A"===e.row.repl_state?i("span",[t._v(" "+t._s(e.row.repl_state))]):i("span",{staticClass:"el-icon-error red"},[t._v(" "+t._s(e.row.repl_state))])]}}])}),i("template",{slot:"empty"},[i("span",{staticStyle:{color:"orange"}},[t._v(t._s(t.$t("modifyReplicationMode.tongbufuzhi-wikaiqi")))])])],2),t.isShowComponents?i("onSyncReplicationForm",{attrs:{"db-id":t.row.db_id,"is-show":t.isShowComponents},on:{refresh:t.getInfo,"update:isShow":function(e){t.isShowComponents=e},"update:is-show":function(e){t.isShowComponents=e}}}):t._e()],1)}),[],!1,s,"5644f020",null,null);function s(t){for(let e in a)this[e]=a[e]}var r=function(){return l.exports}();export{r as default};
