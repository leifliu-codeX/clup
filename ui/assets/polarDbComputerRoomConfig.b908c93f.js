import{A as o}from"./api_clusterManage.788b7961.js";import{e as i}from"./verificationRules.bef90446.js";import{s as t}from"./staticTools.84335405.js";import{n as e}from"./index.8ae6cd07.js";const r={};var a=e({name:"dbList",components:{},data(){let t=(i,t,e)=>{if(""===t)e(new Error(this.$t("computerRoomConfig.qingxuanze-vip-chi-id")));else{let i={pool_id:"modify"===this.type?this.editForm.pool_id:this.addForm.pool_id,vip:"modify"===this.type?this.editForm.vip:this.addForm.vip};o.checkVipInPool(i).then((o=>{e()}))}};return{clusterState:this.$route.query.cluster_state,rows:[],total:0,page:1,size:20,roomList:[],loading:!1,addFormVisible:!1,addFormRules:{room_name:[{required:!0,message:this.$t("polarDbComputerRoomConfig.qingshuru-jifangmingcheng"),trigger:"blur"}],pool_id:[{required:!0,message:this.$t("computerRoomConfig.qingxuanze-vip-chi-id"),trigger:"change"}],vip:[{required:!0,message:this.$t("polarDbComputerRoomConfig.qingshuru-VIP"),trigger:"blur"},{required:!0,validator:i,trigger:"blur"},{required:!0,validator:t,trigger:"blur"}]},addForm:{scores:100},currentRow:"",editFormVisible:!1,editFormRules:{room_name:[{required:!0,message:this.$t("polarDbComputerRoomConfig.qingshuru-jifangmingcheng"),trigger:"blur"}],pool_id:[{required:!0,message:this.$t("computerRoomConfig.qingxuanze-vip-chi-id"),trigger:"change"}],vip:[{required:!0,message:this.$t("polarDbComputerRoomConfig.qingshuru-VIP"),trigger:"blur"},{required:!0,validator:i,trigger:"blur"},{required:!0,validator:t,trigger:"blur"}]},editForm:{},vipPoolList:[],type:"add"}},watch:{"editForm.is_rewind":function(o){o||(this.editForm.is_rebuild=!1)},"editForm.is_rebuild":function(o){o&&(this.editForm.is_rewind=!0)}},methods:{tableRowClassName:({row:o,rowIndex:i})=>i%2!=0?"warning-row":"success-row",showdbList:function(){let i=this;i.loading=!0;let t={cluster_id:i.$route.query.cluster_id};o.getSrClusterRoomInfo(t).then((function(o){i.loading=!1,i.rows=o}),(function(o){i.loading=!1}))},showAddDialog:function(){const i=this;i.addForm={room_name:"",vip:""},i.addFormVisible=!0,i.type="add";o.getVipPool({page_num:1,page_size:9999,filter:""}).then((o=>{this.vipPoolList=o.rows}))},addFormSubmit:function(){let o=this;this.$refs.addForm.validate((i=>{if(i){o.addForm;let i=Object.assign({},this.addForm);i.room_id=Number(o.rows[o.rows.length-1].room_id)+1,o.rows.push(i),o.saveRoomChange()}}))},showEditDialog:function(i,t){const e=this;for(var r in e.editFormVisible=!0,e.type="modify",e.currentRow=t,e.editForm=Object.assign({},t),e.editForm)"pool_id"!==r&&(e.editForm[r]=e.editForm[r].toString().trim());e.editForm.index=i;o.getVipPool({page_num:1,page_size:9999,filter:""}).then((o=>{this.vipPoolList=o.rows}))},saveRoomChange:function(){const i=this;let e={cluster_id:i.$route.query.cluster_id,pool_id:"modify"===this.type?this.editForm.pool_id:this.addForm.pool_id,room_info:{}};i.loading=!0;for(let o=0;o<i.rows.length;o++)e.room_info[i.rows[o].room_id]={room_name:i.rows[o].room_name,vip:i.rows[o].vip};"modify"===this.type?o.updateSrClusterRoomInfo(e).then((function(o){i.loading=!1,i.addFormVisible=!1,i.editFormVisible=!1,t(i.$t("baseInfo.xiugai-chenggong")),i.showdbList()}),(function(o){i.loading=!1})):o.addSrLlusterRoomInfo(e).then((function(o){i.loading=!1,i.addFormVisible=!1,i.editFormVisible=!1,t(i.$t("addOrModifyPoolList.tianjiachenggong")),i.showdbList()}),(function(o){i.loading=!1}))},editFormSubmit:function(){let o=this;o.$refs.editForm.validate((i=>{i&&(o.rows.splice(o.editForm.index,1,o.editForm),o.saveRoomChange())}))},deldbList:function(i,t){this.$confirm(this.$t("polarDbComputerRoomConfig.qingqueren-jiangci-message")+t.room_id+this.$t("polarDbComputerRoomConfig.jifang-mingcheng-message")+t.room_name+this.$t("polarDbComputerRoomConfig.yichuma-mewssage"),this.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{const i=this;let e={cluster_id:i.$route.query.cluster_id,room_id:t.room_id};i.loading=!0,o.deleteSrClusterRoomInfo(e).then((function(o){i.loading=!1,i.showdbList()}),(function(o){i.loading=!1}))})).catch((()=>{}))},allotOneVip(){if("add"===this.type){if(!this.addForm.pool_id)return t(this.$t("computerRoomConfig.qingxuanze-vip-chi-id"),"warning"),!1;let i={pool_id:this.addForm.pool_id};o.allotOneVip(i).then((o=>{t(this.$t("computerRoomConfig.fenpei-vip-wei-m",[o])),this.addForm.vip=o}))}else{if(!this.editForm.pool_id)return t(this.$t("computerRoomConfig.qingxuanze-vip-chi-id"),"warning"),!1;let i={pool_id:this.editForm.pool_id};o.allotOneVip(i).then((o=>{t(this.$t("computerRoomConfig.fenpei-vip-wei-m",[o])),this.editForm.vip=o}))}}},mounted:function(){this.showdbList()},destroyed(){clearInterval(this.intervalID)}},(function(){var o=this,i=o.$createElement,t=o._self._c||i;return t("el-row",[t("el-col",[0===o.clusterState||-1===o.clusterState?t("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"primary"},on:{click:o.showAddDialog}},[o._v(o._s(o.$t("polarDbComputerRoomConfig.zeng-jia")))]):o._e(),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"row-class-name":o.tableRowClassName,data:o.rows,border:"","element-loading-text":o.$t("Public.ping-ming-jia-zai-zhong")}},[t("el-table-column",{attrs:{prop:"room_id",label:o.$t("polarDbComputerRoomConfig.jifang-id"),align:"center","min-width":"120px"}}),t("el-table-column",{attrs:{prop:"room_name",label:o.$t("dbList.jifang-mingcheng"),align:"center","min-width":"120px"},scopedSlots:o._u([{key:"default",fn:function(i){return[t("span",{staticClass:"statefont"},[o._v(" "+o._s("默认机房"==i.row.room_name?o.$t("dbList.moren-jifang"):i.row.room_name))])]}}])}),t("el-table-column",{attrs:{prop:"vip",label:"vip",align:"center","min-width":"150px"}}),t("el-table-column",{attrs:{prop:"room_use_state",label:o.$t("polarDbComputerRoomConfig.shiyong-zhuangtai"),align:"center","min-width":"150px"},scopedSlots:o._u([{key:"default",fn:function(i){return[1==i.row.room_use_state?t("i",{staticClass:"el-icon-success green"},[t("span",[o._v(" "+o._s(o.$t("polarDbComputerRoomConfig.yi-shi-yong")))])]):o._e(),0==i.row.room_use_state?t("i",{staticClass:"el-icon-info"},[t("span",[o._v(" "+o._s(o.$t("polarDbComputerRoomConfig.wei-shi-yong")))])]):o._e()]}}])}),t("el-table-column",{attrs:{prop:"handle",label:o.$t("clusterDefine.caozuo"),align:"center","min-width":"150px"},scopedSlots:o._u([{key:"default",fn:function(i){return[0==o.clusterState||-1==o.clusterState?t("span",[t("el-link",{staticClass:"normal",on:{click:function(t){return o.showEditDialog(i.$index,i.row)}}},[o._v(o._s(o.$t("alarmSet.xiugai")))]),1!==i.row.is_primary?t("el-link",{staticClass:"normal",on:{click:function(t){return o.deldbList(i.$index,i.row)}}},[o._v(o._s(o.$t("alarmInformationConfig.yichu")))]):o._e()],1):o._e()]}}])})],1),t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],staticClass:"modifyWidth",attrs:{"append-to-body":!0,title:o.$t("computerRoomConfig.tianjiajifang-xinxi"),visible:o.addFormVisible,"close-on-click-modal":!1,"element-loading-text":o.$t("Public.ping-ming-jia-zai-zhong")},on:{"update:visible":function(i){o.addFormVisible=i}}},[t("el-form",{ref:"addForm",staticStyle:{width:"90%"},attrs:{model:o.addForm,"label-width":"100px",rules:o.addFormRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:o.$t("dbList.jifang-mingcheng"),prop:"room_name"}},[t("el-input",{attrs:{placeholder:o.$t("polarDbComputerRoomConfig.qingshuru-jifangmingcheng")},model:{value:o.addForm.room_name,callback:function(i){o.$set(o.addForm,"room_name",i)},expression:"addForm.room_name"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:o.$t("computerRoomConfig.vip-chi"),prop:"pool_id"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:o.$t("computerRoomConfig.qingxuanze-vip-chi-id")},model:{value:o.addForm.pool_id,callback:function(i){o.$set(o.addForm,"pool_id",i)},expression:"addForm.pool_id"}},o._l(o.vipPoolList,(function(i){return t("el-option",{key:i.pool_id,attrs:{label:i.pool_id+" ("+i.start_ip+"~"+i.end_ip+")",value:i.pool_id}},[t("span",{staticClass:"fl"},[o._v(o._s(i.pool_id))]),t("span",{staticClass:"fr",staticStyle:{color:"#8492a6","font-size":"13px"}},[o._v("("+o._s(i.start_ip)+" ~ "+o._s(i.end_ip)+")")])])})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:18}},[t("el-form-item",{attrs:{label:"vip",prop:"vip"}},[t("el-input",{attrs:{placeholder:o.$t("computerRoomConfig.dianjifenpei-m")},model:{value:o.addForm.vip,callback:function(i){o.$set(o.addForm,"vip",i)},expression:"addForm.vip"}})],1)],1),t("el-col",{attrs:{span:4}},[t("el-form-item",{attrs:{label:"",prop:"","label-width":"10px"}},[t("el-button",{attrs:{type:"primary"},on:{click:o.allotOneVip}},[o._v(o._s(o.$t("computerRoomConfig.fenpei")))])],1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(i){o.addFormVisible=!1}}},[o._v(o._s(o.$t("index.qu-xiao")))]),t("el-button",{attrs:{type:"primary",loading:o.loading},nativeOn:{click:function(i){return o.addFormSubmit(i)}}},[o._v(o._s(o.$t("defineDatabasePage.ti-jiao")))])],1)],1),t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],staticClass:"modifyWidth",attrs:{"append-to-body":!0,title:o.$t("computerRoomConfig.xiugaijifang-xinxi"),visible:o.editFormVisible,"close-on-click-modal":!1,"element-loading-text":o.$t("Public.ping-ming-jia-zai-zhong")},on:{"update:visible":function(i){o.editFormVisible=i}}},[t("el-form",{ref:"editForm",staticStyle:{width:"90%"},attrs:{model:o.editForm,"label-width":"140px",rules:o.editFormRules}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:o.$t("dbList.jifang-mingcheng"),prop:"room_name"}},[t("el-input",{attrs:{placeholder:o.$t("polarDbComputerRoomConfig.qingshuru-jifangmingcheng")},model:{value:o.editForm.room_name,callback:function(i){o.$set(o.editForm,"room_name",i)},expression:"editForm.room_name"}})],1)],1),t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:o.$t("computerRoomConfig.vip-chi"),prop:"pool_id"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"",placeholder:o.$t("computerRoomConfig.qingxuanze-vip-chi-id")},model:{value:o.editForm.pool_id,callback:function(i){o.$set(o.editForm,"pool_id",i)},expression:"editForm.pool_id"}},o._l(o.vipPoolList,(function(i){return t("el-option",{key:i.pool_id,attrs:{label:i.pool_id+" ("+i.start_ip+"~"+i.end_ip+")",value:i.pool_id}},[t("span",{staticClass:"fl"},[o._v(o._s(i.pool_id))]),t("span",{staticClass:"fr",staticStyle:{color:"#8492a6","font-size":"13px"}},[o._v("("+o._s(i.start_ip)+" ~ "+o._s(i.end_ip)+")")])])})),1)],1)],1),t("el-col",{attrs:{span:18}},[t("el-form-item",{attrs:{label:"vip",prop:"vip"}},[t("el-input",{attrs:{placeholder:o.$t("computerRoomConfig.dianjifenpei-m")},model:{value:o.editForm.vip,callback:function(i){o.$set(o.editForm,"vip",i)},expression:"editForm.vip"}})],1)],1),t("el-col",{attrs:{span:4}},[t("el-form-item",{attrs:{label:"",prop:"","label-width":"10px"}},[t("el-button",{attrs:{type:"primary"},on:{click:o.allotOneVip}},[o._v(o._s(o.$t("computerRoomConfig.fenpei")))])],1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(i){o.editFormVisible=!1}}},[o._v(o._s(o.$t("index.qu-xiao")))]),t("el-button",{attrs:{type:"primary",loading:o.loading},nativeOn:{click:function(i){return o.editFormSubmit(i)}}},[o._v(o._s(o.$t("defineDatabasePage.ti-jiao")))])],1)],1)],1)],1)}),[],!1,n,"e1667f14",null,null);function n(o){for(let i in r)this[i]=r[i]}var l=function(){return a.exports}();export{l as c};
